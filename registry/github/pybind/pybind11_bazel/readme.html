<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-bazel-extensions-for-pybind11" class="anchor" aria-hidden="true" href="#bazel-extensions-for-pybind11"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bazel extensions for pybind11</h1>
<p dir="auto">Provided rules:</p>
<ul dir="auto">
<li><code>pybind_extension</code>: Builds a python extension, automatically adding the
required build flags and pybind11 dependencies. It defines a <code>*.so</code> target
which can be included as a <code>data</code> dependency of a <code>py_*</code> target.</li>
<li><code>pybind_library</code>: Builds a C++ library, automatically adding the required
build flags and pybind11 dependencies. This library can then be used as a
dependency of a <code>pybind_extension</code>. The arguments match a <code>cc_library</code>.</li>
<li><code>pybind_library_test</code>: Builds a C++ test for a <code>pybind_library</code>. The arguments
match a <code>cc_test</code>.</li>
</ul>
<p dir="auto">To test a <code>pybind_extension</code>, the most common approach is to write the test in
python and use the standard <code>py_test</code> build rule.</p>
<p dir="auto">Provided targets:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>@pybind11//:pybind11_embed</code>: Automatically adds required build flags to
embed Python.
Add as a dependency to your <code>cc_binary</code>.</p>
<p dir="auto"><code>@pybind11//:pybind11_embed</code> currently supports Python 3 MacOS/Ubuntu/Debian
environments:</p>
<ul dir="auto">
<li>pyenv</li>
<li>pipenv</li>
<li>virtualenv</li>
</ul>
<p dir="auto">If <code>pybind11_embed</code> doesn't work with your embedded Python project, add
<code>@pybind11</code> as a dependency to your <code>cc_binary</code> and <a href="https://docs.python.org/3/extending/embedding.html#embedding-python-in-c" rel="nofollow">follow the instructions
for manually retrieving the build flags</a>.</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">In your <code>WORKSPACE</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive(
  name = &quot;pybind11_bazel&quot;,
  strip_prefix = &quot;pybind11_bazel-&lt;stable-commit&gt;&quot;,
  urls = [&quot;https://github.com/pybind/pybind11_bazel/archive/&lt;stable-commit&gt;.zip&quot;],
)
# We still require the pybind library.
http_archive(
  name = &quot;pybind11&quot;,
  build_file = &quot;@pybind11_bazel//:pybind11.BUILD&quot;,
  strip_prefix = &quot;pybind11-&lt;stable-version&gt;&quot;,
  urls = [&quot;https://github.com/pybind/pybind11/archive/v&lt;stable-version&gt;.tar.gz&quot;],
)
load(&quot;@pybind11_bazel//:python_configure.bzl&quot;, &quot;python_configure&quot;)
python_configure(name = &quot;local_config_python&quot;)"><pre><span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel-&lt;stable-commit&gt;"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11_bazel/archive/&lt;stable-commit&gt;.zip"</span>],
)
<span class="pl-c"># We still require the pybind library.</span>
<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11"</span>,
  <span class="pl-s1">build_file</span> <span class="pl-c1">=</span> <span class="pl-s">"@pybind11_bazel//:pybind11.BUILD"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11-&lt;stable-version&gt;"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11/archive/v&lt;stable-version&gt;.tar.gz"</span>],
)
<span class="pl-en">load</span>(<span class="pl-s">"@pybind11_bazel//:python_configure.bzl"</span>, <span class="pl-s">"python_configure"</span>)
<span class="pl-en">python_configure</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"local_config_python"</span>)</pre></div>
<p dir="auto">Then, in your <code>BUILD</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@pybind11_bazel//:build_defs.bzl&quot;, &quot;pybind_extension&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@pybind11_bazel//:build_defs.bzl"</span>, <span class="pl-s">"pybind_extension"</span>)</pre></div>
<h2 dir="auto"><a id="user-content-hermetic-python" class="anchor" aria-hidden="true" href="#hermetic-python"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Hermetic Python</h2>
<p dir="auto">To configure <code>pybind11_bazel</code> for hermetic Python, <code>python_configure</code> can take
the target providing the Python runtime as an argument:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="python_configure(
  name = &quot;local_config_python&quot;,
  python_interpreter_target = &quot;@python_interpreter//:python_bin&quot;,
)"><pre><span class="pl-en">python_configure</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"local_config_python"</span>,
  <span class="pl-s1">python_interpreter_target</span> <span class="pl-c1">=</span> <span class="pl-s">"@python_interpreter//:python_bin"</span>,
)</pre></div>
<h2 dir="auto"><a id="user-content-bzlmod" class="anchor" aria-hidden="true" href="#bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bzlmod</h2>
<p dir="auto">In your <code>MODULE.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="python_configure = use_extension(&quot;@pybind11_bazel//:python_configure.bzl&quot;, &quot;extension&quot;)
use_repo(python_configure, &quot;local_config_python&quot;, &quot;pybind11&quot;)"><pre><span class="pl-s1">python_configure</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@pybind11_bazel//:python_configure.bzl"</span>, <span class="pl-s">"extension"</span>)
<span class="pl-en">use_repo</span>(<span class="pl-s1">python_configure</span>, <span class="pl-s">"local_config_python"</span>, <span class="pl-s">"pybind11"</span>)</pre></div>
<p dir="auto">The <code>toolchain</code> tag can only be used by the root module (that is, not by a
module which is being used as a dependency) to set <code>python_version</code> or
<code>python_interpreter_target</code>. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="python_configure = use_extension(&quot;@pybind11_bazel//:python_configure.bzl&quot;, &quot;extension&quot;)
python_configure.toolchain(python_version = &quot;3&quot;)
use_repo(python_configure, &quot;local_config_python&quot;, &quot;pybind11&quot;)"><pre><span class="pl-s1">python_configure</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@pybind11_bazel//:python_configure.bzl"</span>, <span class="pl-s">"extension"</span>)
<span class="pl-s1">python_configure</span>.<span class="pl-en">toolchain</span>(<span class="pl-s1">python_version</span> <span class="pl-c1">=</span> <span class="pl-s">"3"</span>)
<span class="pl-en">use_repo</span>(<span class="pl-s1">python_configure</span>, <span class="pl-s">"local_config_python"</span>, <span class="pl-s">"pybind11"</span>)</pre></div>
<p dir="auto">Usage in your <code>BUILD</code> file is as described previously.</p>
</article></div>