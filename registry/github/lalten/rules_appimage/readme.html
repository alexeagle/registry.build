<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 id="user-content-rules_appimage" dir="auto"><a class="heading-link" href="#rules_appimage">rules_appimage<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1>
<p dir="auto"><a href="https://github.com/lalten/rules_appimage/actions"><img src="https://camo.githubusercontent.com/a914bca7b775d40558085dc6b55fda13b64a3e76db3f7289006467965f2b8cc5/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f616374696f6e732f776f726b666c6f772f7374617475732f6c616c74656e2f72756c65735f617070696d6167652f63692e79616d6c3f6272616e63683d6d61696e" alt="CI status" data-canonical-src="https://img.shields.io/github/actions/workflow/status/lalten/rules_appimage/ci.yaml?branch=main" style="max-width: 100%;"></a>
<a href="https://github.com/lalten/rules_appimage/blob/main/LICENSE"><img src="https://camo.githubusercontent.com/03c37d51ec0b993cd72be0bf23a0e51a8928ce2d1038382a4a9647920c533874/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6c616c74656e2f72756c65735f617070696d616765" alt="MIT License" data-canonical-src="https://img.shields.io/github/license/lalten/rules_appimage" style="max-width: 100%;"></a>
<a href="https://awesomebazel.com/" rel="nofollow"><img src="https://camo.githubusercontent.com/64f8905651212a80869afbecbf0a9c52a5d1e70beab750dea40a994fa9a9f3c6/68747470733a2f2f617765736f6d652e72652f62616467652e737667" alt="Awesome" data-canonical-src="https://awesome.re/badge.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><code>rules_appimage</code> provides a <a href="https://bazel.build/" rel="nofollow">Bazel</a> rule for packaging existing binary targets into <a href="https://github.com/AppImage/AppImageKit">AppImage</a> packages.</p>
<p dir="auto">AppImages are a great match for Bazel because the runfiles structure and launcher stub (where applicable) can be packaged into an AppRun structure relatively easily.
No application source modifications are required.
No existing Bazel targets have to be modified.</p>
<p dir="auto">The <code>appimage</code> rule has been used successfully with <code>py_binary</code>, <code>ruby_binary</code>, <code>sh_binary</code>, and <code>cc_binary</code>.
In fact, any <em>lang</em>_binary should be compatible.</p>
<h2 id="user-content-getting-started" dir="auto"><a class="heading-link" href="#getting-started">Getting Started<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-installation" dir="auto"><a class="heading-link" href="#installation">Installation<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">See the <a href="https://github.com/lalten/rules_appimage/releases/latest">latest release notes</a> for a snippet to add to your <code>WORKSPACE</code>, or use the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

RULES_APPIMAGE_VER = &quot;1.2.0&quot;

http_archive(
    name = &quot;rules_appimage&quot;,
    # sha256 = &quot;&quot;,  # FIXME: Bazel will print the proper value to add here during the first build.
    strip_prefix = &quot;rules_appimage-{}&quot;.format(RULES_APPIMAGE_VER),
    url = &quot;https://github.com/lalten/rules_appimage/archive/refs/tags/v{}.tar.gz&quot;.format(RULES_APPIMAGE_VER),
)

load(&quot;@rules_appimage//:deps.bzl&quot;, &quot;rules_appimage_deps&quot;)

rules_appimage_deps()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-v">RULES_APPIMAGE_VER</span> <span class="pl-c1">=</span> <span class="pl-s">"1.2.0"</span>

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_appimage"</span>,
    <span class="pl-c"># sha256 = "",  # FIXME: Bazel will print the proper value to add here during the first build.</span>
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_appimage-{}"</span>.<span class="pl-en">format</span>(<span class="pl-v">RULES_APPIMAGE_VER</span>),
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/lalten/rules_appimage/archive/refs/tags/v{}.tar.gz"</span>.<span class="pl-en">format</span>(<span class="pl-v">RULES_APPIMAGE_VER</span>),
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_appimage//:deps.bzl"</span>, <span class="pl-s">"rules_appimage_deps"</span>)

<span class="pl-en">rules_appimage_deps</span>()</pre></div>
<h3 id="user-content-usage" dir="auto"><a class="heading-link" href="#usage">Usage<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">To package a binary target into an AppImage, you add a <code>appimage</code> rule and point it at the target.
So in your <code>BUILD</code> files you do:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_appimage//appimage:appimage.bzl&quot;, &quot;appimage&quot;)

appimage(
    name = &quot;program.appimage&quot;,
    binary = &quot;:program&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_appimage//appimage:appimage.bzl"</span>, <span class="pl-s">"appimage"</span>)

<span class="pl-en">appimage</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"program.appimage"</span>,
    <span class="pl-s1">binary</span> <span class="pl-c1">=</span> <span class="pl-s">":program"</span>,
)</pre></div>
<p dir="auto">There is also a <code>appimage_test</code> rule that takes the same arguments but runs the appimage as a Bazel test target.</p>
<h2 id="user-content-how-to-use-the-appimage" dir="auto"><a class="heading-link" href="#how-to-use-the-appimage">How to use the appimage<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-via-bazel" dir="auto"><a class="heading-link" href="#via-bazel">Via Bazel<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">You can <code>bazel run</code> AppImages directly:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="❯ bazel run -- //tests:appimage_py
(...)
Hello, world!"><pre>❯ bazel run -- //tests:appimage_py
(...)
Hello, world<span class="pl-k">!</span></pre></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="❯ bazel run -- //tests:appimage_py --name TheAssassin
(...)
Hello, TheAssassin!"><pre>❯ bazel run -- //tests:appimage_py --name TheAssassin
(...)
Hello, TheAssassin<span class="pl-k">!</span></pre></div>
<h3 id="user-content-directly" dir="auto"><a class="heading-link" href="#directly">Directly<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The resulting AppImage file is a portable standalone executable (which is kind of the point of the whole thing!)</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="❯ file bazel-bin/tests/appimage_py
bazel-bin/tests/appimage_py: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, stripped

❯ bazel-bin/tests/appimage_py --name GitHub
Hello, GitHub!"><pre>❯ file bazel-bin/tests/appimage_py
bazel-bin/tests/appimage_py: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, stripped

❯ bazel-bin/tests/appimage_py --name GitHub
Hello, GitHub<span class="pl-k">!</span></pre></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="❯ rsync bazel-bin/tests/appimage_py my-server:. &amp;&amp; ssh my-server ./appimage_py
Hello, world!"><pre>❯ rsync bazel-bin/tests/appimage_py my-server:. <span class="pl-k">&amp;&amp;</span> ssh my-server ./appimage_py
Hello, world<span class="pl-k">!</span></pre></div>
<h3 id="user-content-appimage-cli-args" dir="auto"><a class="heading-link" href="#appimage-cli-args">AppImage CLI args<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">There are certain <a href="https://github.com/AppImage/AppImageKit#command-line-arguments">AppImage CLI args</a>.
They'll still work. Try <code>--appimage-help</code>.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="❯ bazel run -- //tests:appimage_py --appimage-version
(...)
AppImage runtime version: https://github.com/lalten/type2-runtime/releases/tag/build-2022-10-03-c5c7b07"><pre>❯ bazel run -- //tests:appimage_py --appimage-version
(...)
AppImage runtime version: https://github.com/lalten/type2-runtime/releases/tag/build-2022-10-03-c5c7b07</pre></div>
<h2 id="user-content-troubleshooting" dir="auto"><a class="heading-link" href="#troubleshooting">Troubleshooting<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-pwd-is-a-read-only-file-system" dir="auto"><a class="heading-link" href="#pwd-is-a-read-only-file-system"><code>$PWD</code> is a <code>Read-only file system</code><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">When the AppImage is run, it will mount contained the SquashFS image via FUSE as read-only file system.</p>
<p dir="auto">If this causes problems, you can:</p>
<ul dir="auto">
<li>Write to <code>$BUILD_WORKING_DIRECTORY</code> instead, which is set by Bazel when running <code>bazel run</code>, and set by <code>rules_appimage</code> when running as pure AppImage.</li>
<li>Set the <code>APPIMAGE_EXTRACT_AND_RUN</code> env var or pass the <code>--appimage-extract-and-run</code> CLI arg to extract the AppImage into a temporary directory and run it from there.</li>
</ul>
<h3 id="user-content-missing-fusermount" dir="auto"><a class="heading-link" href="#missing-fusermount">Missing <code>fusermount</code><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">rules_appimage builds <code>type-2 AppImages</code> using a statically-linked appimage runtime.
The only runtime dependency is either <code>fusermount</code> (from fuse2) or <code>fusermount3</code> (from fuse3).
If neither is not available, you'll get an error like this:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="fuse: failed to exec fusermount3: No such file or directory

Cannot mount AppImage, please check your FUSE setup.
You might still be able to extract the contents of this AppImage
if you run it with the --appimage-extract option.
See https://github.com/AppImage/AppImageKit/wiki/FUSE
for more information
open dir error: No such file or directory"><pre>fuse: failed to <span class="pl-c1">exec</span> fusermount3: No such file or directory

Cannot mount AppImage, please check your FUSE setup.
You might still be able to extract the contents of this AppImage
<span class="pl-k">if</span> you run it with the --appimage-extract option.
See https://github.com/AppImage/AppImageKit/wiki/FUSE
<span class="pl-k">for</span> more information
open dir error: No such file or directory</pre></div>
<p dir="auto">In this case, you can:</p>
<ul dir="auto">
<li>Install <a href="https://pkgs.org/search/?q=libfuse3" rel="nofollow">libfuse3</a>: <code>sudo apt install libfuse3</code></li>
<li>Run the application with <code>--appimage-extract-and-run</code> as the first command-line argument.</li>
<li>Set the <code>APPIMAGE_EXTRACT_AND_RUN</code> environment variable.</li>
</ul>
<p dir="auto">The latter two options will cause the appimage to extract the files instead of mounting them directly.
This may take slightly longer and consume more disk space.</p>
<h3 id="user-content-missing-runtime-deps" dir="auto"><a class="heading-link" href="#missing-runtime-deps">Missing runtime deps<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The AppImage will only be as portable/hermetic/reproducible as the rest of your Bazel build is.</p>
<p dir="auto">Example: Without a hermetic Python toolchain your target will use the system's Python interpreter.
If your program needs Python &gt;=3.8 but you run the appimage on a host that uses Python 3.6 by default, you might get an error like this:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="  File &quot;/tmp/appimage_extracted_544993ad2a5919e445b618f1fe009e53/test_py.runfiles/rules_appimage/tests/test.py&quot;, line 10
    assert (s := DATA_DEP.stat().st_size) == 591, f&quot;{DATA_DEP} has wrong size {s}&quot;
              ^
SyntaxError: invalid syntax"><pre>  File <span class="pl-s"><span class="pl-pds">"</span>/tmp/appimage_extracted_544993ad2a5919e445b618f1fe009e53/test_py.runfiles/rules_appimage/tests/test.py<span class="pl-pds">"</span></span>, line 10
    assert (s := <span class="pl-en">DATA_DEP.stat</span>().st_size) == 591, f<span class="pl-s"><span class="pl-pds">"</span>{DATA_DEP} has wrong size {s}<span class="pl-pds">"</span></span>
              ^
SyntaxError: invalid syntax</pre></div>
<p dir="auto">Check <a href="https://thundergolfer.com/bazel/python/2021/06/25/a-basic-python-bazel-toolchain/" rel="nofollow">https://thundergolfer.com/bazel/python/2021/06/25/a-basic-python-bazel-toolchain/</a> if you would like to know more.</p>
<h3 id="user-content-something-isnt-right-about-my-appimage-how-can-i-debug" dir="auto"><a class="heading-link" href="#something-isnt-right-about-my-appimage-how-can-i-debug">Something isn't right about my appimage, how can I debug?<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">An easy way to understand what is happening inside the appimage is to run the application with the <code>--appimage-extract</code> cli arg.
This will extract the bundled squashfs blob into a <code>squashfs-root</code> dir in the current working directory.</p>
<p dir="auto">You can look at those files and see exactly what's going on.
In fact, you can even run <code>squashfs-root/AppRun</code> and it will run exactly the same as with the packaged appimage.
This can be very handy when rebuilding the Bazel target is not the best option but you need to modify a file inside.</p>
<h2 id="user-content-contributing" dir="auto"><a class="heading-link" href="#contributing">Contributing<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Issue reports and pull requests are welcome.</p>
<p dir="auto">Please test your changes:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel test //..."><pre>bazel <span class="pl-c1">test</span> //...</pre></div>
<p dir="auto">And run the <a href=".github/workflows/ci.yaml">linters/formatters</a>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="trunk check
trunk fmt"><pre>trunk check
trunk fmt</pre></div>
</article></div>