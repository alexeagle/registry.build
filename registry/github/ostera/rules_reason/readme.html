<div id="readme" class="rst" data-path="README.rst"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-reasonml--bucklescript-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#reasonml--bucklescript-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>ReasonML / BuckleScript Rules</h1>
<a href="https://travis-ci.org/ostera/rules_reason" rel="nofollow"><img alt="https://travis-ci.org/ostera/rules_reason.svg?branch=master" src="https://camo.githubusercontent.com/b56361beb7ccdb2fdc84cd67a61e2a6b4be14b4ffd6242ae2e7364f1e18f6834/68747470733a2f2f7472617669732d63692e6f72672f6f73746572612f72756c65735f726561736f6e2e7376673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/ostera/rules_reason.svg?branch=master" style="max-width: 100%;"></a>
<p dir="auto">A collection of OCaml, ReasonML, and BuckleScript rules and tools for Bazel.</p>
<blockquote>
Note: this is alpha software! I'm building it to properly integrate a ReasonML
application into a bigger project that builds with Bazel.</blockquote>
<p dir="auto">This projet relies on two prerequisites:</p>
<ol dir="auto">
<li><code>nix</code>, the purely functional package manager, which is used for installing the ReasonML tooling (<code>refmt</code> specifically), <code>opam</code>, <code>yarn</code> and <code>node</code> in an hermetic-ish fashion. At least you don't need to handle those yourself :)</li>
<li><code>bazel</code>, naturally.</li>
</ol>
<p dir="auto">If you just cloned this repo and you have both those tools installed, feel free
to start with a <code>bazel build //...</code> to get everything warmed up.</p>
<p dir="auto">The examples works a separate workspace so you will need to run <code>bazel build //...</code>
there as well if you wish to play around with them.</p>
<blockquote>
WARNING: because this rules handle all of their dependencies hermetically, a
clean install takes a good ~10 minutes on an early 2015 Macbook Pro.</blockquote>
<div id="user-content-contents" dir="auto">
<p dir="auto">Contents</p>
<ul dir="auto">
<li><a href="#getting-started" id="user-content-id1">Getting Started</a><ul dir="auto">
<li><a href="#compiling-to-javascript" id="user-content-id2">Compiling to Javascript</a></li>
<li><a href="#compiling-to-native-and-bytecode" id="user-content-id3">Compiling to Native and Bytecode</a></li>
</ul>
</li>
<li><a href="#what-s-next" id="user-content-id4">What's next?</a></li>
<li><a href="#rules" id="user-content-id5">Rules</a><ul dir="auto">
<li><a href="#reason-module" id="user-content-id6"><code>reason_module</code></a></li>
<li><a href="#bs-module" id="user-content-id7"><code>bs_module</code></a></li>
<li><a href="#ocaml-native-binary-and-ocaml-bytecode-binary" id="user-content-id8"><code>ocaml_native_binary</code> and <code>ocaml_bytecode_binary</code></a></li>
</ul>
</li>
<li><a href="#toolchain" id="user-content-id9">Toolchain</a></li>
<li><a href="#providers" id="user-content-id10">Providers</a><ul dir="auto">
<li><a href="#reasonmoduleinfo" id="user-content-id11"><code>ReasonModuleInfo</code></a></li>
<li><a href="#bsmoduleinfo" id="user-content-id12"><code>BsModuleInfo</code></a></li>
<li><a href="#mlmoduleinfo" id="user-content-id13"><code>MlModuleInfo</code></a></li>
</ul>
</li>
</ul>
</div>
<a name="user-content-getting-started"></a>
<h2 dir="auto"><a id="user-content-getting-started" class="anchor" aria-hidden="true" tabindex="-1" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id1">Getting Started</a></h2>
<p dir="auto">Begin by adding the following to your <code>WORKSPACE</code>:</p>
<pre lang="bzl">workspace(name = "retool")

###
### Reason Rules!
###

rules_reason_version = "f8b956b147bfcf22c90480e7ebea32e6769c1fe0" # HEAD

http_archive(
    name = "com_github_ostera_rules_reason",
    sha256 = "",
    strip_prefix = "rules_reason-%s" % (rules_reason_version,),
    urls = ["https://github.com/ostera/rules_reason/archive/%s.zip" % (rules_reason_version,)],
    )

###
### Nix Repositories
###

load(
    "@com_github_ostera_rules_reason//reason/repositories:nix.bzl",
    "nix_repositories",
)

nix_repositories(
    nix_sha256 = "28121f6eb3d6c5b4c1fc9f716953ce8b0a793b841d0e9de095977b3ade06f92d",
    nix_version = "20a78f74f8ac70d1099ff0d214cd00b25820da03",
)

###
### Register Reason Toolchain
###

load(
    "@com_github_ostera_rules_reason//reason:def.bzl",
    "reason_register_toolchains",
)

reason_register_toolchains(
    bs_sha256 = "db3f37eb27bc1653c3045e97adaa83e800dff55ce093d78ddfe85e85165e2125",
    bs_version = "939ef1e1e874c80ff9df74b16dab1dbe2e2df289",
    nixpkgs_revision = "d91a8a6ece07f5a6df82aa5dc02030d9c6724c27",
    nixpkgs_sha256 = "0c5291bcf7d909cc4b18a24effef03f717d6374de377f91324725c646d494857",
)

################################################################################
#
#   Declare dependencies
#
################################################################################

load(
    "//3rdparty:load.bzl",
    "declare_dependencies"
)

declare_dependencies()
</pre>
<p dir="auto">Use <code>reason_module</code> to compile a group of <code>.re</code> and <code>.rei</code> files into their
corresponding <code>.ml</code> and <code>.mli</code> counterparts.</p>
<p dir="auto">Further consume these outputs with <code>ocaml_module</code>, <code>bs_module</code>,
<code>ocaml_bytecode_binary</code>, or <code>ocaml_native_binary</code>.</p>
<a name="user-content-compiling-to-javascript"></a>
<h3 dir="auto"><a id="user-content-compiling-to-javascript" class="anchor" aria-hidden="true" tabindex="-1" href="#compiling-to-javascript"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id2">Compiling to Javascript</a></h3>
<p dir="auto">You can use <code>bs_module</code> to turn any ML source target into Javascript, this
includes the outputs from a <code>reason_module</code> rule too.</p>
<p dir="auto">Unfortunately <code>bsc</code> requires a <code>bsconfig.json</code> file at the place where you call
it. This means that you need to have that file at the root of your project.</p>
<pre lang="bzl"># BUILD file at //...
filegroup(
  name = "bsconfig",
  srcs = ["bsconfig.json"],
)

# BUILD file somewhere in your sources!
reason_module(
  name = "srcs.re",
  srcs = glob(["*.re"]),
)

bs_module(
  name = "srcs.js",
  config = ["//:bsconfig"],
  srcs = [":srcs.re"],
  deps = [":deps"],
)
</pre>
<a name="user-content-compiling-to-native-and-bytecode"></a>
<h3 dir="auto"><a id="user-content-compiling-to-native-and-bytecode" class="anchor" aria-hidden="true" tabindex="-1" href="#compiling-to-native-and-bytecode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id3">Compiling to Native and Bytecode</a></h3>
<p dir="auto">You can use <code>ocaml_native_binary</code> and <code>ocaml_bytecode_binary</code> to compile your
ML sources into native or bytecode binaries, and yes you can use your
<code>reason_module</code> targets as sources!</p>
<pre lang="bzl"># BUILD file somewhere in your sources!
reason_module(
    name = "srcs",
    srcs = glob(["*.re"]),
    )

ocaml_native_binary(
    name = "native",
    srcs = [":srcs"],
  )

ocaml_bytecode_binary(
    name = "bytecode",
    srcs = [":srcs"],
  )
</pre>
<a name="user-content-what-s-next"></a>
<h2 dir="auto"><a id="user-content-whats-next" class="anchor" aria-hidden="true" tabindex="-1" href="#whats-next"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id4">What's next?</a></h2>
<p dir="auto">In no particular order:</p>
<ol dir="auto">
<li>DevFlow: Top-Level</li>
<li>DevFlow: Dependencies</li>
<li>DevFlow: Generating Merlin and pointing IDEs to the right places</li>
<li>Rules: <code>*_test</code></li>
<li>DevFlow: Auto-rebuild</li>
<li>Rules: <code>node_binary</code></li>
<li>&lt; your suggestion here! &gt;</li>
</ol>
<a name="user-content-rules"></a>
<h2 dir="auto"><a id="user-content-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id5">Rules</a></h2>
<a name="user-content-reason-module"></a>
<h3 dir="auto"><a id="user-content-reason_module" class="anchor" aria-hidden="true" tabindex="-1" href="#reason_module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id6"><code>reason_module</code></a></h3>
<p dir="auto">This compiles down ReasonML code into a representation that is friendly for
BuckleScript or the default Ocaml compiler.</p>
<p dir="auto">Which one will it be compatible with is determined by how you write your
ReasonML code.</p>
<table>





<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
<td><strong>Default value</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3">A unique name for this rule.</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>string_list</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3"><p dir="auto">The sources of this library.</p>
<p dir="auto">The name of the sources will be preserved, and the outputs will replace the <code>.re</code> or <code>.rei</code>
extension with <code>.ml</code> or <code>.mli</code> correspondingly.</p>
<p dir="auto">Other <code>bs_module</code> rules can depend on this library to compile it down to Javascript code.</p>
</td>
</tr>
<tr><td><kbd>toolchain</kbd></td>
<td><em>label</em></td>
<td><table frame="void" rules="none">


<tbody valign="top">
<tr><th>value:</th><td>"//reason/toolchain:bs-platform"</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="3"><p dir="auto">The toolchain to use when building this rule.</p>
<p dir="auto">It should include both <code>refmt</code>, <code>bsc</code> and a filegroup containing the BuckleScript stdlib.</p>
</td>
</tr>
</tbody>
</table>
<p dir="auto">Example:</p>
<pre lang="bzl"># //my_app/BUILD
load(
    "@com_github_ostera_rules_reason//reason:def.bzl",
    "reason_module",
)

reason_module(
    name = "my_app",
    srcs = glob(["*.re", "*.rei"])
    visibility = ["//my_app:__subpackages__"],
  )
</pre>
<a name="user-content-bs-module"></a>
<h3 dir="auto"><a id="user-content-bs_module" class="anchor" aria-hidden="true" tabindex="-1" href="#bs_module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id7"><code>bs_module</code></a></h3>
<p dir="auto">Compile Ocaml code into Javascript.</p>
<table>





<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
<td><strong>Default value</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3">A unique name for this rule.</td>
</tr>
<tr><td><kbd>config</kbd></td>
<td><em>label</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3"><p dir="auto">The <code>bsconfig.json</code> file.</p>
<p dir="auto">The file must be located at the root of your WORKSPACE. Currently looking to work around this.</p>
</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>string_list</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3"><p dir="auto">The ML sources of this library.</p>
<p dir="auto">The name of the sources will be preserved, and the outputs will replace the <code>.ml</code> by their
compilation counterparts (<code>.cmi</code>, <code>.cmj</code>, <code>.cmt</code>, etc) and the <code>.js</code> output.</p>
<p dir="auto">Other <code>bs_module</code> rules can depend on this library to compile it down to Javascript code.</p>
</td>
</tr>
<tr><td><kbd>deps</kbd></td>
<td><em>label_list</em></td>
<td><table frame="void" rules="none">


<tbody valign="top">
<tr><th>value:</th><td>[]</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="3">Dependencies of this library, must include <code>BsModuleInfo</code> providers.</td>
</tr>
<tr><td><kbd>toolchain</kbd></td>
<td><em>label</em></td>
<td><table frame="void" rules="none">


<tbody valign="top">
<tr><th>value:</th><td>"//reason/toolchain:bs-platform"</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="3"><p dir="auto">The toolchain to use when building this rule.</p>
<p dir="auto">It should include both <code>refmt</code>, <code>bsc</code> and a filegroup containing the BuckleScript stdlib.</p>
</td>
</tr>
</tbody>
</table>
<p dir="auto">Example:</p>
<pre lang="bzl">load(
    "@com_github_ostera_rules_reason//reason:def.bzl",
    "reason_module",
    "bs_module"
)

reason_module(
    name = "my_app",
    srcs = glob(["*.re", "*.rei"]),
    )

bs_module(
    visibility = ["//examples/app:__subpackages__"],
    name = "my_app.js",
    config = "//:bs_config",
    srcs = [ ":my_app" ],
    deps = [ "//examples/some/dependency" ],
    )
</pre>
<a name="user-content-ocaml-native-binary-and-ocaml-bytecode-binary"></a>
<h3 dir="auto"><a id="user-content-ocaml_native_binary-and-ocaml_bytecode_binary" class="anchor" aria-hidden="true" tabindex="-1" href="#ocaml_native_binary-and-ocaml_bytecode_binary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id8"><code>ocaml_native_binary</code> and <code>ocaml_bytecode_binary</code></a></h3>
<p dir="auto">Compile ML code into bytecode or native binaries. For bytecode binaries it will
copmile them including the runtime, rather than separately. This is something
that I'd like to change in the future.</p>
<table>





<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
<td><strong>Default value</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3">A unique name for this rule, used as the name of the output binary</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>string_list</em></td>
<td><strong>mandatory value</strong></td>
</tr>
<tr><td colspan="3">The ML sources of this library.</td>
</tr>
<tr><td><kbd>deps</kbd></td>
<td><em>label_list</em></td>
<td><table frame="void" rules="none">


<tbody valign="top">
<tr><th>value:</th><td>[]</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="3">Dependencies of this library, must include <code>ReasonModuleInfo</code> providers.</td>
</tr>
<tr><td><kbd>toolchain</kbd></td>
<td><em>label</em></td>
<td><table frame="void" rules="none">


<tbody valign="top">
<tr><th>value:</th><td>"//reason/toolchain:bs-platform"</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="3"><p dir="auto">The toolchain to use when building this rule.</p>
<p dir="auto">It should include both <code>ocamlc</code>, <code>ocamlopt</code>, <code>ocamldep</code>, <code>ocamlrun</code>,  and a filegroup
containing the Ocaml stdlib.</p>
</td>
</tr>
</tbody>
</table>
<p dir="auto">Example:</p>
<pre lang="bzl">load(
    "@com_github_ostera_rules_reason//reason:def.bzl",
    "reason_module",
    "ocaml_native_binary",
)

# BUILD file somewhere in your sources!
reason_module(
    name = "srcs",
    srcs = glob(["*.re"]),
    )

# replace native with bytecode in the rule name and you get a bytecode binary
ocaml_native_binary(
    name = "my_bin_name",
    srcs = [":srcs"],
  )
</pre>
<a name="user-content-toolchain"></a>
<h2 dir="auto"><a id="user-content-toolchain" class="anchor" aria-hidden="true" tabindex="-1" href="#toolchain"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id9">Toolchain</a></h2>
<p dir="auto">There is a ToolchainInfo that describes the fields required throughout the build
rules to successfully compile from ReasonML down to Javascript.</p>
<p dir="auto">Feel free to register your own toolchain or use the default toolchain
that will be managed completely within Bazel.</p>
<table>




<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
</tr>
<tr><td><kbd>bsc</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The BuckleScript compiler file.</td>
</tr>
<tr><td><kbd>refmt</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The ReasonML Formatter file.</td>
</tr>
<tr><td><kbd>bs_stdlib</kbd></td>
<td><em>Filegroup</em></td>
</tr>
<tr><td colspan="2">A Filegroup with all the source and compiled files for the BuckleScript
standard library that will be used for compiling Ocaml into Javascript</td>
</tr>
<tr><td><kbd>ocamlc</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The Ocaml bytecode compiler.</td>
</tr>
<tr><td><kbd>ocamlopt</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The Ocaml native compiler.</td>
</tr>
<tr><td><kbd>ocamldep</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The Ocaml dependency tool.</td>
</tr>
<tr><td><kbd>ocamlrun</kbd></td>
<td><em>File</em></td>
</tr>
<tr><td colspan="2">The Ocaml bytecode interpreter.</td>
</tr>
<tr><td> </td>
<td> </td>
</tr>
<tr><td><kbd>ocaml_stdlib</kbd></td>
<td><em>Filegroup</em></td>
</tr>
<tr><td colspan="2">A Filegroup with Ocaml standard library.</td>
</tr>
</tbody>
</table>
<a name="user-content-providers"></a>
<h2 dir="auto"><a id="user-content-providers" class="anchor" aria-hidden="true" tabindex="-1" href="#providers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id10">Providers</a></h2>
<p dir="auto">There are 2 providers included, that will carry information for the different
stages of the build process.</p>
<a name="user-content-reasonmoduleinfo"></a>
<h3 dir="auto"><a id="user-content-reasonmoduleinfo" class="anchor" aria-hidden="true" tabindex="-1" href="#reasonmoduleinfo"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id11"><code>ReasonModuleInfo</code></a></h3>
<p dir="auto">This provider is the output of the <code>reason_module</code> rule, and it represents a
compilation unit from ReasonML to Ocaml.</p>
<table>




<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
</tr>
<tr><td colspan="2">The name of your the colletion of files</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the ReasonML files that will be compiled to ML</td>
</tr>
<tr><td><kbd>outs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the target ML files that will be generated</td>
</tr>
</tbody>
</table>
<a name="user-content-bsmoduleinfo"></a>
<h3 dir="auto"><a id="user-content-bsmoduleinfo" class="anchor" aria-hidden="true" tabindex="-1" href="#bsmoduleinfo"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id12"><code>BsModuleInfo</code></a></h3>
<p dir="auto">This provider is the output of the <code>bs_module</code> rule, and it represents a
compilation unit from Ocaml to Javascript.</p>
<table>




<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
</tr>
<tr><td colspan="2">The name of your the colletion of files</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the Ocaml files that will be compiled to Javascript</td>
</tr>
<tr><td><kbd>outs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the target ML and Js files that will be generated</td>
</tr>
<tr><td><kbd>deps</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the BuckleScript modules files that the <code>srcs</code> depend
on</td>
</tr>
</tbody>
</table>
<a name="user-content-mlmoduleinfo"></a>
<h3 dir="auto"><a id="user-content-mlmoduleinfo" class="anchor" aria-hidden="true" tabindex="-1" href="#mlmoduleinfo"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="#id13"><code>MlModuleInfo</code></a></h3>
<p dir="auto">This provider is the output of the <code>bs_module</code> rule, and it represents a
compilation unit from Ocaml to Javascript.</p>
<table>




<tbody valign="top">
<tr><td><strong>Name</strong></td>
<td><strong>Type</strong></td>
</tr>
<tr><td><kbd>name</kbd></td>
<td><em>string</em></td>
</tr>
<tr><td colspan="2">The name of your the colletion of files</td>
</tr>
<tr><td><kbd>srcs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the Ocaml files that will to be compiled.</td>
</tr>
<tr><td><kbd>outs</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the target binary files.</td>
</tr>
<tr><td><kbd>deps</kbd></td>
<td><em>depset(File)</em></td>
</tr>
<tr><td colspan="2">A <code>depset</code> of all the Ocaml modules files that the <code>srcs</code> depend
on</td>
</tr>
<tr><td><kbd>target</kbd></td>
<td><em>"native" | "bytecode"</em></td>
</tr>
<tr><td colspan="2">Whether this module is being compiled natively or as bytecode.</td>
</tr>
</tbody>
</table>

</article></div>