<div id="readme" class="org" data-path="README.org"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel rules for Emacs Lisp</h1><a id="user-content-bazel-rules-for-emacs-lisp" class="anchor-element" aria-label="Permalink: Bazel rules for Emacs Lisp" href="#bazel-rules-for-emacs-lisp"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">#</p>
<p dir="auto">#</p>
<p dir="auto">#</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Introduction</h1><a id="user-content-introduction" class="anchor-element" aria-label="Permalink: Introduction" href="#introduction"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This repository provides a Bazel integration for Emacs Lisp; see
  <a href="https://bazel.build/" rel="nofollow">the Bazel homepage</a> for more information about Bazel,
  and see the Emacs Lisp manual.  It is modeled after the
  rules definitions for other languages, like the
  <a href="https://bazel.build/reference/be/c-cpp" rel="nofollow">C++ rules</a>.</p>
<p dir="auto">This is not an officially supported Google product.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Requirements</h1><a id="user-content-requirements" class="anchor-element" aria-label="Permalink: Requirements" href="#requirements"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use <code>rules_elisp</code>, you need <a href="https://bazel.build/" rel="nofollow">Bazel</a>.  For
  installation instructions, see <a href="https://bazel.build/install" rel="nofollow">Installing
  Bazel</a>.  This repository supports all full Bazel releases starting with Bazel
  5.4.0.  You’ll also need a recent C/C++ compiler (GCC or Clang on GNU/Linux and
  macOS, Visual C++ 2019 on Windows) and at least Python 3.10.  For further
  instructions how to use Bazel on Windows, see
  <a href="https://bazel.build/install/windows" rel="nofollow">Installing Bazel on Windows</a>.  On
  Windows, you’ll also need MinGW-w64 and MSYS2 to build Emacs; see the file
  <code>nt/INSTALL.W64</code> in the Emacs source repository.</p>
<p dir="auto">This repository generally supports the two most recent major versions of Emacs.
  Currently, the supported versions are Emacs 28 and Emacs 29.  Once Emacs 30 is
  released, support for Emacs 28 will be dropped.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Usage</h1><a id="user-content-usage" class="anchor-element" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you’re using Bzlmod, add a snippet like the following to your <code>MODULE.bazel</code>
  file:</p>
<pre lang="bazel-module">bazel_dep(name = "phst_rules_elisp")
git_override(
    module_name = "phst_rules_elisp",
    remote = "https://github.com/phst/rules_elisp.git",
    commit = "30e571b6e69be2dcc782325834792d79c245d30d",
)
</pre>
<p dir="auto">See <a href="https://bazel.build/external/overview#bzlmod" rel="nofollow">the Bzlmod documentation</a>
  for background information.  Due to various Bzlmod-related bugs in older Bazel
  versions, this approach requires at least Bazel 6.3.</p>
<p dir="auto">Alternatively, if you’re not using Bzlmod, add a snippet like the following to
  your Bazel <code>WORKSPACE</code> file:</p>
<pre lang="bazel-workspace">load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
    name = "phst_rules_elisp",
    integrity = "sha384-QVJcZ4h8j8t9fjaddWCGssqBjUexRReKR53Th9XG1xPYXN/2eiWP1Is5pIfElsA5",
    strip_prefix = "rules_elisp-30e571b6e69be2dcc782325834792d79c245d30d",
    urls = [
        "https://github.com/phst/rules_elisp/archive/30e571b6e69be2dcc782325834792d79c245d30d.zip",  # 2024-02-04
    ],
)

load(
    "@phst_rules_elisp//elisp:repositories.bzl",
    "rules_elisp_dependencies",
    "rules_elisp_toolchains",
)

rules_elisp_dependencies()

rules_elisp_toolchains()

load("@bazel_features//:deps.bzl", "bazel_features_deps")

bazel_features_deps()
</pre>
<p dir="auto">See <a href="https://bazel.build/external/overview#workspace-system" rel="nofollow">the Bazel
  documentation on WORKSPACE dependencies</a> for background information.  Since
  <code>rules_elisp</code> depends on <code>rules_python</code>, you’ll also need to add a dependency on
  the latter.  See
  <a href="https://rules-python.readthedocs.io/en/latest/getting-started.html#using-a-workspace-file" rel="nofollow">the
  <code>rules_python</code> documentation</a>.</p>
<p dir="auto">Then you can use the <code>elisp_library</code>, <code>elisp_binary</code>, and <code>elisp_test</code> rules.
  See <a href="*Symbols defined in =//emacs:defs.bzl=">*Symbols defined in =//emacs:defs.bzl=</a> and the examples in the
  <code>examples</code> directory for details.  Note that the C++ code used by <code>rules_elisp</code>
  requires at least C++17, but Bazel still compiles with C++11 by default.  See
  <a href="https://github.com/abseil/abseil-cpp/blob/master/FAQ.md#how-to-i-set-the-c-dialect-used-to-build-abseil">the
  Abseil FAQ</a> how to correctly change the C++ standard for your project.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Load path management</h1><a id="user-content-load-path-management" class="anchor-element" aria-label="Permalink: Load path management" href="#load-path-management"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The Emacs Lisp rules by default only add the repository root directories to the
  load path; see info:elisp#Library Search.  However, many Emacs Lisp
  libraries assume that their immediate parent directory is present in the load
  path.  To support such libraries, the <code>elisp_library</code> rule supports an optional
  <code>load_path</code> attribute.  You can specify additional load path directories using
  this attribute.  Relative directories are relative to the Bazel package
  directory; absolute directories are relative to the repository root.  A typical
  use case is to specify <code>load_path = ["."]</code> to add the current package to the
  load path.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Runfiles</h1><a id="user-content-runfiles" class="anchor-element" aria-label="Permalink: Runfiles" href="#runfiles"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This repository also includes a library to access runfiles; see
  <a href="https://bazel.build/extending/rules#runfiles" rel="nofollow">the Bazel documentation on
  runfiles</a>.  To use it, add a build dependency on
  <code>@phst_rules_elisp//elisp/runfiles</code>.</p>
<p dir="auto">Use the function <code>elisp/runfiles/rlocation</code> to map a runfile name to a
  filename in the local filesystem.  For more advanced use cases, see the
  class <code>elisp/runfiles/runfiles</code>.</p>
<p dir="auto">The library also provides a file name handler for runfiles,
  <code>elisp/runfiles/file-handler</code>.  It uses the prefix <code>/bazel-runfile:</code>.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Protocol buffers</h1><a id="user-content-protocol-buffers" class="anchor-element" aria-label="Permalink: Protocol buffers" href="#protocol-buffers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">By defining <code>elisp_proto_library</code> rules, you can use protocol buffers in Emacs
  Lisp; see <a href="https://developers.google.com/protocol-buffers" rel="nofollow">https://developers.google.com/protocol-buffers</a>.  To make a
  protocol buffer definition available to Emacs Lisp, you first need a
  <code>proto_library</code> rule; see
  <a href="https://bazel.build/reference/be/protocol-buffer#proto_library" rel="nofollow">https://bazel.build/reference/be/protocol-buffer#proto_library</a>.  You can
  either use an existing <code>proto_library</code> rule or add your own.  Then, add an
  <code>elisp_proto_library</code> rule that references the <code>proto_library</code> rule.  Normally,
  the name of the <code>proto_library</code> rule ends in <code>_proto</code>, and the name of the
  corresponding <code>elisp_proto_library</code> rule has the same prefix and ends in
  <code>_elisp_proto</code>.  For example:</p>
<pre lang="bazel-build">proto_library(
    name = "my_proto",
    srcs = ["my.proto"],
)
elisp_proto_library(
    name = "my_elisp_proto",
    deps = [":my_proto"],
)
</pre>
<p dir="auto">You can then use the <code>elisp_proto_library</code> rule in the same way as a normal
  <code>elisp_library</code> rule, i.e., depend on it in other <code>elisp_library</code>,
  <code>elisp_binary</code>, or <code>elisp_test</code> rules.  The name of the Emacs Lisp feature for
  the library consists of the package containing the <code>proto_library</code> rule and its
  name within the package, joined with a slash character (<code>/</code>).  For example, if
  the above BUILD file is in a package named <code>mypackage</code>, you would load the
  protocol buffer library using <code>(require 'mypackage/my_proto)</code>.</p>
<p dir="auto">Emacs Lisp protocol buffer bindings contain Emacs Lisp equivalents for all
  message and enumeration types defined in the underlying protocol buffer
  definition files.  Because Emacs Lisp doesn’t have namespaces, the names of all
  defined entities are the full names of the corresponding protocol buffer
  descriptors, including the protocol buffer package name (which is often
  different from the Bazel package name), but with dots (<code>.</code>) replaced with
  slashes (<code>/</code>), because dots are special characters in Emacs Lisp; see
  info:elisp#Symbol Type.  For example, the Lisp name of the protocol buffer
  message type <code>google.protobuf.Duration</code> is <code>google/protobuf/Duration</code>, and the
  Lisp name of the protocol buffer enumeration value
  <code>google.protobuf.FieldDescriptorProto.TYPE_BOOL</code> is
  <code>google/protobuf/FieldDescriptorProto/TYPE_BOOL</code>.</p>
<p dir="auto">When accessing protocol buffer message fields, Emacs translates field values to
  and from Lisp data types; see info:elisp#Programming Types.  For scalar
  types, the translation uses appropriate matching types, i.e., numbers and
  strings.  Boolean values are translated to either <code>nil</code> or <code>t</code>.  The <code>bytes</code>
  type is represented using unibyte strings; see &lt;a href=”info:elisp#Text
  Representations”&gt;info:elisp#Text
  Representations.  Accessing string and byte fields always creates copies; this
  means that changing the return value using <code>aset</code> will not modify the original
  protocol buffer message.</p>
<p dir="auto">The situation is a bit more complex for submessage fields, repeated fields, and
  map fields.  Emacs represents values of these fields using specialized types.
  For submessage fields, these types are again generated protocol buffer message
  types.  For repeated and map fields, Emacs uses the types <code>elisp/proto/array</code>
  and <code>elisp/proto/map</code>, respectively.  Message, array, and map objects can be
  mutable or immutable; attempting to modify an immutable object signals an error.
  The Lisp representations of these types are opaque structure-like types.  Their
  implementation is maintained internally, and you shouldn’t try to access or
  modify it directly.  Rather, the Emacs Lisp library <code>elisp/proto/proto</code> contains
  the following facilities to use and manipulate these types.</p>
<p dir="auto">It should be noted that protocol buffer arrays and maps are not “full” types.
  You can’t use them as replacement types for vectors or hash tables because
  there’s no way to create objects of these types from scratch.  You can only
  obtain new objects by accessing protocol buffer message fields.  This is also
  the reason why these types don’t provide implementations of <code>seq-into</code>,
  <code>seq-concatenate</code> or <code>map-into</code> that would return new protocol buffer arrays and
  maps.</p>
<p dir="auto">Another important difference between these types and the standard Emacs Lisp
  types is that protocol buffer arrays and maps are strongly-typed: all their
  elements have the same type, which is determined when creating the object.  For
  example, you can’t add a string value to a protocol buffer array holding
  integers.</p>
<p dir="auto">The Lisp representation of protocol buffer enumerations are plain Lisp
  constants.  See info:elisp#Defining Variables.  Their values are just the
  integral values of the corresponding enumerators.</p>
<p dir="auto">Whenever Emacs needs to convert a Lisp value to a protocol buffer field value,
  an array element, or a map key or value, it accepts values that are compatible
  with the destination type.  For example, you can use an integer to set a
  floating-point protocol buffer message field.  Setting a Boolean field accepts
  any non-~nil~ value as <code>true</code>.  Setting a repeated field accepts lists, vectors,
  and any other generalized sequence type.  Setting a map field accepts
  hash-tables, association lists, and any other generalized map type.</p>
<p dir="auto">The <code>nanos</code> field remains uninitialized.</p>
<p dir="auto">For every protocol buffer message type, the generated library will also contain
  a function {{{code({{{var(type)}}}-new)}}} that you can use as a shorthand for
  <code>elisp/proto/make</code>.  For example, you could also write the above example as</p>
<div class="highlight highlight-source-emacs-lisp notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="(require 'duration_proto)
(google/protobuf/Duration-new :seconds 3600)"><pre>(<span class="pl-c1">require</span> <span class="pl-c1">'duration_proto</span>)
(google/protobuf/Duration-new <span class="pl-c1">:seconds</span> <span class="pl-c1">3600</span>)</pre></div>
<p dir="auto">To check whether an object is a protocol buffer message object of a given type,
  the generated libraries contain predicate functions like
  {{{code({{{var(type)}}}-p)}}}.  For example, to test whether an object is a
  duration protocol buffer message, you can write</p>
<div class="highlight highlight-source-emacs-lisp notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="(require 'duration_proto)
(google/protobuf/Duration-p object)"><pre>(<span class="pl-c1">require</span> <span class="pl-c1">'duration_proto</span>)
(google/protobuf/Duration-p object)</pre></div>
<p dir="auto">You can also use the Common Lisp type predicates like <code>cl-typep</code> or
  <code>cl-check-type</code> with protocol buffer message objects.  See
  info:cl#Type Predicates.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Accessing protocol buffer message fields</h2><a id="user-content-accessing-protocol-buffer-message-fields" class="anchor-element" aria-label="Permalink: Accessing protocol buffer message fields" href="#accessing-protocol-buffer-message-fields"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The functions described in this section retrieve and manipulate message fields.
  They all accept a message object as first argument and a field name as second
  argument.  The field name is a plain symbol denoting the unqualified field name.</p>
<p dir="auto">Instead of specifying plain field names, you can also specify
  {{{code(({{{var(field)}}} {{{var(pattern)}}}))}}} pairs.  These match the field
  value against {{{var(pattern)}}}, which is again a <code>pcase</code> pattern.  For
  example, the following code tests whether a duration is strictly positive:</p>
<div class="highlight highlight-source-emacs-lisp notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="(pcase message
  ((or (elisp/proto google/protobuf/Duration
                    (seconds (and (pred cl-plusp) seconds))
                    nanos)
       (elisp/proto google/protobuf/Duration
                    (seconds (and 0 seconds))
                    (nanos (and (pred cl-plusp) nanos))))
   (message &quot;Duration with %d seconds and %d nanoseconds is positive&quot;
            seconds nanos)))"><pre>(<span class="pl-k">pcase</span> message
  ((<span class="pl-k">or</span> (elisp/proto google/protobuf/Duration
                    (seconds (<span class="pl-k">and</span> (pred cl-plusp) seconds))
                    nanos)
       (elisp/proto google/protobuf/Duration
                    (seconds (<span class="pl-k">and</span> <span class="pl-c1">0</span> seconds))
                    (nanos (<span class="pl-k">and</span> (pred cl-plusp) nanos))))
   (<span class="pl-c1">message</span> <span class="pl-pds">"</span><span class="pl-s">Duration with <span class="pl-c1">%d</span> seconds and <span class="pl-c1">%d</span> nanoseconds is positive</span><span class="pl-pds">"</span>
            seconds nanos)))</pre></div>
<p dir="auto">A {{{var(field)}}} construct that is a plain symbol is thus the same as
  {{{code(({{{var(field)}}} {{{var(field)}}}))}}}.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Parsing and serializing protocol buffer messages</h2><a id="user-content-parsing-and-serializing-protocol-buffer-messages" class="anchor-element" aria-label="Permalink: Parsing and serializing protocol buffer messages" href="#parsing-and-serializing-protocol-buffer-messages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The primary purpose of protocol buffers is data serialization.  The Emacs Lisp
  protocol buffer bindings support all three major forms of protocol buffer
  serialization: binary, JSON, and text.  However, currently the textual protocol
  buffer representation can only be generated, not parsed.  Since none of the
  serialized forms are self-describing, you have to explicitly pass the desired
  message type to the parsing functions.</p>
<p dir="auto">You can customize the behavior of the parsing and serialization functions to
  some extend with optional keyword arguments.  These are the most common keyword
  arguments:</p>
<dl>
  <dt><code>:allow-partial</code></dt><dd>This keyword argument affects how missing required fields
    are handled: by default, they cause an error to be signaled, but if the
    keyword argument is non-~nil~, they are silently ignored, and the result might
    not be fully initialized.</dd>
  <dt><code>:discard-unknown</code></dt><dd>This keyword argument affects how unknown fields are
    handled: by default, they cause an error to be signaled, but if the keyword
    argument is non-~nil~, they are silently ignored.</dd>
  <dt><code>:deterministic</code></dt><dd>If this keyword argument is non-~nil~, serialization
    functions attempt to produce slightly more deterministic output; however, this
    attempt is best-effort, since protocol buffer serialization is not guaranteed
    to be deterministic.</dd>
</dl>
<p dir="auto">Other keyword arguments are described in the main body of the function
  definitions below.</p>
<p dir="auto">You can print a human-readable representation of protocol buffer messages,
  arrays, and maps using the functions <code>cl-prin1</code>, <code>cl-prin1-to-string</code>, or
  <code>cl-print-to-string-with-limit</code>.  However, these objects don’t have a read
  syntax; see info:elisp#Printed Representation.  Using plain Emacs functions
  like <code>print</code> will result in a representation that’s not very human-readable; see
  info:elisp#Read and Print.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Well-known protocol buffer types</h2><a id="user-content-well-known-protocol-buffer-types" class="anchor-element" aria-label="Permalink: Well-known protocol buffer types" href="#well-known-protocol-buffer-types"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The Emacs Lisp protocol buffer bindings contain some dedicated support for a few
  well-known message types.  These are predefined types which are used frequently;
  see
  <a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf" rel="nofollow">https://developers.google.com/protocol-buffers/docs/reference/google.protobuf</a>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Specialized array and map functions</h2><a id="user-content-specialized-array-and-map-functions" class="anchor-element" aria-label="Permalink: Specialized array and map functions" href="#specialized-array-and-map-functions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This section describes a few additional functions that deal with arrays and
  maps.</p>
<p dir="auto">The following functions work on ranges in an array.  A range is defined by a
  start index and an end index; the start index is included in the range, but the
  end index is not.  If either index is negative, it’s treated as counting from
  the end; this facilitates things like addressing the last five elements of an
  array.  If the end index is left out or <code>nil</code>, the length of the array is used
  instead; this means that passing only a start index addresses the entire
  remaining subarray starting at that index.  These are exactly the same
  conventions that the functions <code>substring</code> and <code>seq-subseq</code> use.  See
  info:elisp#Creating Strings, and see info:elisp#Sequence Functions.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Starlark symbol reference</h1><a id="user-content-starlark-symbol-reference" class="anchor-element" aria-label="Permalink: Starlark symbol reference" href="#starlark-symbol-reference"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Symbols defined in <code>//elisp:defs.bzl</code></h2><a id="user-content-symbols-defined-in-elispdefsbzl" class="anchor-element" aria-label="Permalink: Symbols defined in //elisp:defs.bzl" href="#symbols-defined-in-elispdefsbzl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Symbols defined in <code>//elisp:repositories.bzl</code></h2><a id="user-content-symbols-defined-in-elisprepositoriesbzl" class="anchor-element" aria-label="Permalink: Symbols defined in //elisp:repositories.bzl" href="#symbols-defined-in-elisprepositoriesbzl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Symbols defined in <code>//elisp:extensions.bzl</code></h2><a id="user-content-symbols-defined-in-elispextensionsbzl" class="anchor-element" aria-label="Permalink: Symbols defined in //elisp:extensions.bzl" href="#symbols-defined-in-elispextensionsbzl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Symbols defined in <code>//emacs:defs.bzl</code></h2><a id="user-content-symbols-defined-in-emacsdefsbzl" class="anchor-element" aria-label="Permalink: Symbols defined in //emacs:defs.bzl" href="#symbols-defined-in-emacsdefsbzl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Indices</h1><a id="user-content-indices" class="anchor-element" aria-label="Permalink: Indices" href="#indices"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Concept index</h2><a id="user-content-concept-index" class="anchor-element" aria-label="Permalink: Concept index" href="#concept-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Symbol index</h2><a id="user-content-symbol-index" class="anchor-element" aria-label="Permalink: Symbol index" href="#symbol-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Type index</h2><a id="user-content-type-index" class="anchor-element" aria-label="Permalink: Type index" href="#type-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
</article></div>