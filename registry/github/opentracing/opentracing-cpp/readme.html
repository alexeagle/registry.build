<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto">ðŸ›‘ This library is DEPRECATED! <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="1104256026" data-permission-text="Title is private" data-url="https://github.com/opentracing/specification/issues/163" data-hovercard-type="issue" data-hovercard-url="/opentracing/specification/issues/163/hovercard" href="https://github.com/opentracing/specification/issues/163">opentracing/specification#163</a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">OpenTracing API for C++</h1><a id="user-content-opentracing-api-for-c" class="anchor" aria-label="Permalink: OpenTracing API for C++" href="#opentracing-api-for-c"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">C++ implementation of the OpenTracing API <a href="http://opentracing.io" rel="nofollow">http://opentracing.io</a></p>
<p dir="auto"><a href="https://gitter.im/opentracing/opentracing-cpp?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" rel="nofollow"><img src="https://camo.githubusercontent.com/ef534c8232afa749d8ba9a3b8e9341f836a2b7d4f690521960d63555e3f12531/68747470733a2f2f6261646765732e6769747465722e696d2f6f70656e74726163696e672f6f70656e74726163696e672d6370702e737667" alt="Join the chat at https://gitter.im/opentracing/opentracing-cpp" data-canonical-src="https://badges.gitter.im/opentracing/opentracing-cpp.svg" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Required Reading</h2><a id="user-content-required-reading" class="anchor" aria-label="Permalink: Required Reading" href="#required-reading"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In order to understand the C++ platform API, one must first be familiar with the
<a href="http://opentracing.io" rel="nofollow">OpenTracing project</a> and
<a href="http://opentracing.io/documentation/pages/spec" rel="nofollow">terminology</a> more generally.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Compile and install</h2><a id="user-content-compile-and-install" class="anchor" aria-label="Permalink: Compile and install" href="#compile-and-install"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Linux/MacOS</h4><a id="user-content-linuxmacos" class="anchor" aria-label="Permalink: Linux/MacOS" href="#linuxmacos"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mkdir .build
cd .build
cmake ..
make
sudo make install"><pre>mkdir .build
<span class="pl-c1">cd</span> .build
cmake ..
make
sudo make install</pre></div>
<p dir="auto">To test:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="make test"><pre>make <span class="pl-c1">test</span></pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Windows</h4><a id="user-content-windows" class="anchor" aria-label="Permalink: Windows" href="#windows"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mkdir .build
cd .build
cmake -G &quot;Visual Studio 15 2017 Win64&quot; .."><pre>mkdir .build
<span class="pl-c1">cd</span> .build
cmake -G <span class="pl-s"><span class="pl-pds">"</span>Visual Studio 15 2017 Win64<span class="pl-pds">"</span></span> ..</pre></div>
<p dir="auto">To build the targets in debug mode</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="MSBuild.exe opentracing-cpp.sln /p:Configuration=Debug /Target=Build"><pre>MSBuild.exe opentracing-cpp.sln /p:Configuration=Debug /Target=Build</pre></div>
<p dir="auto">To build the targets in release mode</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="MSBuild.exe opentracing-cpp.sln /p:Configuration=Release /Target=Build"><pre>MSBuild.exe opentracing-cpp.sln /p:Configuration=Release /Target=Build</pre></div>
<p dir="auto">To test:
Run the below command to run the tests with the debug targets</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ctest -C Debug"><pre>ctest -C Debug</pre></div>
<p dir="auto">Run the below command to run the tests with the release targets</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ctest -C Release"><pre>ctest -C Release</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">API overview for those adding instrumentation</h2><a id="user-content-api-overview-for-those-adding-instrumentation" class="anchor" aria-label="Permalink: API overview for those adding instrumentation" href="#api-overview-for-those-adding-instrumentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Everyday consumers of this <code>opentracing</code> package really only need to worry
about a couple of key abstractions: the <code>StartSpan</code> function, the <code>Span</code>
interface, and binding a <code>Tracer</code> at <code>main()</code>-time. Here are code snippets
demonstrating some important use cases.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Singleton initialization</h4><a id="user-content-singleton-initialization" class="anchor" aria-label="Permalink: Singleton initialization" href="#singleton-initialization"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The simplest starting point is <code>opentracing/tracer.h</code>. As early as possible, call</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    #include &lt;opentracing/tracer.h&gt;
    #include &lt;some_tracing_impl.h&gt;
    
    int main() {
      Tracer::InitGlobal(make_some_tracing_impl());
      ...
    }"><pre>    #<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>opentracing/tracer.h<span class="pl-pds">&gt;</span></span>
    #<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>some_tracing_impl.h<span class="pl-pds">&gt;</span></span>
    
    <span class="pl-k">int</span> <span class="pl-en">main</span>() {
      <span class="pl-c1">Tracer::InitGlobal</span>(<span class="pl-c1">make_some_tracing_impl</span>());
      ...
    }</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Non-Singleton initialization</h4><a id="user-content-non-singleton-initialization" class="anchor" aria-label="Permalink: Non-Singleton initialization" href="#non-singleton-initialization"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you prefer direct control to singletons, manage ownership of the
<code>opentracing::Tracer</code> implementation explicitly.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Starting an empty trace by creating a "root span"</h4><a id="user-content-starting-an-empty-trace-by-creating-a-root-span" class="anchor" aria-label="Permalink: Starting an empty trace by creating a &quot;root span&quot;" href="#starting-an-empty-trace-by-creating-a-root-span"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">It's always possible to create a "root" <code>Span</code> with no parent or other causal
reference.</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    void xyz() {
        ...
        auto tracer = /* Some Tracer */
        auto span = tracer-&gt;StartSpan(&quot;operation_name&quot;);
        if (!span)
          // Error creating span.
          ...
        span-&gt;Finish();
        ...
    }"><pre>    <span class="pl-k">void</span> <span class="pl-en">xyz</span>() {
        ...
        <span class="pl-k">auto</span> tracer = <span class="pl-c"><span class="pl-c">/*</span> Some Tracer <span class="pl-c">*/</span></span>
        <span class="pl-k">auto</span> span = tracer-&gt;<span class="pl-c1">StartSpan</span>(<span class="pl-s"><span class="pl-pds">"</span>operation_name<span class="pl-pds">"</span></span>);
        <span class="pl-k">if</span> (!span)
          <span class="pl-c"><span class="pl-c">//</span> Error creating span.</span>
          ...
        span-&gt;<span class="pl-c1">Finish</span>();
        ...
    }</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Creating a (child) Span given an existing (parent) Span</h4><a id="user-content-creating-a-child-span-given-an-existing-parent-span" class="anchor" aria-label="Permalink: Creating a (child) Span given an existing (parent) Span" href="#creating-a-child-span-given-an-existing-parent-span"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    void xyz(const opentracing::Span&amp; parent_span, ...) {
        ...
        auto tracer = /* Some Tracer */
        auto span = tracer-&gt;StartSpan(
            &quot;operation_name&quot;,
            {opentracing::ChildOf(&amp;parent_span.context())});
        if (!span)
          // Error creating span.
          ...
        span-&gt;Finish();
        ...
    }"><pre>    <span class="pl-k">void</span> <span class="pl-en">xyz</span>(<span class="pl-k">const</span> opentracing::Span&amp; parent_span, ...) {
        ...
        <span class="pl-k">auto</span> tracer = <span class="pl-c"><span class="pl-c">/*</span> Some Tracer <span class="pl-c">*/</span></span>
        <span class="pl-k">auto</span> span = tracer-&gt;<span class="pl-c1">StartSpan</span>(
            <span class="pl-s"><span class="pl-pds">"</span>operation_name<span class="pl-pds">"</span></span>,
            {<span class="pl-c1">opentracing::ChildOf</span>(&amp;parent_span.<span class="pl-c1">context</span>())});
        <span class="pl-k">if</span> (!span)
          <span class="pl-c"><span class="pl-c">//</span> Error creating span.</span>
          ...
        span-&gt;<span class="pl-c1">Finish</span>();
        ...
    }</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Inject Span context into a TextMapWriter</h4><a id="user-content-inject-span-context-into-a-textmapwriter" class="anchor" aria-label="Permalink: Inject Span context into a TextMapWriter" href="#inject-span-context-into-a-textmapwriter"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    struct CustomCarrierWriter : opentracing::TextMapWriter {
      explicit CustomCarrierWriter(
          std::unordered_map&lt;std::string, std::string&gt;&amp; data_)
          : data{data_} {}
    
      opentracing::expected&lt;void&gt; Set(
          opentracing::string_view key,
          opentracing::string_view value) const override {
        // OpenTracing uses opentracing::expected for error handling. This closely
        // follows the expected proposal for the C++ Standard Library. See
        //    http://open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0323r3.pdf
        // for more background.
        opentracing::expected&lt;void&gt; result;
    
        auto was_successful = data.emplace(key, value);
        if (was_successful.second) {
          // Use a default constructed opentracing::expected&lt;void&gt; to indicate
          // success.
          return result;
        } else {
          // `key` clashes with existing data, so the span context can't be encoded
          // successfully; set opentracing::expected&lt;void&gt; to an std::error_code.
          return opentracing::make_unexpected(
              std::make_error_code(std::errc::not_supported));
        }
      }
    
      std::unordered_map&lt;std::string, std::string&gt;&amp; data;
    };

    ...
    
    std::unordered_map&lt;std::string, std::string&gt; data;
    CustomCarrierWriter carrier{data};
    auto was_successful = tracer-&gt;Inject(span-&gt;context(), carrier);
    if (!was_successful) {
      // Injection failed, log an error message.
      std::cerr &lt;&lt; was_successful.error().message() &lt;&lt; &quot;\n&quot;;
    }"><pre>    <span class="pl-k">struct</span> <span class="pl-en">CustomCarrierWriter</span> : opentracing::TextMapWriter {
      <span class="pl-k">explicit</span> <span class="pl-en">CustomCarrierWriter</span>(
          std::unordered_map&lt;std::string, std::string&gt;&amp; data_)
          : data{data_} {}
    
      opentracing::expected&lt;<span class="pl-k">void</span>&gt; <span class="pl-en">Set</span>(
          opentracing::string_view key,
          opentracing::string_view value) <span class="pl-k">const</span> <span class="pl-k">override</span> {
        <span class="pl-c"><span class="pl-c">//</span> OpenTracing uses opentracing::expected for error handling. This closely</span>
        <span class="pl-c"><span class="pl-c">//</span> follows the expected proposal for the C++ Standard Library. See</span>
        <span class="pl-c"><span class="pl-c">//</span>    http://open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0323r3.pdf</span>
        <span class="pl-c"><span class="pl-c">//</span> for more background.</span>
        opentracing::expected&lt;<span class="pl-k">void</span>&gt; result;
    
        <span class="pl-k">auto</span> was_successful = data.<span class="pl-c1">emplace</span>(key, value);
        <span class="pl-k">if</span> (was_successful.<span class="pl-smi">second</span>) {
          <span class="pl-c"><span class="pl-c">//</span> Use a default constructed opentracing::expected&lt;void&gt; to indicate</span>
          <span class="pl-c"><span class="pl-c">//</span> success.</span>
          <span class="pl-k">return</span> result;
        } <span class="pl-k">else</span> {
          <span class="pl-c"><span class="pl-c">//</span> `key` clashes with existing data, so the span context can't be encoded</span>
          <span class="pl-c"><span class="pl-c">//</span> successfully; set opentracing::expected&lt;void&gt; to an std::error_code.</span>
          <span class="pl-k">return</span> <span class="pl-c1">opentracing::make_unexpected</span>(
              <span class="pl-c1">std::make_error_code</span>(std::errc::not_supported));
        }
      }
    
      std::unordered_map&lt;std::string, std::string&gt;&amp; data;
    };

    ...
    
    std::unordered_map&lt;std::string, std::string&gt; data;
    CustomCarrierWriter carrier{data};
    <span class="pl-k">auto</span> was_successful = tracer-&gt;<span class="pl-en">Inject</span>(span-&gt;<span class="pl-en">context</span>(), carrier);
    <span class="pl-k">if</span> (!was_successful) {
      <span class="pl-c"><span class="pl-c">//</span> Injection failed, log an error message.</span>
      std::cerr &lt;&lt; was_successful.<span class="pl-c1">error</span>().<span class="pl-c1">message</span>() &lt;&lt; <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    }</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Extract Span context from a TextMapReader</h4><a id="user-content-extract-span-context-from-a-textmapreader" class="anchor" aria-label="Permalink: Extract Span context from a TextMapReader" href="#extract-span-context-from-a-textmapreader"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    struct CustomCarrierReader : opentracing::TextMapReader {
      explicit CustomCarrierReader(
          const std::unordered_map&lt;std::string, std::string&gt;&amp; data_)
          : data{data_} {}
    
      using F = std::function&lt;opentracing::expected&lt;void&gt;(
          opentracing::string_view, opentracing::string_view)&gt;;
    
      opentracing::expected&lt;void&gt; ForeachKey(F f) const override {
        // Iterate through all key-value pairs, the tracer will use the relevant keys
        // to extract a span context.
        for (auto&amp; key_value : data) {
          auto was_successful = f(key_value.first, key_value.second);
          if (!was_successful) {
            // If the callback returns and unexpected value, bail out of the loop.
            return was_successful;
          }
        }
    
        // Indicate successful iteration.
        return {};
      }
    
      // Optional, define TextMapReader::LookupKey to allow for faster extraction.
      opentracing::expected&lt;opentracing::string_view&gt; LookupKey(
          opentracing::string_view key) const override {
        auto iter = data.find(key);
        if (iter != data.end()) {
          return opentracing::make_unexpected(opentracing::key_not_found_error);
        }
        return opentracing::string_view{iter-&gt;second};
      }
    
      const std::unordered_map&lt;std::string, std::string&gt;&amp; data;
    };
    
    ...

    CustomCarrierReader carrier{data};
    auto span_context_maybe = tracer-&gt;Extract(carrier);
    if (!span_context_maybe) {
      // Extraction failed, log an error message.
      std::cerr &lt;&lt; span_context_maybe.error().message() &lt;&lt; &quot;\n&quot;;
    }
  
    // If `carrier` contained a span context, `span_context` will point to a
    // representation of it; otherwise, if no span context existed, `span_context`
    // will be nullptr;
    std::unique_ptr&lt;opentracing::SpanContext&gt; span_context =
        std::move(*span_context_maybe);"><pre>    <span class="pl-k">struct</span> <span class="pl-en">CustomCarrierReader</span> : opentracing::TextMapReader {
      <span class="pl-k">explicit</span> <span class="pl-en">CustomCarrierReader</span>(
          <span class="pl-k">const</span> std::unordered_map&lt;std::string, std::string&gt;&amp; data_)
          : data{data_} {}
    
      <span class="pl-k">using</span> F = std::function&lt;opentracing::expected&lt;<span class="pl-k">void</span>&gt;(
          opentracing::string_view, opentracing::string_view)&gt;;
    
      opentracing::expected&lt;<span class="pl-k">void</span>&gt; <span class="pl-en">ForeachKey</span>(F f) <span class="pl-k">const</span> <span class="pl-k">override</span> {
        <span class="pl-c"><span class="pl-c">//</span> Iterate through all key-value pairs, the tracer will use the relevant keys</span>
        <span class="pl-c"><span class="pl-c">//</span> to extract a span context.</span>
        <span class="pl-k">for</span> (<span class="pl-k">auto</span>&amp; key_value : data) {
          <span class="pl-k">auto</span> was_successful = <span class="pl-c1">f</span>(key_value.<span class="pl-smi">first</span>, key_value.<span class="pl-smi">second</span>);
          <span class="pl-k">if</span> (!was_successful) {
            <span class="pl-c"><span class="pl-c">//</span> If the callback returns and unexpected value, bail out of the loop.</span>
            <span class="pl-k">return</span> was_successful;
          }
        }
    
        <span class="pl-c"><span class="pl-c">//</span> Indicate successful iteration.</span>
        <span class="pl-k">return</span> {};
      }
    
      <span class="pl-c"><span class="pl-c">//</span> Optional, define TextMapReader::LookupKey to allow for faster extraction.</span>
      opentracing::expected&lt;opentracing::string_view&gt; <span class="pl-en">LookupKey</span>(
          opentracing::string_view key) <span class="pl-k">const</span> <span class="pl-k">override</span> {
        <span class="pl-k">auto</span> iter = data.<span class="pl-c1">find</span>(key);
        <span class="pl-k">if</span> (iter != data.<span class="pl-c1">end</span>()) {
          <span class="pl-k">return</span> <span class="pl-c1">opentracing::make_unexpected</span>(opentracing::key_not_found_error);
        }
        <span class="pl-k">return</span> opentracing::string_view{iter-&gt;<span class="pl-smi">second</span>};
      }
    
      <span class="pl-k">const</span> std::unordered_map&lt;std::string, std::string&gt;&amp; data;
    };
    
    ...

    CustomCarrierReader carrier{data};
    <span class="pl-k">auto</span> span_context_maybe = tracer-&gt;<span class="pl-en">Extract</span>(carrier);
    <span class="pl-k">if</span> (!span_context_maybe) {
      <span class="pl-c"><span class="pl-c">//</span> Extraction failed, log an error message.</span>
      std::cerr &lt;&lt; span_context_maybe.<span class="pl-c1">error</span>().<span class="pl-c1">message</span>() &lt;&lt; <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    }
  
    <span class="pl-c"><span class="pl-c">//</span> If `carrier` contained a span context, `span_context` will point to a</span>
    <span class="pl-c"><span class="pl-c">//</span> representation of it; otherwise, if no span context existed, `span_context`</span>
    <span class="pl-c"><span class="pl-c">//</span> will be nullptr;</span>
    std::unique_ptr&lt;opentracing::SpanContext&gt; span_context =
        <span class="pl-en">std::move</span>(*span_context_maybe);</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">API compatibility</h2><a id="user-content-api-compatibility" class="anchor" aria-label="Permalink: API compatibility" href="#api-compatibility"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For the time being, "mild" backwards-incompatible changes may be made without
changing the major version number. As OpenTracing and <code>opentracing-cpp</code> mature,
backwards compatibility will become more of a priority.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">C/C++98</h2><a id="user-content-cc98" class="anchor" aria-label="Permalink: C/C++98" href="#cc98"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This library requires C++11 or later. But if you're interested in a C or C++98
API contact us on <a href="https://gitter.im/opentracing/opentracing-cpp?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" rel="nofollow">gitter</a>.
We're open to supporting additional APIs in a separate repository if there are
people willing to maintain it.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">By contributing to opentracing.cpp, you agree that your contributions will be licensed under its <a href="./LICENSE">Apache 2.0 License</a>.</p>
</article></div>