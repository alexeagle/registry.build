<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://github.com/fildesh/fildesh/actions/workflows/test_bazel.yaml"><img src="https://github.com/fildesh/fildesh/actions/workflows/test_bazel.yaml/badge.svg" alt="Bazel" style="max-width: 100%;"></a>
<a href="https://github.com/fildesh/fildesh/actions/workflows/test_cmake.yaml"><img src="https://github.com/fildesh/fildesh/actions/workflows/test_cmake.yaml/badge.svg" alt="CMake" style="max-width: 100%;"></a>
<br>
<a href="https://coveralls.io/github/fildesh/fildesh?branch=trunk" rel="nofollow"><img src="https://camo.githubusercontent.com/079c52e46b3fc4e39080ef3d3e780ab63db05429485620a7c1b56c1c42d5c3b7/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f66696c646573682f66696c646573682f62616467652e7376673f6272616e63683d7472756e6b" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/github/fildesh/fildesh/badge.svg?branch=trunk" style="max-width: 100%;"></a>
<a href="https://www.bestpractices.dev/projects/6377" rel="nofollow"><img src="https://camo.githubusercontent.com/6dd012dab27185be560898ee33e233a39022b48a61ee9658885a81d9319a8b8c/68747470733a2f2f7777772e626573747072616374696365732e6465762f70726f6a656374732f363337372f6261646765" alt="OpenSSF Best Practices" data-canonical-src="https://www.bestpractices.dev/projects/6377/badge" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Fildesh: File Descriptor Shell Scripting</h1><a id="user-content-fildesh-file-descriptor-shell-scripting" class="anchor" aria-label="Permalink: Fildesh: File Descriptor Shell Scripting" href="#fildesh-file-descriptor-shell-scripting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Fildesh is a domain-specific language to create nonlinear pipelines between programs.
It can create pipes between programs with multiple inputs
(<a href="eg/sum/add_test.fildesh">eg/sum/add_test.fildesh</a>)
and multiple outputs
(<a href="eg/sum/dag.fildesh">eg/sum/dag.fildesh</a>)
that depend on each other
(<a href="eg/sum/cycle.fildesh">eg/sum/cycle.fildesh</a>).
When the dataflow graph is not a tree,
the <code>elastic</code> builtin should be used to avoid deadlocks in the undirected cycles.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Quick Start</h2><a id="user-content-quick-start" class="anchor" aria-label="Permalink: Quick Start" href="#quick-start"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Docker</h3><a id="user-content-docker" class="anchor" aria-label="Permalink: Docker" href="#docker"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Run script given as command-line args.
docker run -q --rm -a STDOUT ghcr.io/fildesh/fildesh:latest -- \
  '|&lt; splice / &quot;Hello world!\n&quot; /' \
  '|&gt; stdout'

# Run script given on standard input.
docker run -q --rm -i ghcr.io/fildesh/fildesh:latest - &lt; example/hello.fildesh"><pre><span class="pl-c"><span class="pl-c">#</span> Run script given as command-line args.</span>
docker run -q --rm -a STDOUT ghcr.io/fildesh/fildesh:latest -- \
  <span class="pl-s"><span class="pl-pds">'</span>|&lt; splice / "Hello world!\n" /<span class="pl-pds">'</span></span> \
  <span class="pl-s"><span class="pl-pds">'</span>|&gt; stdout<span class="pl-pds">'</span></span>

<span class="pl-c"><span class="pl-c">#</span> Run script given on standard input.</span>
docker run -q --rm -i ghcr.io/fildesh/fildesh:latest - <span class="pl-k">&lt;</span> example/hello.fildesh</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">CMake</h3><a id="user-content-cmake" class="anchor" aria-label="Permalink: CMake" href="#cmake"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Run script after compiling fildesh in ./bld/src/bin/.
cmake -B bld
cmake --build bld --target fildesh
./bld/src/bin/fildesh example/hello.fildesh

# Run script after compiling fildesh with aggressive development presets.
make run 'ARGS=example/hello.fildesh'"><pre><span class="pl-c"><span class="pl-c">#</span> Run script after compiling fildesh in ./bld/src/bin/.</span>
cmake -B bld
cmake --build bld --target fildesh
./bld/src/bin/fildesh example/hello.fildesh

<span class="pl-c"><span class="pl-c">#</span> Run script after compiling fildesh with aggressive development presets.</span>
make run <span class="pl-s"><span class="pl-pds">'</span>ARGS=example/hello.fildesh<span class="pl-pds">'</span></span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bazel</h3><a id="user-content-bazel" class="anchor" aria-label="Permalink: Bazel" href="#bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Run script after compiling fildesh in ./bazel-bin/src/bin/.
bazel run //:fildesh -- $PWD/example/hello.fildesh"><pre><span class="pl-c"><span class="pl-c">#</span> Run script after compiling fildesh in ./bazel-bin/src/bin/.</span>
bazel run //:fildesh -- <span class="pl-smi">$PWD</span>/example/hello.fildesh</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Motivating Example</h2><a id="user-content-motivating-example" class="anchor" aria-label="Permalink: Motivating Example" href="#motivating-example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Consider writing an end-to-end test that checks whether a program gives an expected result for a particular input.
In order to compare the expected and actual results, at least one of them is typically stored as a temporary string or file.
With Fildesh, we can keep both in pipes.</p>
<p dir="auto">The following example (<a href="eg/sum/add_test.fildesh">eg/sum/add_test.fildesh</a>) shows how to test a program <code>add</code> that calculates the sum of numbers on each input line.
First, the script constructs an pipe named <code>expect</code> that contains the expected result.
Next, three input lines are constructed and stored in their own pipes named <code>input_line_1</code>, <code>input_linee_2</code>, and <code>input_line_3</code>.
Finally, those lines are spliced together, piped to <code>add</code>, and the result is compared against the expected one.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Expected result sums on their own lines: 55, 0, and 5050.
splice -o $(OF expect) / &quot;55\n&quot; &quot;0\n&quot; &quot;5050\n&quot; /

# First test input line: Integers from 1 to 10.
|&lt; seq 1 10
|&gt; replace_string -o $(OF input_line_1) &quot;\n&quot; &quot; &quot;

# Second test input line: Nothing.
splice -o $(OF input_line_2) / &quot;&quot; /

# Third test input line: Integers from 1 to 100.
|&lt; seq 1 100
|&gt; replace_string -o $(OF input_line_3) &quot;\n&quot; &quot; &quot;

# Combine the test input lines.
|&lt; splice $(XF input_line_1) / &quot;\n&quot; $(XA input_line_2) &quot;\n&quot; / $(XF input_line_3)
# System under test: Program that sums each line of input numbers.
|- add
# Compare the expected and actual results,
# and exit with a nonzero status if they differ.
|- cmp $(XF expect) -
# Show the diff on stdout if there is any.
|&gt; stdout

$(barrier)
# Indicate success when all previous commands have finished successfully.
|&lt; splice / &quot;Success: `add` produced expected result.\n&quot; /
|&gt; stdout"><pre><span class="pl-c"><span class="pl-c">#</span> Expected result sums on their own lines: 55, 0, and 5050.</span>
splice -o <span class="pl-s"><span class="pl-pds">$(</span>OF expect<span class="pl-pds">)</span></span> / <span class="pl-s"><span class="pl-pds">"</span>55\n<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>0\n<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>5050\n<span class="pl-pds">"</span></span> /

<span class="pl-c"><span class="pl-c">#</span> First test input line: Integers from 1 to 10.</span>
<span class="pl-k">|</span><span class="pl-k">&lt;</span> seq 1 10
<span class="pl-k">|</span><span class="pl-k">&gt;</span> replace_string -o <span class="pl-s"><span class="pl-pds">$(</span>OF input_line_1<span class="pl-pds">)</span></span> <span class="pl-s"><span class="pl-pds">"</span>\n<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> Second test input line: Nothing.</span>
splice -o <span class="pl-s"><span class="pl-pds">$(</span>OF input_line_2<span class="pl-pds">)</span></span> / <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> /

<span class="pl-c"><span class="pl-c">#</span> Third test input line: Integers from 1 to 100.</span>
<span class="pl-k">|</span><span class="pl-k">&lt;</span> seq 1 100
<span class="pl-k">|</span><span class="pl-k">&gt;</span> replace_string -o <span class="pl-s"><span class="pl-pds">$(</span>OF input_line_3<span class="pl-pds">)</span></span> <span class="pl-s"><span class="pl-pds">"</span>\n<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> Combine the test input lines.</span>
<span class="pl-k">|</span><span class="pl-k">&lt;</span> splice <span class="pl-s"><span class="pl-pds">$(</span>XF input_line_1<span class="pl-pds">)</span></span> / <span class="pl-s"><span class="pl-pds">"</span>\n<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">$(</span>XA input_line_2<span class="pl-pds">)</span></span> <span class="pl-s"><span class="pl-pds">"</span>\n<span class="pl-pds">"</span></span> / <span class="pl-s"><span class="pl-pds">$(</span>XF input_line_3<span class="pl-pds">)</span></span>
<span class="pl-c"><span class="pl-c">#</span> System under test: Program that sums each line of input numbers.</span>
<span class="pl-k">|</span>- add
<span class="pl-c"><span class="pl-c">#</span> Compare the expected and actual results,</span>
<span class="pl-c"><span class="pl-c">#</span> and exit with a nonzero status if they differ.</span>
<span class="pl-k">|</span>- cmp <span class="pl-s"><span class="pl-pds">$(</span>XF expect<span class="pl-pds">)</span></span> -
<span class="pl-c"><span class="pl-c">#</span> Show the diff on stdout if there is any.</span>
<span class="pl-k">|</span><span class="pl-k">&gt;</span> stdout

<span class="pl-s"><span class="pl-pds">$(</span>barrier<span class="pl-pds">)</span></span>
<span class="pl-c"><span class="pl-c">#</span> Indicate success when all previous commands have finished successfully.</span>
<span class="pl-k">|</span><span class="pl-k">&lt;</span> splice / <span class="pl-s"><span class="pl-pds">"</span>Success: <span class="pl-s"><span class="pl-pds">`</span>add<span class="pl-pds">`</span></span> produced expected result.\n<span class="pl-pds">"</span></span> /
<span class="pl-k">|</span><span class="pl-k">&gt;</span> stdout</pre></div>
</article></div>