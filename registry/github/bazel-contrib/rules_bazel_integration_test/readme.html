<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-bazel-integration-rules" class="anchor" aria-hidden="true" href="#bazel-integration-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bazel Integration Rules</h1>
<p dir="auto"><a href="https://github.com/bazel-contrib/rules_bazel_integration_test/actions/workflows/ci.yml"><img src="https://github.com/bazel-contrib/rules_bazel_integration_test/actions/workflows/ci.yml/badge.svg?event=schedule" alt="Build" style="max-width: 100%;"></a></p>
<p dir="auto">This repository contains <a href="https://bazel.build/" rel="nofollow">Bazel</a> macros that execute integration tests that
use Bazel (e.g. execute tests in a child workspace).  The macros support running integration tests
with multiple versions of Bazel.</p>
<h2 dir="auto"><a id="user-content-table-of-contents" class="anchor" aria-hidden="true" href="#table-of-contents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Table of Contents</h2>

<ul dir="auto">
<li><a href="#quickstart">Quickstart</a>
<ul dir="auto">
<li><a href="#1-configure-your-workspace-to-use-rules_bazel_integration_test">1. Configure your workspace to use rules_bazel_integration_test</a>
<ul dir="auto">
<li><a href="#recommended-add-dependency-to-modulebazel">Recommended: Add dependency to MODULE.bazel</a></li>
<li><a href="#legacy-update-workspace">Legacy: Update WORKSPACE</a></li>
</ul>
</li>
<li><a href="#2-list-the-bazel-versions-for-testing">2. List the Bazel versions for testing</a>
<ul dir="auto">
<li><a href="#recommended-add-bazel-versions-to-modulebazel">Recommended: Add Bazel versions to MODULE.bazel</a></li>
<li><a href="#legacy-declare-the-bazel-binaries-in-the-workspace-file">Legacy: Declare the Bazel binaries in the WORKSPACE file</a></li>
</ul>
</li>
<li><a href="#3-configure-the-deleted-packages-for-the-parent-workspace">3. Configure the deleted packages for the parent workspace</a></li>
<li><a href="#4-define-integration-test-targets">4. Define integration test targets</a></li>
</ul>
</li>
<li><a href="#integration-tests-that-depend-upon-the-parent-workspace">Integration Tests That Depend Upon The Parent Workspace</a>
<ul dir="auto">
<li><a href="#1-declare-a-filegroup-to-represent-the-parent-workspace-files">1. Declare a filegroup to represent the parent workspace files</a></li>
<li><a href="#2-update-the-integration-test-targets-to-include-the-parent-workspace-files">2. Update the integration test targets to include the parent workspace files</a></li>
<li><a href="#3-execute-the-integration-tests">3. Execute the integration tests</a></li>
</ul>
</li>
<li><a href="#custom-test-runner">Custom Test Runner</a></li>
<li><a href="#bazelisk-bazel-version-formats">Bazelisk Bazel Version Formats</a></li>
</ul>

<h2 dir="auto"><a id="user-content-quickstart" class="anchor" aria-hidden="true" href="#quickstart"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Quickstart</h2>
<p dir="auto">The following provides a quick introduction on how to use the rules in this repository. Also, check
out <a href="/doc/">the documentation</a>, the <a href="/examples/BUILD.bazel">integration test defined in this repo</a>,
and the <a href="/examples/custom_test_runner">custom test runner example</a> for more information.</p>
<h3 dir="auto"><a id="user-content-1-configure-your-workspace-to-use-rules_bazel_integration_test" class="anchor" aria-hidden="true" href="#1-configure-your-workspace-to-use-rules_bazel_integration_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>1. Configure your workspace to use <code>rules_bazel_integration_test</code></h3>
<h4 dir="auto"><a id="user-content-recommended-add-dependency-to-modulebazel" class="anchor" aria-hidden="true" href="#recommended-add-dependency-to-modulebazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Recommended: Add dependency to <code>MODULE.bazel</code></h4>
<p dir="auto">If you are using Bazel with bzlmod enabled, add the following snippet to your <code>MODULE.bazel</code> file.</p>

<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel_dep(
    name = &quot;rules_bazel_integration_test&quot;,
    version = &quot;0.13.0&quot;,
    dev_dependency = True,
)"><pre lang="python" class="notranslate"><code>bazel_dep(
    name = "rules_bazel_integration_test",
    version = "0.13.0",
    dev_dependency = True,
)
</code></pre></div>

<h4 dir="auto"><a id="user-content-legacy-update-workspace" class="anchor" aria-hidden="true" href="#legacy-update-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Legacy: Update <code>WORKSPACE</code></h4>
<p dir="auto">If you are using Bazel with bzlmod disabled, add the following to your <code>WORKSPACE</code> file to add this
repository and its dependencies.</p>

<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="http_archive(
    name = &quot;rules_bazel_integration_test&quot;,
    sha256 = &quot;1ea55655cc9d69d1995c58c980774b1c0793529694542e74fb4bc943c80bfcad&quot;,
    urls = [
        &quot;https://github.com/bazel-contrib/rules_bazel_integration_test/releases/download/v0.13.0/rules_bazel_integration_test.v0.13.0.tar.gz&quot;,
    ],
)

load(&quot;@rules_bazel_integration_test//bazel_integration_test:deps.bzl&quot;, &quot;bazel_integration_test_rules_dependencies&quot;)

bazel_integration_test_rules_dependencies()

load(&quot;@cgrindel_bazel_starlib//:deps.bzl&quot;, &quot;bazel_starlib_dependencies&quot;)

bazel_starlib_dependencies()

load(&quot;@bazel_skylib//:workspace.bzl&quot;, &quot;bazel_skylib_workspace&quot;)

bazel_skylib_workspace()"><pre lang="python" class="notranslate"><code>http_archive(
    name = "rules_bazel_integration_test",
    sha256 = "1ea55655cc9d69d1995c58c980774b1c0793529694542e74fb4bc943c80bfcad",
    urls = [
        "https://github.com/bazel-contrib/rules_bazel_integration_test/releases/download/v0.13.0/rules_bazel_integration_test.v0.13.0.tar.gz",
    ],
)

load("@rules_bazel_integration_test//bazel_integration_test:deps.bzl", "bazel_integration_test_rules_dependencies")

bazel_integration_test_rules_dependencies()

load("@cgrindel_bazel_starlib//:deps.bzl", "bazel_starlib_dependencies")

bazel_starlib_dependencies()

load("@bazel_skylib//:workspace.bzl", "bazel_skylib_workspace")

bazel_skylib_workspace()
</code></pre></div>

<h3 dir="auto"><a id="user-content-2-list-the-bazel-versions-for-testing" class="anchor" aria-hidden="true" href="#2-list-the-bazel-versions-for-testing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>2. List the Bazel versions for testing</h3>
<h4 dir="auto"><a id="user-content-recommended-add-bazel-versions-to-modulebazel" class="anchor" aria-hidden="true" href="#recommended-add-bazel-versions-to-modulebazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Recommended: Add Bazel versions to <code>MODULE.bazel</code></h4>
<p dir="auto">Load the <code>bazel_binaries</code> extension and specify the Bazel verions to download.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel_binaries = use_extension(
    &quot;@rules_bazel_integration_test//:extensions.bzl&quot;,
    &quot;bazel_binaries&quot;,
    dev_dependency = True,
)
bazel_binaries.download(version_file = &quot;//:.bazelversion&quot;)
bazel_binaries.download(version = &quot;6.0.0&quot;)
bazel_binaries.download(version = &quot;7.0.0-pre.20230215.2&quot;)
use_repo(bazel_binaries, &quot;bazel_binaries&quot;)"><pre lang="python" class="notranslate"><code>bazel_binaries = use_extension(
    "@rules_bazel_integration_test//:extensions.bzl",
    "bazel_binaries",
    dev_dependency = True,
)
bazel_binaries.download(version_file = "//:.bazelversion")
bazel_binaries.download(version = "6.0.0")
bazel_binaries.download(version = "7.0.0-pre.20230215.2")
use_repo(bazel_binaries, "bazel_binaries")
</code></pre></div>
<h4 dir="auto"><a id="user-content-legacy-declare-the-bazel-binaries-in-the-workspace-file" class="anchor" aria-hidden="true" href="#legacy-declare-the-bazel-binaries-in-the-workspace-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Legacy: Declare the Bazel binaries in the <code>WORKSPACE</code> file</h4>
<p dir="auto">In the <code>WORKSPACE</code> file, add the following to download and prepare the Bazel binaries for
testing.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="load(&quot;@rules_bazel_integration_test//bazel_integration_test:defs.bzl&quot;, &quot;bazel_binaries&quot;)

bazel_binaries(versions = [
    &quot;//:.bazelversion&quot;,
    &quot;6.0.0&quot;,
    &quot;7.0.0-pre.20230215.2&quot;,
])"><pre lang="python" class="notranslate"><code>load("@rules_bazel_integration_test//bazel_integration_test:defs.bzl", "bazel_binaries")

bazel_binaries(versions = [
    "//:.bazelversion",
    "6.0.0",
    "7.0.0-pre.20230215.2",
])
</code></pre></div>
<h3 dir="auto"><a id="user-content-3-configure-the-deleted-packages-for-the-parent-workspace" class="anchor" aria-hidden="true" href="#3-configure-the-deleted-packages-for-the-parent-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>3. Configure the deleted packages for the parent workspace</h3>
<p dir="auto">If you have child workspaces under your parent workspace, you need to tell Bazel to ignore the child
workspaces. This can be done in one of two ways:</p>
<ol dir="auto">
<li>Add entries to the <code>.bazelignore</code> file in the parent workspace.</li>
<li>Specify a list of deleted packages using the <code>--deleted_packages</code> flag.</li>
</ol>
<p dir="auto">For <code>glob()</code> in the parent workspace to find files in the child workspaces, we need to use the
deleted packages mechanism.</p>
<p dir="auto">Add the following to the <code>.bazelrc</code> in the parent workspace. Leave the values blank for now.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# To update these lines, execute 
# `bazel run @rules_bazel_integration_test//tools:update_deleted_packages`
build --deleted_packages=
query --deleted_packages="><pre lang="conf" class="notranslate"><code># To update these lines, execute 
# `bazel run @rules_bazel_integration_test//tools:update_deleted_packages`
build --deleted_packages=
query --deleted_packages=
</code></pre></div>
<p dir="auto">To populate the values, we will run a utility that looks for child workspaces (i.e., <code>WORKSPACE</code>
files) and find all of the directories that have Bazel build files (i.e., <code>BUILD</code>, <code>BUILD.bazel</code>).
Execute the following in a parent workspace directory.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# Populate the --deleted_packages flags in the .bazelrc
$ bazel run @rules_bazel_integration_test//tools:update_deleted_packages"><pre lang="sh" class="notranslate"><code># Populate the --deleted_packages flags in the .bazelrc
$ bazel run @rules_bazel_integration_test//tools:update_deleted_packages
</code></pre></div>
<p dir="auto">After running the utility, the <code>--deleted_packages</code> entries in the <code>.bazelrc</code> should have a
comma-separated list of packages under the child workspaces.</p>
<h3 dir="auto"><a id="user-content-4-define-integration-test-targets" class="anchor" aria-hidden="true" href="#4-define-integration-test-targets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>4. Define integration test targets</h3>
<p dir="auto">For the purposes of this example, lets assume that we have an <code>examples</code> directory which contains a
subdirectory called <code>simple</code>. The <code>simple</code> directory contains another Bazel workspace (i.e. has its
own <code>WORKSPACE</code> file) that does not have a dependency on the parent workspace. We want to
execute tests in the <code>simple</code> workspace using different versions of Bazel.</p>
<p dir="auto">Add the following to the <code>BUILD.bazel</code> file in the <code>examples</code> directory.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_binaries//:defs.bzl&quot;, &quot;bazel_binaries&quot;)
load(
    &quot;@rules_bazel_integration_test//bazel_integration_test:defs.bzl&quot;,
    &quot;bazel_integration_test&quot;,
    &quot;bazel_integration_tests&quot;,
    &quot;default_test_runner&quot;,
    &quot;integration_test_utils&quot;,
)

# Declare a test runner to drive the integration tests.
default_test_runner(
    name = &quot;simple_test_runner&quot;,
)

# If you only want to execute against a single version of Bazel, use
# bazel_integration_test.
bazel_integration_test(
    name = &quot;simple_test&quot;,
    bazel_version = bazel_binaries.versions.current,
    test_runner = &quot;:simple_test_runner&quot;,
    workspace_path = &quot;simple&quot;,
)

# If you want to execute an integration test using multiple versions of Bazel,
# use bazel_integration_tests. It will generate multiple integration test
# targets with names derived from the base name and the bazel version.
bazel_integration_tests(
    name = &quot;simple_test&quot;,
    bazel_versions = bazel_binaries.versions.other,
    test_runner = &quot;:simple_test_runner&quot;,
    workspace_path = &quot;simple&quot;,
)

# By default, the integration test targets are tagged as `manual`. This
# prevents the targets from being found from most target expansion (e.g.
# `//...`, `:all`). To easily execute a group of integration tests, you may
# want to define a test suite which includes the desired test targets.
test_suite(
    name = &quot;all_integration_tests&quot;,
    # If you don't apply the test tags to the test suite, the test suite will
    # be found when `bazel test //...` is executed.
    tags = integration_test_utils.DEFAULT_INTEGRATION_TEST_TAGS,
    tests = [&quot;:simple_test&quot;] +
            integration_test_utils.bazel_integration_test_names(
                &quot;simple_test&quot;,
                bazel_binaries.versions.other,
            ),
    visibility = [&quot;//:__subpackages__&quot;],
)"><pre lang="python" class="notranslate"><code>load("@bazel_binaries//:defs.bzl", "bazel_binaries")
load(
    "@rules_bazel_integration_test//bazel_integration_test:defs.bzl",
    "bazel_integration_test",
    "bazel_integration_tests",
    "default_test_runner",
    "integration_test_utils",
)

# Declare a test runner to drive the integration tests.
default_test_runner(
    name = "simple_test_runner",
)

# If you only want to execute against a single version of Bazel, use
# bazel_integration_test.
bazel_integration_test(
    name = "simple_test",
    bazel_version = bazel_binaries.versions.current,
    test_runner = ":simple_test_runner",
    workspace_path = "simple",
)

# If you want to execute an integration test using multiple versions of Bazel,
# use bazel_integration_tests. It will generate multiple integration test
# targets with names derived from the base name and the bazel version.
bazel_integration_tests(
    name = "simple_test",
    bazel_versions = bazel_binaries.versions.other,
    test_runner = ":simple_test_runner",
    workspace_path = "simple",
)

# By default, the integration test targets are tagged as `manual`. This
# prevents the targets from being found from most target expansion (e.g.
# `//...`, `:all`). To easily execute a group of integration tests, you may
# want to define a test suite which includes the desired test targets.
test_suite(
    name = "all_integration_tests",
    # If you don't apply the test tags to the test suite, the test suite will
    # be found when `bazel test //...` is executed.
    tags = integration_test_utils.DEFAULT_INTEGRATION_TEST_TAGS,
    tests = [":simple_test"] +
            integration_test_utils.bazel_integration_test_names(
                "simple_test",
                bazel_binaries.versions.other,
            ),
    visibility = ["//:__subpackages__"],
)
</code></pre></div>
<p dir="auto">The above code defines three test targets: <code>//examples:simple_test</code>,
<code>//examples:simple_test_bazel_6_0_0</code>, and
<code>//examples:simple_test_bazel_7_0_0-pre_20230215_2</code>. The <code>all_integration_tests</code> target is a test
suite that executes all of the integration tests with a single command:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# Execute all of the integration tests
$ bazel test //examples:all_integration_tests"><pre lang="sh" class="notranslate"><code># Execute all of the integration tests
$ bazel test //examples:all_integration_tests
</code></pre></div>
<h2 dir="auto"><a id="user-content-integration-tests-that-depend-upon-the-parent-workspace" class="anchor" aria-hidden="true" href="#integration-tests-that-depend-upon-the-parent-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Integration Tests That Depend Upon The Parent Workspace</h2>
<p dir="auto">In the quickstart example, the child workspace does not reference the parent workspace. In many
cases, a child workspace will reference the parent workspace using a
<a href="https://bazel.build/rules/lib/globals#local_path_override" rel="nofollow">local_path_override</a> declaration in
their <code>MODULE.bazel</code> file to demonstrate functionality from the parent workspace.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# Child MODULE.bazel at examples/simple/MODULE.bazel

# Reference the parent workspace
local_path_override(
    module_name = &quot;my_parent_workspace&quot;,
    path = &quot;../..&quot;,
)"><pre lang="python" class="notranslate"><code># Child MODULE.bazel at examples/simple/MODULE.bazel

# Reference the parent workspace
local_path_override(
    module_name = "my_parent_workspace",
    path = "../..",
)
</code></pre></div>
<p dir="auto">This section explains how to use <code>rules_bazel_integration_test</code> in this situation. To review working
examples, check out <a href="https://github.com/cgrindel/bazel-starlib">bazel-starlib</a> and
<a href="https://github.com/cgrindel/swift_bazel">swift_bazel</a>.</p>
<h3 dir="auto"><a id="user-content-1-declare-a-filegroup-to-represent-the-parent-workspace-files" class="anchor" aria-hidden="true" href="#1-declare-a-filegroup-to-represent-the-parent-workspace-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>1. Declare a <code>filegroup</code> to represent the parent workspace files</h3>
<p dir="auto">The child workspace needs to access parent workspace files. To easily reference the files, declare a
<code>filegroup</code> at the root of the parent workspace to collect all of the files that the child workspace
needs. The values listed in the <code>srcs</code> should include every file and/or package that the child
workspaces require.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# This target collects all of the parent workspace files needed by the child workspaces.
filegroup(
    name = &quot;local_repository_files&quot;,
    # Include every package that is required by the child workspaces.
    srcs = [
        &quot;BUILD.bazel&quot;,
        &quot;WORKSPACE&quot;,
        &quot;//foo:all_files&quot;,
        &quot;//foo/internal:all_files&quot;,
        &quot;//foo/internal/modulemap_parser:all_files&quot;,
    ],
    visibility = [&quot;//:__subpackages__&quot;],
)"><pre lang="python" class="notranslate"><code># This target collects all of the parent workspace files needed by the child workspaces.
filegroup(
    name = "local_repository_files",
    # Include every package that is required by the child workspaces.
    srcs = [
        "BUILD.bazel",
        "WORKSPACE",
        "//foo:all_files",
        "//foo/internal:all_files",
        "//foo/internal/modulemap_parser:all_files",
    ],
    visibility = ["//:__subpackages__"],
)
</code></pre></div>
<p dir="auto">In every parent workspace package that is listed in the <code>srcs</code> above, create a filegroup globbing
all of the files in the package.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# Add to every package that is required by a child workspace.
filegroup(
    name = &quot;all_files&quot;,
    srcs = glob([&quot;*&quot;]),
    visibility = [&quot;//:__subpackages__&quot;],
)"><pre lang="python" class="notranslate"><code># Add to every package that is required by a child workspace.
filegroup(
    name = "all_files",
    srcs = glob(["*"]),
    visibility = ["//:__subpackages__"],
)
</code></pre></div>
<h3 dir="auto"><a id="user-content-2-update-the-integration-test-targets-to-include-the-parent-workspace-files" class="anchor" aria-hidden="true" href="#2-update-the-integration-test-targets-to-include-the-parent-workspace-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>2. Update the integration test targets to include the parent workspace files</h3>
<p dir="auto">The <a href="/doc/rules_and_macros_overview.md#bazel_integration_test"><code>bazel_integration_test</code></a> and
<a href="/doc/rules_and_macros_overview.md#bazel_integration_tests"><code>bazel_integration_tests</code></a> declarations
include a <code>workspace_files</code> attribute. If not specified, it defaults to a custom glob expression
selecting files under the child workspace directory. To include the parent workspace files, add the
attribute with an expression that globs the workspace files and the <code>//:local_repository_files</code>
target.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel_integration_test(
    name = &quot;simple_test&quot;,
    bazel_version = CURRENT_BAZEL_VERSION,
    test_runner = &quot;:simple_test_runner&quot;,
    workspace_files = integration_test_utils.glob_workspace_files(&quot;simple&quot;) + [
        &quot;//:local_repository_files&quot;,
    ],
    workspace_path = &quot;simple&quot;,
)"><pre lang="python" class="notranslate"><code>bazel_integration_test(
    name = "simple_test",
    bazel_version = CURRENT_BAZEL_VERSION,
    test_runner = ":simple_test_runner",
    workspace_files = integration_test_utils.glob_workspace_files("simple") + [
        "//:local_repository_files",
    ],
    workspace_path = "simple",
)
</code></pre></div>
<h3 dir="auto"><a id="user-content-3-execute-the-integration-tests" class="anchor" aria-hidden="true" href="#3-execute-the-integration-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>3. Execute the integration tests</h3>
<p dir="auto">Execute the integration test.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# Execute the integration test called simple_test
$ bazel test //examples:simple_test"><pre lang="sh" class="notranslate"><code># Execute the integration test called simple_test
$ bazel test //examples:simple_test
</code></pre></div>
<h2 dir="auto"><a id="user-content-custom-test-runner" class="anchor" aria-hidden="true" href="#custom-test-runner"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Custom Test Runner</h2>
<p dir="auto">For information on implementing a custom test runner, please see <a href="/doc/custom_test_runners.md">the
documentation</a>.</p>
<h2 dir="auto"><a id="user-content-bazelisk-bazel-version-formats" class="anchor" aria-hidden="true" href="#bazelisk-bazel-version-formats"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bazelisk Bazel Version Formats</h2>
<p dir="auto">Bazel integration tests require a Bazel version or a Bazel binary to use for the execution of an
integration test. Bazel version values can be a Bazel semantic version or a reference to a file that
contains a Bazel semantic version (e.g., <code>//:.bazelversion</code>). If you are using
<a href="https://github.com/bazelbuild/bazelisk">Bazelisk</a> to specify the version of Bazel for use in
development and CI, then specifying <code>//:.bazelversion</code> as one of the integration test versions may
make sense.</p>
<p dir="auto">Currently, <code>rules_bazel_integration_test</code> only supports Bazel semantic versions in the
<code>.bazelversion</code> file. If you are interested in being able to use Bazelisk's <code>&lt;FORK&gt;/&lt;VERSION&gt;</code>,
please upvote <a href="https://github.com/bazel-contrib/rules_bazel_integration_test/issues/67" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_bazel_integration_test/issues/67/hovercard">this issue</a>.
If you would like support for another format, please <a href="https://github.com/bazel-contrib/rules_bazel_integration_test/issues/new">file an
issue</a>.</p>
</article></div>