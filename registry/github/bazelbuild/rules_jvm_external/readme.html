<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 id="user-content-rules_jvm_external" dir="auto"><a class="heading-link" href="#rules_jvm_external">rules_jvm_external<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1>
<p dir="auto">Transitive Maven artifact resolution and publishing rules for Bazel.</p>
<p dir="auto"><a href="https://buildkite.com/bazel/rules-jvm-external" rel="nofollow"><img src="https://camo.githubusercontent.com/588955d40689487bd8571a63cbabec11233f3aeee423ca3fb47a8b5b36583c72/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f32366438393566353532353635326535373931356136303764306563643366633934356338323830613062646666383364392e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://badge.buildkite.com/26d895f5525652e57915a607d0ecd3fc945c8280a0bdff83d9.svg?branch=master" style="max-width: 100%;"></a></p>
<h1 id="user-content-table-of-contents" dir="auto"><a class="heading-link" href="#table-of-contents">Table of Contents<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1>
<ul dir="auto">
<li><a href="#rules_jvm_external">rules_jvm_external</a>
<ul dir="auto">
<li><a href="#features">Features</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#pinning-artifacts-and-integration-with-bazels-downloader">Pinning artifacts and integration with Bazel's downloader</a>
<ul dir="auto">
<li><a href="#updating-maven_installjson">Updating maven_install.json</a></li>
<li><a href="#custom-location-for-maven_installjson">Custom location for maven_install.json</a></li>
<li><a href="#multiple-maven_installjson-files">Multiple maven_install.json files</a></li>
</ul>
</li>
<li><a href="#generated-targets">Generated targets</a></li>
<li><a href="#outdated-artifacts">Outdated artifacts</a></li>
<li><a href="#advanced-usage">Advanced usage</a>
<ul dir="auto">
<li><a href="#fetch-source-jars">Fetch source JARs</a></li>
<li><a href="#checksum-verification">Checksum verification</a></li>
<li><a href="#artifact-helper-macro">artifact helper macro</a></li>
<li><a href="#multiple-maven_install-declarations-for-isolated-artifact-version-trees">Multiple maven_install declarations for isolated artifact version trees</a></li>
<li><a href="#detailed-dependency-information-specifications">Detailed dependency information specifications</a></li>
<li><a href="#artifact-exclusion">Artifact exclusion</a></li>
<li><a href="#compile-only-dependencies">Compile-only dependencies</a></li>
<li><a href="#resolving-user-specified-and-transitive-dependency-version-conflicts">Resolving user-specified and transitive dependency version conflicts</a></li>
<li><a href="#overriding-generated-targets">Overriding generated targets</a></li>
<li><a href="#proxies">Proxies</a></li>
<li><a href="#repository-aliases">Repository aliases</a>
<ul dir="auto">
<li><a href="#repository-remapping">Repository remapping</a></li>
</ul>
</li>
<li><a href="#hiding-transitive-dependencies">Hiding transitive dependencies</a></li>
<li><a href="#fetch-and-resolve-timeout">Fetch and resolve timeout</a></li>
<li><a href="#duplicate-artifact-warning">Duplicate artifact warning</a></li>
<li><a href="#resolving-issues-with-nonstandard-system-default-jdks">Resolving issues with nonstandard system default JDKs</a></li>
</ul>
</li>
<li><a href="#exporting-and-consuming-artifacts-from-external-repositories">Exporting and consuming artifacts from external repositories</a></li>
<li><a href="#publishing-to-external-repositories">Publishing to external repositories</a></li>
<li><a href="#demo">Demo</a></li>
<li><a href="#projects-using-rules_jvm_external">Projects using rules_jvm_external</a></li>
<li><a href="#generating-documentation">Generating documentation</a></li>
</ul>
</li>
</ul>
<h2 id="user-content-features" dir="auto"><a class="heading-link" href="#features">Features<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>WORKSPACE configuration</li>
<li>JAR, AAR, source JARs</li>
<li>Custom Maven repositories</li>
<li>Private Maven repositories with HTTP Basic Authentication</li>
<li>Artifact version resolution with Coursier</li>
<li>Integration with Bazel's downloader and caching mechanisms for sharing artifacts across Bazel workspaces</li>
<li>Pin resolved artifacts with their SHA-256 checksums into a version-controllable JSON file</li>
<li>Versionless target labels for simpler dependency management</li>
<li>Ability to declare multiple sets of versioned artifacts</li>
<li>Supported on Windows, macOS, Linux</li>
</ul>
<p dir="auto">Get the <a href="https://github.com/bazelbuild/rules_jvm_external/releases/latest">latest release
here</a>.</p>
<h2 id="user-content-prerequisites" dir="auto"><a class="heading-link" href="#prerequisites">Prerequisites<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>Bazel 4.0.0 and above</li>
</ul>
<p dir="auto">Support for Bazel versions before <code>4.0.0</code> is only available on rules_jvm_external releases <code>4.2</code> or earlier.</p>
<h2 id="user-content-usage" dir="auto"><a class="heading-link" href="#usage">Usage<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<blockquote>
<p dir="auto">New: on Bazel 6, you can use bzlmod instead of following directions below.
See <a href="./docs/bzlmod.md">bzlmod</a>.
Expect rough edges and incomplete support as bzlmod is still a new feature as of early 2023.
Note, bzlmod is expected to be on-by-default in Bazel 7.0.</p>
</blockquote>
<p dir="auto">List the top-level Maven artifacts and servers in the WORKSPACE:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

RULES_JVM_EXTERNAL_TAG = &quot;4.5&quot;
RULES_JVM_EXTERNAL_SHA = &quot;b17d7388feb9bfa7f2fa09031b32707df529f26c91ab9e5d909eb1676badd9a6&quot;

http_archive(
    name = &quot;rules_jvm_external&quot;,
    strip_prefix = &quot;rules_jvm_external-%s&quot; % RULES_JVM_EXTERNAL_TAG,
    sha256 = RULES_JVM_EXTERNAL_SHA,
    url = &quot;https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip&quot; % RULES_JVM_EXTERNAL_TAG,
)

load(&quot;@rules_jvm_external//:repositories.bzl&quot;, &quot;rules_jvm_external_deps&quot;)

rules_jvm_external_deps()

load(&quot;@rules_jvm_external//:setup.bzl&quot;, &quot;rules_jvm_external_setup&quot;)

rules_jvm_external_setup()

load(&quot;@rules_jvm_external//:defs.bzl&quot;, &quot;maven_install&quot;)

maven_install(
    artifacts = [
        &quot;junit:junit:4.12&quot;,
        &quot;androidx.test.espresso:espresso-core:3.1.1&quot;,
        &quot;org.hamcrest:hamcrest-library:1.3&quot;,
    ],
    repositories = [
        # Private repositories are supported through HTTP Basic auth
        &quot;http://username:password@localhost:8081/artifactory/my-repository&quot;,
        &quot;https://maven.google.com&quot;,
        &quot;https://repo1.maven.org/maven2&quot;,
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-v">RULES_JVM_EXTERNAL_TAG</span> <span class="pl-c1">=</span> <span class="pl-s">"4.5"</span>
<span class="pl-v">RULES_JVM_EXTERNAL_SHA</span> <span class="pl-c1">=</span> <span class="pl-s">"b17d7388feb9bfa7f2fa09031b32707df529f26c91ab9e5d909eb1676badd9a6"</span>

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_jvm_external"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_jvm_external-%s"</span> <span class="pl-c1">%</span> <span class="pl-v">RULES_JVM_EXTERNAL_TAG</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-v">RULES_JVM_EXTERNAL_SHA</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip"</span> <span class="pl-c1">%</span> <span class="pl-v">RULES_JVM_EXTERNAL_TAG</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:repositories.bzl"</span>, <span class="pl-s">"rules_jvm_external_deps"</span>)

<span class="pl-en">rules_jvm_external_deps</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:setup.bzl"</span>, <span class="pl-s">"rules_jvm_external_setup"</span>)

<span class="pl-en">rules_jvm_external_setup</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:defs.bzl"</span>, <span class="pl-s">"maven_install"</span>)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"junit:junit:4.12"</span>,
        <span class="pl-s">"androidx.test.espresso:espresso-core:3.1.1"</span>,
        <span class="pl-s">"org.hamcrest:hamcrest-library:1.3"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># Private repositories are supported through HTTP Basic auth</span>
        <span class="pl-s">"http://username:password@localhost:8081/artifactory/my-repository"</span>,
        <span class="pl-s">"https://maven.google.com"</span>,
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ],
)</pre></div>
<p dir="auto">Credentials for private repositories can also be specified using a property file
or environment variables. See the <a href="https://get-coursier.io/docs/other-credentials.html#property-file" rel="nofollow">Coursier
documentation</a>
for more information.</p>
<p dir="auto"><code>rules_jvm_external_deps</code> uses a default list of maven repositories to download
<code>rules_jvm_external</code>'s own dependencies from. Should you wish to change this,
use the <code>repositories</code> parameter:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="rules_jvm_external_deps(repositories = [&quot;https://mycorp.com/artifacts&quot;])
rules_jvm_external_setup()"><pre><span class="pl-en">rules_jvm_external_deps</span>(<span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://mycorp.com/artifacts"</span>])
<span class="pl-en">rules_jvm_external_setup</span>()</pre></div>
<p dir="auto">Next, reference the artifacts in the BUILD file with their versionless label:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="java_library(
    name = &quot;java_test_deps&quot;,
    exports = [
        &quot;@maven//:junit_junit&quot;,
        &quot;@maven//:org_hamcrest_hamcrest_library&quot;,
    ],
)

android_library(
    name = &quot;android_test_deps&quot;,
    exports = [
        &quot;@maven//:junit_junit&quot;,
        &quot;@maven//:androidx_test_espresso_espresso_core&quot;,
    ],
)"><pre><span class="pl-en">java_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"java_test_deps"</span>,
    <span class="pl-s1">exports</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@maven//:junit_junit"</span>,
        <span class="pl-s">"@maven//:org_hamcrest_hamcrest_library"</span>,
    ],
)

<span class="pl-en">android_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"android_test_deps"</span>,
    <span class="pl-s1">exports</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@maven//:junit_junit"</span>,
        <span class="pl-s">"@maven//:androidx_test_espresso_espresso_core"</span>,
    ],
)</pre></div>
<p dir="auto">The default label syntax for an artifact <code>foo.bar:baz-qux:1.2.3</code> is <code>@maven//:foo_bar_baz_qux</code>. That is,</p>
<ul dir="auto">
<li>All non-alphanumeric characters are substituted with underscores.</li>
<li>Only the group and artifact IDs are required.</li>
<li>The target is located in the <code>@maven</code> top level package (<code>@maven//</code>).</li>
</ul>
<h2 id="user-content-api-reference" dir="auto"><a class="heading-link" href="#api-reference">API Reference<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">You can find the complete API reference at <a href="docs/api.md">docs/api.md</a>.</p>
<h2 id="user-content-pinning-artifacts-and-integration-with-bazels-downloader" dir="auto"><a class="heading-link" href="#pinning-artifacts-and-integration-with-bazels-downloader">Pinning artifacts and integration with Bazel's downloader<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto"><code>rules_jvm_external</code> supports pinning artifacts and their SHA-256 checksums into
a <code>maven_install.json</code> file that can be checked into your repository.</p>
<p dir="auto">Without artifact pinning, in a clean checkout of your project, <code>rules_jvm_external</code>
executes the full artifact resolution and fetching steps (which can take a bit of time)
and does not verify the integrity of the artifacts against their checksums. The
downloaded artifacts also cannot be shared across Bazel workspaces.</p>
<p dir="auto">By pinning artifact versions, you can get improved artifact resolution and build times,
since using <code>maven_install.json</code> enables <code>rules_jvm_external</code> to integrate with Bazel's
downloader that caches files on their sha256 checksums. It also improves resiliency and
integrity by tracking the sha256 checksums and original artifact urls in the
JSON file.</p>
<p dir="auto">Since all artifacts are persisted locally in Bazel's cache, it means that
<strong>fully offline builds are possible</strong> after the initial <code>bazel fetch @maven//...</code>.
The artifacts are downloaded with <code>http_file</code> which supports <code>netrc</code> for authentication.
Your <code>~/.netrc</code> will be included automatically.
To pass machine login credentials in the ~/.netrc file to coursier, specify
<code>use_credentials_from_home_netrc_file = True</code> in your <code>maven_install</code> rule.
For additional credentials, add them in the repository URLs passed to <code>maven_install</code>
(so they will be included in the generated JSON).
Alternatively, pass an array of <code>additional_netrc_lines</code> to <code>maven_install</code> for authentication with credentials from
outside the workspace.</p>
<p dir="auto">To get started with pinning artifacts, run the following command to generate the
initial <code>maven_install.json</code> at the root of your Bazel workspace:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel run @maven//:pin"><pre class="notranslate"><code>$ bazel run @maven//:pin
</code></pre></div>
<p dir="auto">Then, specify <code>maven_install_json</code> in <code>maven_install</code> and load
<code>pinned_maven_install</code> from <code>@maven//:defs.bzl</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    # artifacts, repositories, ...
    maven_install_json = &quot;//:maven_install.json&quot;,
)

load(&quot;@maven//:defs.bzl&quot;, &quot;pinned_maven_install&quot;)
pinned_maven_install()"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-c"># artifacts, repositories, ...</span>
    <span class="pl-s1">maven_install_json</span> <span class="pl-c1">=</span> <span class="pl-s">"//:maven_install.json"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@maven//:defs.bzl"</span>, <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">pinned_maven_install</span>()</pre></div>
<p dir="auto"><strong>Note:</strong> The <code>//:maven_install.json</code> label assumes you have a BUILD file in
your project's root directory. If you do not have one, create an empty BUILD
file to fix issues you may see. See
<a href="https://github.com/bazelbuild/rules_jvm_external/issues/242" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/rules_jvm_external/issues/242/hovercard">#242</a></p>
<p dir="auto"><strong>Note:</strong> If you're using an older version of <code>rules_jvm_external</code> and
haven't repinned your dependencies, you may see a warning that you lock
file "does not contain a signature of the required artifacts" then don't
worry: either ignore the warning or repin the dependencies.</p>
<h3 id="user-content-updating-maven_installjson" dir="auto"><a class="heading-link" href="#updating-maven_installjson">Updating <code>maven_install.json</code><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Whenever you make a change to the list of <code>artifacts</code> or <code>repositories</code> and want
to update <code>maven_install.json</code>, run this command to re-pin the unpinned <code>@maven</code>
repository:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel run @unpinned_maven//:pin"><pre class="notranslate"><code>$ bazel run @unpinned_maven//:pin
</code></pre></div>
<p dir="auto">Without re-pinning, <code>maven_install</code> will not pick up the changes made to the
WORKSPACE, as <code>maven_install.json</code> is now the source of truth.</p>
<p dir="auto">Note that the repository is <code>@unpinned_maven</code> instead of <code>@maven</code>. When using
artifact pinning, each <code>maven_install</code> repository (e.g. <code>@maven</code>) will be
accompanied by an unpinned repository. This repository name has the <code>@unpinned_</code>
prefix (e.g.<code>@unpinned_maven</code> or <code>@unpinned_&lt;your_maven_install_name&gt;</code>). For
example, if your <code>maven_install</code> is named <code>@foo</code>, <code>@unpinned_foo</code> will be
created.</p>
<h3 id="user-content-requiring-lock-file-repinning-when-the-list-of-artifacts-changes" dir="auto"><a class="heading-link" href="#requiring-lock-file-repinning-when-the-list-of-artifacts-changes">Requiring lock file repinning when the list of artifacts changes<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">It can be easy to forget to update the <code>maven_install.json</code> lock file
when updating artifacts in a <code>maven_install</code>. Normally,
rules_jvm_external will print a warning to the console and continue
the build when this happens, but by setting the
<code>fail_if_repin_required</code> attribute to <code>True</code>, this will be treated as
a build error, causing the build to fail. When this attribute is set,
it is possible to update the <code>maven_install.json</code> file using:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# To repin everything:
REPIN=1 bazel run @unpinned_maven//:pin

# To only repin rules_jvm_external:
RULES_JVM_EXTERNAL_REPIN=1 bazel run @unpinned_maven//:pin"><pre><span class="pl-c"><span class="pl-c">#</span> To repin everything:</span>
REPIN=1 bazel run @unpinned_maven//:pin

<span class="pl-c"><span class="pl-c">#</span> To only repin rules_jvm_external:</span>
RULES_JVM_EXTERNAL_REPIN=1 bazel run @unpinned_maven//:pin</pre></div>
<p dir="auto">Alternatively, it is also possible to modify the
<code>fail_if_repin_required</code> attribute in your <code>WORKSPACE</code> file, run
<code>bazel run @unpinned_maven//:pin</code> and then reset the
<code>fail_if_repin_required</code> attribute.</p>
<h3 id="user-content-custom-location-for-maven_installjson" dir="auto"><a class="heading-link" href="#custom-location-for-maven_installjson">Custom location for <code>maven_install.json</code><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">You can specify a custom location for <code>maven_install.json</code> by changing the
<code>maven_install_json</code> attribute value to point to the new file label. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;maven_install_in_custom_location&quot;,
    artifacts = [&quot;com.google.guava:guava:27.0-jre&quot;],
    repositories = [&quot;https://repo1.maven.org/maven2&quot;],
    maven_install_json = &quot;@rules_jvm_external//tests/custom_maven_install:maven_install.json&quot;,
)

load(&quot;@maven_install_in_custom_location//:defs.bzl&quot;, &quot;pinned_maven_install&quot;)
pinned_maven_install()"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven_install_in_custom_location"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [<span class="pl-s">"com.google.guava:guava:27.0-jre"</span>],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://repo1.maven.org/maven2"</span>],
    <span class="pl-s1">maven_install_json</span> <span class="pl-c1">=</span> <span class="pl-s">"@rules_jvm_external//tests/custom_maven_install:maven_install.json"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@maven_install_in_custom_location//:defs.bzl"</span>, <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">pinned_maven_install</span>()</pre></div>
<p dir="auto">Future artifact pinning updates to <code>maven_install.json</code> will overwrite the file
at the specified path instead of creating a new one at the default root
directory location.</p>
<h3 id="user-content-multiple-maven_installjson-files" dir="auto"><a class="heading-link" href="#multiple-maven_installjson-files">Multiple <code>maven_install.json</code> files<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If you have multiple <code>maven_install</code> declarations, you have to alias
<code>pinned_maven_install</code> to another name to prevent redefinitions:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;foo&quot;,
    maven_install_json = &quot;//:foo_maven_install.json&quot;,
    # ...
)

load(&quot;@foo//:defs.bzl&quot;, foo_pinned_maven_install = &quot;pinned_maven_install&quot;)
foo_pinned_maven_install()

maven_install(
    name = &quot;bar&quot;,
    maven_install_json = &quot;//:bar_maven_install.json&quot;,
    # ...
)

load(&quot;@bar//:defs.bzl&quot;, bar_pinned_maven_install = &quot;pinned_maven_install&quot;)
bar_pinned_maven_install()"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">maven_install_json</span> <span class="pl-c1">=</span> <span class="pl-s">"//:foo_maven_install.json"</span>,
    <span class="pl-c"># ...</span>
)

<span class="pl-en">load</span>(<span class="pl-s">"@foo//:defs.bzl"</span>, <span class="pl-s1">foo_pinned_maven_install</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">foo_pinned_maven_install</span>()

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bar"</span>,
    <span class="pl-s1">maven_install_json</span> <span class="pl-c1">=</span> <span class="pl-s">"//:bar_maven_install.json"</span>,
    <span class="pl-c"># ...</span>
)

<span class="pl-en">load</span>(<span class="pl-s">"@bar//:defs.bzl"</span>, <span class="pl-s1">bar_pinned_maven_install</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">bar_pinned_maven_install</span>()</pre></div>
<h2 id="user-content-generated-targets" dir="auto"><a class="heading-link" href="#generated-targets">Generated targets<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">For the <code>junit:junit</code> example, using <code>bazel query @maven//:all --output=build</code>, we can see that the rule generated these targets:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="alias(
  name = &quot;junit_junit_4_12&quot;,
  actual = &quot;@maven//:junit_junit&quot;,
)

jvm_import(
  name = &quot;junit_junit&quot;,
  jars = [&quot;@maven//:https/repo1.maven.org/maven2/junit/junit/4.12/junit-4.12.jar&quot;],
  srcjar = &quot;@maven//:https/repo1.maven.org/maven2/junit/junit/4.12/junit-4.12-sources.jar&quot;,
  deps = [&quot;@maven//:org_hamcrest_hamcrest_core&quot;],
  tags = [&quot;maven_coordinates=junit:junit:4.12&quot;],
)

jvm_import(
  name = &quot;org_hamcrest_hamcrest_core&quot;,
  jars = [&quot;@maven//:https/repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar&quot;],
  srcjar = &quot;@maven//:https/repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3-sources.jar&quot;,
  deps = [],
  tags = [&quot;maven_coordinates=org.hamcrest:hamcrest.library:1.3&quot;],
)"><pre><span class="pl-en">alias</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"junit_junit_4_12"</span>,
  <span class="pl-s1">actual</span> <span class="pl-c1">=</span> <span class="pl-s">"@maven//:junit_junit"</span>,
)

<span class="pl-en">jvm_import</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"junit_junit"</span>,
  <span class="pl-s1">jars</span> <span class="pl-c1">=</span> [<span class="pl-s">"@maven//:https/repo1.maven.org/maven2/junit/junit/4.12/junit-4.12.jar"</span>],
  <span class="pl-s1">srcjar</span> <span class="pl-c1">=</span> <span class="pl-s">"@maven//:https/repo1.maven.org/maven2/junit/junit/4.12/junit-4.12-sources.jar"</span>,
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">"@maven//:org_hamcrest_hamcrest_core"</span>],
  <span class="pl-s1">tags</span> <span class="pl-c1">=</span> [<span class="pl-s">"maven_coordinates=junit:junit:4.12"</span>],
)

<span class="pl-en">jvm_import</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"org_hamcrest_hamcrest_core"</span>,
  <span class="pl-s1">jars</span> <span class="pl-c1">=</span> [<span class="pl-s">"@maven//:https/repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar"</span>],
  <span class="pl-s1">srcjar</span> <span class="pl-c1">=</span> <span class="pl-s">"@maven//:https/repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3-sources.jar"</span>,
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [],
  <span class="pl-s1">tags</span> <span class="pl-c1">=</span> [<span class="pl-s">"maven_coordinates=org.hamcrest:hamcrest.library:1.3"</span>],
)</pre></div>
<p dir="auto">These targets can be referenced by:</p>
<ul dir="auto">
<li><code>@maven//:junit_junit</code></li>
<li><code>@maven//:org_hamcrest_hamcrest_core</code></li>
</ul>
<p dir="auto"><strong>Transitive classes</strong>: To use a class from <code>hamcrest-core</code> in your test, it's not sufficient to just
depend on <code>@maven//:junit_junit</code> even though JUnit depends on Hamcrest. The compile classes are not exported
transitively, so your test should also depend on <code>@maven//:org_hamcrest_hamcrest_core</code>.</p>
<p dir="auto"><strong>Original coordinates</strong>: The generated <code>tags</code> attribute value also contains the original coordinates of
the artifact, which integrates with rules like <a href="https://github.com/google/bazel-common/blob/f1115e0f777f08c3cdb115526c4e663005bec69b/tools/maven/pom_file.bzl#L177">bazel-common's
<code>pom_file</code></a>
for generating POM files. See the <a href="examples/pom_file_generation/"><code>pom_file_generation</code>
example</a> for more information.</p>
<h2 id="user-content-outdated-artifacts" dir="auto"><a class="heading-link" href="#outdated-artifacts">Outdated artifacts<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To check for updates of artifacts, run the following command at the root of your Bazel workspace:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel run @maven//:outdated"><pre class="notranslate"><code>$ bazel run @maven//:outdated
</code></pre></div>
<h2 id="user-content-advanced-usage" dir="auto"><a class="heading-link" href="#advanced-usage">Advanced usage<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-fetch-source-jars" dir="auto"><a class="heading-link" href="#fetch-source-jars">Fetch source JARs<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">To download the source JAR alongside the main artifact JAR, set <code>fetch_sources = True</code> in <code>maven_install</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    fetch_sources = True,
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">fetch_sources</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)</pre></div>
<h3 id="user-content-checksum-verification" dir="auto"><a class="heading-link" href="#checksum-verification">Checksum verification<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Artifact resolution will fail if a <code>SHA-1</code> or <code>MD5</code> checksum file for the
artifact is missing in the repository. To disable this behavior, set
<code>fail_on_missing_checksum = False</code> in <code>maven_install</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    fail_on_missing_checksum = False,
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">fail_on_missing_checksum</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>,
)</pre></div>
<h3 id="user-content-using-a-custom-coursier-download-url" dir="auto"><a class="heading-link" href="#using-a-custom-coursier-download-url">Using a custom Coursier download url<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">By default bazel bootstraps Coursier via <a href="private/versions.bzl">the urls specificed in versions.bzl</a>.
However in case they are not directly accessible in your environment, you can also specify a custom
url to download Coursier. For example:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel build @maven_with_unsafe_shared_cache//... --repo_env=COURSIER_URL='https://my_secret_host.com/vXYZ/coursier.jar'"><pre class="notranslate"><code>$ bazel build @maven_with_unsafe_shared_cache//... --repo_env=COURSIER_URL='https://my_secret_host.com/vXYZ/coursier.jar'
</code></pre></div>
<p dir="auto">Please note it still requires the SHA to match.</p>
<h3 id="user-content-artifact-helper-macro" dir="auto"><a class="heading-link" href="#artifact-helper-macro"><code>artifact</code> helper macro<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The <code>artifact</code> macro translates the artifact's <code>group:artifact</code> coordinates to
the label of the versionless target. This target is an
<a href="https://docs.bazel.build/versions/master/be/general.html#alias" rel="nofollow">alias</a> that
points to the <code>java_import</code>/<code>aar_import</code> target in the <code>@maven</code> repository,
which includes the transitive dependencies specified in the top level artifact's
POM file.</p>
<p dir="auto">For example, <code>@maven//:junit_junit</code> is equivalent to <code>artifact("junit:junit")</code>.</p>
<p dir="auto">To use it, add the load statement to the top of your BUILD file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_jvm_external//:defs.bzl&quot;, &quot;artifact&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:defs.bzl"</span>, <span class="pl-s">"artifact"</span>)</pre></div>
<p dir="auto">Full <code>group:artifact:[packaging:[classifier:]]version</code> maven coordinates are also
supported and translate to corresponding versionless target.</p>
<p dir="auto">Note that usage of this macro makes BUILD file refactoring with tools like
<code>buildozer</code> more difficult, because the macro hides the actual target label at
the syntax level.</p>
<h3 id="user-content-multiple-maven_install-declarations-for-isolated-artifact-version-trees" dir="auto"><a class="heading-link" href="#multiple-maven_install-declarations-for-isolated-artifact-version-trees">Multiple <code>maven_install</code> declarations for isolated artifact version trees<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If your WORKSPACE contains several projects that use different versions of the
same artifact, you can specify multiple <code>maven_install</code> declarations in the
WORKSPACE, with a unique repository name for each of them.</p>
<p dir="auto">For example, if you want to use the JRE version of Guava for a server app, and
the Android version for an Android app, you can specify two <code>maven_install</code>
declarations:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;server_app&quot;,
    artifacts = [
        &quot;com.google.guava:guava:27.0-jre&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ],
)

maven_install(
    name = &quot;android_app&quot;,
    artifacts = [
        &quot;com.google.guava:guava:27.0-android&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ],
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"server_app"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.guava:guava:27.0-jre"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ],
)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"android_app"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.guava:guava:27.0-android"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ],
)</pre></div>
<p dir="auto">This way, <code>rules_jvm_external</code> will invoke coursier to resolve artifact versions for
both repositories independent of each other. Coursier will fail if it encounters
version conflicts that it cannot resolve. The two Guava targets can then be used
in BUILD files like so:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="java_binary(
    name = &quot;my_server_app&quot;,
    srcs = ...
    deps = [
        # a versionless alias to @server_app//:com_google_guava_guava_27_0_jre
        &quot;@server_app//:com_google_guava_guava&quot;,
    ]
)

android_binary(
    name = &quot;my_android_app&quot;,
    srcs = ...
    deps = [
        # a versionless alias to @android_app//:com_google_guava_guava_27_0_android
        &quot;@android_app//:com_google_guava_guava&quot;,
    ]
)"><pre><span class="pl-en">java_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_server_app"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> ...
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># a versionless alias to @server_app//:com_google_guava_guava_27_0_jre</span>
        <span class="pl-s">"@server_app//:com_google_guava_guava"</span>,
    ]
)

<span class="pl-en">android_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_android_app"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> ...
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># a versionless alias to @android_app//:com_google_guava_guava_27_0_android</span>
        <span class="pl-s">"@android_app//:com_google_guava_guava"</span>,
    ]
)</pre></div>
<h3 id="user-content-detailed-dependency-information-specifications" dir="auto"><a class="heading-link" href="#detailed-dependency-information-specifications">Detailed dependency information specifications<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Although you can always give a dependency as a Maven coordinate string,
occasionally special handling is required in the form of additional directives
to properly situate the artifact in the dependency tree. For example, a given
artifact may need to have one of its dependencies excluded to prevent a
conflict.</p>
<p dir="auto">This situation is provided for by allowing the artifact to be specified as a map
containing all of the required information. This map can express more
information than the coordinate strings can, so internally the coordinate
strings are parsed into the artifact map with default values for the additional
items. To assist in generating the maps, you can pull in the file <code>specs.bzl</code>
alongside <code>defs.bzl</code> and import the <code>maven</code> struct, which provides several
helper functions to assist in creating these maps. An example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_jvm_external//:defs.bzl&quot;, &quot;artifact&quot;)
load(&quot;@rules_jvm_external//:specs.bzl&quot;, &quot;maven&quot;)

maven_install(
    artifacts = [
        maven.artifact(
            group = &quot;com.google.guava&quot;,
            artifact = &quot;guava&quot;,
            version = &quot;27.0-android&quot;,
            exclusions = [
                ...
            ]
        ),
        &quot;junit:junit:4.12&quot;,
        ...
    ],
    repositories = [
        maven.repository(
            &quot;https://some.private.maven.re/po&quot;,
            user = &quot;johndoe&quot;,
            password = &quot;example-password&quot;
        ),
        &quot;https://repo1.maven.org/maven2&quot;,
        ...
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:defs.bzl"</span>, <span class="pl-s">"artifact"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:specs.bzl"</span>, <span class="pl-s">"maven"</span>)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">maven</span>.<span class="pl-en">artifact</span>(
            <span class="pl-s1">group</span> <span class="pl-c1">=</span> <span class="pl-s">"com.google.guava"</span>,
            <span class="pl-s1">artifact</span> <span class="pl-c1">=</span> <span class="pl-s">"guava"</span>,
            <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"27.0-android"</span>,
            <span class="pl-s1">exclusions</span> <span class="pl-c1">=</span> [
                ...
            ]
        ),
        <span class="pl-s">"junit:junit:4.12"</span>,
        ...
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">maven</span>.<span class="pl-en">repository</span>(
            <span class="pl-s">"https://some.private.maven.re/po"</span>,
            <span class="pl-s1">user</span> <span class="pl-c1">=</span> <span class="pl-s">"johndoe"</span>,
            <span class="pl-s1">password</span> <span class="pl-c1">=</span> <span class="pl-s">"example-password"</span>
        ),
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
        ...
    ],
)</pre></div>
<p dir="auto">Note <a href="docs/bzlmod.md">when using <code>bzlmod</code></a> the syntax in <code>MODULE.bazel</code> is
different than shown above.</p>
<h3 id="user-content-artifact-exclusion" dir="auto"><a class="heading-link" href="#artifact-exclusion">Artifact exclusion<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If you want to exclude an artifact from the transitive closure of a top level
artifact, specify its <code>group-id:artifact-id</code> in the <code>exclusions</code> attribute of
the <code>maven.artifact</code> helper:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_jvm_external//:specs.bzl&quot;, &quot;maven&quot;)

maven_install(
    artifacts = [
        maven.artifact(
            group = &quot;com.google.guava&quot;,
            artifact = &quot;guava&quot;,
            version = &quot;27.0-jre&quot;,
            exclusions = [
                maven.exclusion(
                    group = &quot;org.codehaus.mojo&quot;,
                    artifact = &quot;animal-sniffer-annotations&quot;
                ),
                &quot;com.google.j2objc:j2objc-annotations&quot;,
            ]
        ),
        # ...
    ],
    repositories = [
        # ...
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:specs.bzl"</span>, <span class="pl-s">"maven"</span>)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">maven</span>.<span class="pl-en">artifact</span>(
            <span class="pl-s1">group</span> <span class="pl-c1">=</span> <span class="pl-s">"com.google.guava"</span>,
            <span class="pl-s1">artifact</span> <span class="pl-c1">=</span> <span class="pl-s">"guava"</span>,
            <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"27.0-jre"</span>,
            <span class="pl-s1">exclusions</span> <span class="pl-c1">=</span> [
                <span class="pl-s1">maven</span>.<span class="pl-en">exclusion</span>(
                    <span class="pl-s1">group</span> <span class="pl-c1">=</span> <span class="pl-s">"org.codehaus.mojo"</span>,
                    <span class="pl-s1">artifact</span> <span class="pl-c1">=</span> <span class="pl-s">"animal-sniffer-annotations"</span>
                ),
                <span class="pl-s">"com.google.j2objc:j2objc-annotations"</span>,
            ]
        ),
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
)</pre></div>
<p dir="auto">You can specify the exclusion using either the <code>maven.exclusion</code> helper or the
<code>group-id:artifact-id</code> string directly.</p>
<p dir="auto">You can also exclude artifacts globally using the <code>excluded_artifacts</code>
attribute in <code>maven_install</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    excluded_artifacts = [
        &quot;com.google.guava:guava&quot;,
    ],
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">excluded_artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.guava:guava"</span>,
    ],
)</pre></div>
<h3 id="user-content-compile-only-dependencies" dir="auto"><a class="heading-link" href="#compile-only-dependencies">Compile-only dependencies<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If you want to mark certain artifacts as compile-only dependencies, use the
<code>neverlink</code> attribute in the <code>maven.artifact</code> helper:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_jvm_external//:specs.bzl&quot;, &quot;maven&quot;)

maven_install(
    artifacts = [
        maven.artifact(&quot;com.squareup&quot;, &quot;javapoet&quot;, &quot;1.11.0&quot;, neverlink = True),
    ],
    # ...
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:specs.bzl"</span>, <span class="pl-s">"maven"</span>)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">maven</span>.<span class="pl-en">artifact</span>(<span class="pl-s">"com.squareup"</span>, <span class="pl-s">"javapoet"</span>, <span class="pl-s">"1.11.0"</span>, <span class="pl-s1">neverlink</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>),
    ],
    <span class="pl-c"># ...</span>
)</pre></div>
<p dir="auto">This instructs <code>rules_jvm_external</code> to mark the generated target for
<code>com.squareup:javapoet</code> with the <code>neverlink = True</code> attribute, making the
artifact available only for compilation and not at runtime.</p>
<h3 id="user-content-test-only-dependencies" dir="auto"><a class="heading-link" href="#test-only-dependencies">Test-only dependencies<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If you want to mark certain artifacts as test-only dependencies, use the
<code>testonly</code> attribute in the <code>maven.artifact</code> helper:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_jvm_external//:specs.bzl&quot;, &quot;maven&quot;)

maven_install(
    artifacts = [
        maven.artifact(&quot;junit&quot;, &quot;junit&quot;, &quot;4.13&quot;, testonly = True),
    ],
    # ...
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:specs.bzl"</span>, <span class="pl-s">"maven"</span>)

<span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">maven</span>.<span class="pl-en">artifact</span>(<span class="pl-s">"junit"</span>, <span class="pl-s">"junit"</span>, <span class="pl-s">"4.13"</span>, <span class="pl-s1">testonly</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>),
    ],
    <span class="pl-c"># ...</span>
)</pre></div>
<p dir="auto">This instructs <code>rules_jvm_external</code> to mark the generated target for
<code>junit:Junit</code> with the <code>testonly = True</code> attribute, making the
artifact available only for tests (e.g. <code>java_test</code>), or targets specifically
marked as <code>testonly = True</code>.</p>
<h3 id="user-content-resolving-user-specified-and-transitive-dependency-version-conflicts" dir="auto"><a class="heading-link" href="#resolving-user-specified-and-transitive-dependency-version-conflicts">Resolving user-specified and transitive dependency version conflicts<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Use the <code>version_conflict_policy</code> attribute to decide how to resolve conflicts
between artifact versions specified in your <code>maven_install</code> rule and those
implicitly picked up as transitive dependencies.</p>
<p dir="auto">The attribute value can be either <code>default</code> or <code>pinned</code>.</p>
<p dir="auto"><code>default</code>: use <a href="https://get-coursier.io/docs/other-version-handling" rel="nofollow">Coursier's default algorithm</a>
for version handling.</p>
<p dir="auto"><code>pinned</code>: pin the versions of the artifacts that are explicitly specified in <code>maven_install</code>.</p>
<p dir="auto">For example, pulling in guava transitively via google-cloud-storage resolves to
guava-26.0-android.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;pinning&quot;,
    artifacts = [
        &quot;com.google.cloud:google-cloud-storage:1.66.0&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ]
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pinning"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.cloud:google-cloud-storage:1.66.0"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ]
)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_26_0_android"><pre class="notranslate"><code>$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_26_0_android
</code></pre></div>
<p dir="auto">Pulling in guava-27.0-android directly works as expected.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;pinning&quot;,
    artifacts = [
        &quot;com.google.cloud:google-cloud-storage:1.66.0&quot;,
        &quot;com.google.guava:guava:27.0-android&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ]
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pinning"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.cloud:google-cloud-storage:1.66.0"</span>,
        <span class="pl-s">"com.google.guava:guava:27.0-android"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ]
)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_27_0_android"><pre class="notranslate"><code>$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_27_0_android
</code></pre></div>
<p dir="auto">Pulling in guava-25.0-android (a lower version), resolves to guava-26.0-android. This is the default version conflict policy in action, where artifacts are resolved to the highest version.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;pinning&quot;,
    artifacts = [
        &quot;com.google.cloud:google-cloud-storage:1.66.0&quot;,
        &quot;com.google.guava:guava:25.0-android&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ]
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pinning"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.cloud:google-cloud-storage:1.66.0"</span>,
        <span class="pl-s">"com.google.guava:guava:25.0-android"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ]
)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_26_0_android"><pre class="notranslate"><code>$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_26_0_android
</code></pre></div>
<p dir="auto">Now, if we add <code>version_conflict_policy = "pinned"</code>, we should see guava-25.0-android getting pulled instead. The rest of non-specified artifacts still resolve to the highest version in the case of version conflicts.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;pinning&quot;,
    artifacts = [
        &quot;com.google.cloud:google-cloud-storage:1.66.0&quot;,
        &quot;com.google.guava:guava:25.0-android&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ]
    version_conflict_policy = &quot;pinned&quot;,
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pinning"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.cloud:google-cloud-storage:1.66.0"</span>,
        <span class="pl-s">"com.google.guava:guava:25.0-android"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ]
    <span class="pl-s1">version_conflict_policy</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned"</span>,
)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_25_0_android"><pre class="notranslate"><code>$ bazel query @pinning//:all | grep guava_guava
@pinning//:com_google_guava_guava
@pinning//:com_google_guava_guava_25_0_android
</code></pre></div>
<h3 id="user-content-overriding-generated-targets" dir="auto"><a class="heading-link" href="#overriding-generated-targets">Overriding generated targets<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">You can override the generated targets for artifacts with a target label of your
choice. For instance, if you want to provide your own definition of
<code>@maven//:com_google_guava_guava</code> at <code>//third_party/guava:guava</code>, specify the
mapping in the <code>override_targets</code> attribute:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    name = &quot;pinning&quot;,
    artifacts = [
        &quot;com.google.guava:guava:27.0-jre&quot;,
    ],
    repositories = [
        &quot;https://repo1.maven.org/maven2&quot;,
    ],
    override_targets = {
        &quot;com.google.guava:guava&quot;: &quot;@//third_party/guava:guava&quot;,
    },
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pinning"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"com.google.guava:guava:27.0-jre"</span>,
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://repo1.maven.org/maven2"</span>,
    ],
    <span class="pl-s1">override_targets</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.guava:guava"</span>: <span class="pl-s">"@//third_party/guava:guava"</span>,
    },
)</pre></div>
<p dir="auto">Note that the target label contains <code>@//</code>, which tells Bazel to reference the
target relative to your main workspace, instead of the <code>@maven</code> workspace.</p>
<h3 id="user-content-proxies" dir="auto"><a class="heading-link" href="#proxies">Proxies<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">As with other Bazel repository rules, the standard <code>http_proxy</code>, <code>https_proxy</code>
and <code>no_proxy</code> environment variables (and their uppercase counterparts) are
supported.</p>
<h3 id="user-content-repository-aliases" dir="auto"><a class="heading-link" href="#repository-aliases">Repository aliases<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Maven artifact rules like <code>maven_jar</code> and <code>jvm_import_external</code> generate targets
labels in the form of <code>@group_artifact//jar</code>, like <code>@com_google_guava_guava//jar</code>. This
is different from the <code>@maven//:group_artifact</code> naming style used in this project.</p>
<p dir="auto">As some Bazel projects depend on the <code>@group_artifact//jar</code> style labels, we
provide a <code>generate_compat_repositories</code> attribute in <code>maven_install</code>. If
enabled, JAR artifacts can also be referenced using the <code>@group_artifact//jar</code>
target label. For example, <code>@maven//:com_google_guava_guava</code> can also be
referenced using <code>@com_google_guava_guava//jar</code>.</p>
<p dir="auto">The artifacts can also be referenced using the style used by
<code>java_import_external</code> as <code>@group_artifact//:group_artifact</code> or
<code>@group_artifact</code> for short.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    generate_compat_repositories = True
)

load(&quot;@maven//:compat.bzl&quot;, &quot;compat_repositories&quot;)
compat_repositories()"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">generate_compat_repositories</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>
)

<span class="pl-en">load</span>(<span class="pl-s">"@maven//:compat.bzl"</span>, <span class="pl-s">"compat_repositories"</span>)
<span class="pl-en">compat_repositories</span>()</pre></div>
<h4 id="user-content-repository-remapping" dir="auto"><a class="heading-link" href="#repository-remapping">Repository remapping<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<p dir="auto">If the <code>maven_jar</code> or <code>jvm_import_external</code> is not named according to <code>rules_jvm_external</code>'s
conventions, you can apply
<a href="https://docs.bazel.build/versions/master/external.html#shadowing-dependencies" rel="nofollow">repository remapping</a>
from the expected name to the new name for compatibility.</p>
<p dir="auto">For example, if an external dependency uses <code>@guava//jar</code>, and <code>rules_jvm_external</code>
generates <code>@com_google_guava_guava//jar</code>, apply the <code>repo_mapping</code> attribute to the external
repository WORKSPACE rule, like <code>http_archive</code> in this example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive(
    name = &quot;my_dep&quot;,
    repo_mapping = {
        &quot;@guava&quot;: &quot;@com_google_guava_guava&quot;,
    }
    # ...
)"><pre><span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_dep"</span>,
    <span class="pl-s1">repo_mapping</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"@guava"</span>: <span class="pl-s">"@com_google_guava_guava"</span>,
    }
    <span class="pl-c"># ...</span>
)</pre></div>
<p dir="auto">With <code>repo_mapping</code>, all references to <code>@guava//jar</code> in <code>@my_dep</code>'s BUILD files will be mapped
to <code>@com_google_guava_guava//jar</code> instead.</p>
<h3 id="user-content-hiding-transitive-dependencies" dir="auto"><a class="heading-link" href="#hiding-transitive-dependencies">Hiding transitive dependencies<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">As a convenience, transitive dependencies are visible to your build rules.
However, this can lead to surprises when updating <code>maven_install</code>'s <code>artifacts</code>
list, since doing so may eliminate transitive dependencies from the build
graph.  To force rule authors to explicitly declare all directly referenced
artifacts, use the <code>strict_visibility</code> attribute in <code>maven_install</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    strict_visibility = True
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">strict_visibility</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>
)</pre></div>
<p dir="auto">It is also possible to change strict visibility value from default <code>//visibility:private</code>
to a value specified by <code>strict_visibility_value</code> attribute.</p>
<h3 id="user-content-accessing-transitive-dependencies-list" dir="auto"><a class="heading-link" href="#accessing-transitive-dependencies-list">Accessing transitive dependencies list<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">It is possible to retrieve full list of dependencies in the dependency tree, including
transitive, source, javadoc and other artifacts. <code>maven_artifacts</code> list contains full
versioned maven coordinate strings of all dependencies.</p>
<p dir="auto">For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@maven//:defs.bzl&quot;, &quot;maven_artifacts&quot;)

load(&quot;@rules_jvm_external//:defs.bzl&quot;, &quot;artifact&quot;)
load(&quot;@rules_jvm_external//:specs.bzl&quot;, &quot;parse&quot;)

all_jar_coordinates = [c for c in maven_artifacts if parse.parse_maven_coordinate(c).get(&quot;packaging&quot;, &quot;jar&quot;) == &quot;jar&quot;]
all_jar_targets = [artifact(c) for c in all_jar_coordinates]

java_library(
  name = &quot;depends_on_everything&quot;,
  runtime_deps = all_jar_targets,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@maven//:defs.bzl"</span>, <span class="pl-s">"maven_artifacts"</span>)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:defs.bzl"</span>, <span class="pl-s">"artifact"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:specs.bzl"</span>, <span class="pl-s">"parse"</span>)

<span class="pl-s1">all_jar_coordinates</span> <span class="pl-c1">=</span> [<span class="pl-s1">c</span> <span class="pl-k">for</span> <span class="pl-s1">c</span> <span class="pl-c1">in</span> <span class="pl-s1">maven_artifacts</span> <span class="pl-k">if</span> <span class="pl-s1">parse</span>.<span class="pl-en">parse_maven_coordinate</span>(<span class="pl-s1">c</span>).<span class="pl-en">get</span>(<span class="pl-s">"packaging"</span>, <span class="pl-s">"jar"</span>) <span class="pl-c1">==</span> <span class="pl-s">"jar"</span>]
<span class="pl-s1">all_jar_targets</span> <span class="pl-c1">=</span> [<span class="pl-en">artifact</span>(<span class="pl-s1">c</span>) <span class="pl-k">for</span> <span class="pl-s1">c</span> <span class="pl-c1">in</span> <span class="pl-s1">all_jar_coordinates</span>]

<span class="pl-en">java_library</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"depends_on_everything"</span>,
  <span class="pl-s1">runtime_deps</span> <span class="pl-c1">=</span> <span class="pl-s1">all_jar_targets</span>,
)</pre></div>
<h3 id="user-content-fetch-and-resolve-timeout" dir="auto"><a class="heading-link" href="#fetch-and-resolve-timeout">Fetch and resolve timeout<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The default timeout to fetch and resolve artifacts is 600 seconds.  If you need
to change this to resolve a large number of artifacts you can set the
<code>resolve_timeout</code> attribute in <code>maven_install</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    resolve_timeout = 900
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">resolve_timeout</span> <span class="pl-c1">=</span> <span class="pl-c1">900</span>
)</pre></div>
<h3 id="user-content-duplicate-artifact-warning" dir="auto"><a class="heading-link" href="#duplicate-artifact-warning">Duplicate artifact warning<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">By default you will be warned if there are duplicate artifacts in your artifact list. The <code>duplicate_version_warning</code> setting can be used to change this behavior. Use "none" to disable the warning and "error" to fail the build instead of warn.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_install(
    artifacts = [
        # ...
    ],
    repositories = [
        # ...
    ],
    duplicate_version_warning = &quot;error&quot;
)"><pre><span class="pl-en">maven_install</span>(
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">repositories</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ...</span>
    ],
    <span class="pl-s1">duplicate_version_warning</span> <span class="pl-c1">=</span> <span class="pl-s">"error"</span>
)</pre></div>
<h3 id="user-content-provide-jvm-options-for-coursier-with-coursier_opts" dir="auto"><a class="heading-link" href="#provide-jvm-options-for-coursier-with-coursier_opts">Provide JVM options for Coursier with <code>COURSIER_OPTS</code><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">You can set up <code>COURSIER_OPTS</code> environment variable to provide some additional JVM options for Coursier.
This is a space-separated list of options.</p>
<p dir="auto">Assume you'd like to override Coursier's memory settings:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="COURSIER_OPTS=&quot;-Xms1g -Xmx4g&quot;"><pre>COURSIER_OPTS=<span class="pl-s"><span class="pl-pds">"</span>-Xms1g -Xmx4g<span class="pl-pds">"</span></span></pre></div>
<h3 id="user-content-resolving-issues-with-nonstandard-system-default-jdks" dir="auto"><a class="heading-link" href="#resolving-issues-with-nonstandard-system-default-jdks">Resolving issues with nonstandard system default JDKs<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Try to use OpenJDK explicitly if your machine or environment is set up to use a non-standard default implementation of the JDK and you encounter errors similar to the following:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="java.lang.NullPointerException
	at java.base/jdk.internal.reflect.UnsafeFieldAccessorImpl.ensureObj(UnsafeFieldAccessorImpl.java:58)
	at java.base/jdk.internal.reflect.UnsafeObjectFieldAccessorImpl.get(UnsafeObjectFieldAccessorImpl.java:36)
	at java.base/java.lang.reflect.Field.get(Field.java:418)
	at org.robolectric.shadows.ShadowActivityThread$_ActivityThread_$$Reflector0.getActivities(Unknown Source)
	at org.robolectric.shadows.ShadowActivityThread.reset(ShadowActivityThread.java:277)
	at org.robolectric.Shadows.reset(Shadows.java:2499)
	at org.robolectric.android.internal.AndroidTestEnvironment.resetState(AndroidTestEnvironment.java:640)
	at org.robolectric.RobolectricTestRunner.lambda$finallyAfterTest$0(RobolectricTestRunner.java:361)
	at org.robolectric.util.PerfStatsCollector.measure(PerfStatsCollector.java:86)
	at org.robolectric.RobolectricTestRunner.finallyAfterTest(RobolectricTestRunner.java:359)
	at org.robolectric.internal.SandboxTestRunner$2.lambda$evaluate$2(SandboxTestRunner.java:296)
	at org.robolectric.internal.bytecode.Sandbox.lambda$runOnMainThread$0(Sandbox.java:99)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
	at java.base/java.lang.Thread.run(Thread.java:830)"><pre class="notranslate"><code>java.lang.NullPointerException
	at java.base/jdk.internal.reflect.UnsafeFieldAccessorImpl.ensureObj(UnsafeFieldAccessorImpl.java:58)
	at java.base/jdk.internal.reflect.UnsafeObjectFieldAccessorImpl.get(UnsafeObjectFieldAccessorImpl.java:36)
	at java.base/java.lang.reflect.Field.get(Field.java:418)
	at org.robolectric.shadows.ShadowActivityThread$_ActivityThread_$$Reflector0.getActivities(Unknown Source)
	at org.robolectric.shadows.ShadowActivityThread.reset(ShadowActivityThread.java:277)
	at org.robolectric.Shadows.reset(Shadows.java:2499)
	at org.robolectric.android.internal.AndroidTestEnvironment.resetState(AndroidTestEnvironment.java:640)
	at org.robolectric.RobolectricTestRunner.lambda$finallyAfterTest$0(RobolectricTestRunner.java:361)
	at org.robolectric.util.PerfStatsCollector.measure(PerfStatsCollector.java:86)
	at org.robolectric.RobolectricTestRunner.finallyAfterTest(RobolectricTestRunner.java:359)
	at org.robolectric.internal.SandboxTestRunner$2.lambda$evaluate$2(SandboxTestRunner.java:296)
	at org.robolectric.internal.bytecode.Sandbox.lambda$runOnMainThread$0(Sandbox.java:99)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
	at java.base/java.lang.Thread.run(Thread.java:830)
</code></pre></div>
<p dir="auto">or</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="java.lang.UnsatisfiedLinkError: libstdc++.so.6: cannot open shared object file: No such file or directory
	at java.base/java.lang.ClassLoader$NativeLibrary.load0(Native Method)
	at java.base/java.lang.ClassLoader$NativeLibrary.load(ClassLoader.java:2444)
	at java.base/java.lang.ClassLoader$NativeLibrary.loadLibrary(ClassLoader.java:2500)
	at java.base/java.lang.ClassLoader.loadLibrary0(ClassLoader.java:2716)
	at java.base/java.lang.ClassLoader.loadLibrary(ClassLoader.java:2629)
	at java.base/java.lang.Runtime.load0(Runtime.java:769)
	at java.base/java.lang.System.load(System.java:1840)
	at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:52)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
  ..."><pre class="notranslate"><code>java.lang.UnsatisfiedLinkError: libstdc++.so.6: cannot open shared object file: No such file or directory
	at java.base/java.lang.ClassLoader$NativeLibrary.load0(Native Method)
	at java.base/java.lang.ClassLoader$NativeLibrary.load(ClassLoader.java:2444)
	at java.base/java.lang.ClassLoader$NativeLibrary.loadLibrary(ClassLoader.java:2500)
	at java.base/java.lang.ClassLoader.loadLibrary0(ClassLoader.java:2716)
	at java.base/java.lang.ClassLoader.loadLibrary(ClassLoader.java:2629)
	at java.base/java.lang.Runtime.load0(Runtime.java:769)
	at java.base/java.lang.System.load(System.java:1840)
	at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:52)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
  ...
</code></pre></div>
<h2 id="user-content-exporting-and-consuming-artifacts-from-external-repositories" dir="auto"><a class="heading-link" href="#exporting-and-consuming-artifacts-from-external-repositories">Exporting and consuming artifacts from external repositories<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">If you're writing a library that has dependencies, you should define a constant that
lists all of the artifacts that your library requires. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# my_library/BUILD
# Public interface of the library
java_library(
  name = &quot;my_interface&quot;,
  deps = [
    &quot;@maven//:junit_junit&quot;,
    &quot;@maven//:com_google_inject_guice&quot;,
  ],
)"><pre><span class="pl-c"># my_library/BUILD</span>
<span class="pl-c"># Public interface of the library</span>
<span class="pl-en">java_library</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_interface"</span>,
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
    <span class="pl-s">"@maven//:junit_junit"</span>,
    <span class="pl-s">"@maven//:com_google_inject_guice"</span>,
  ],
)</pre></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# my_library/library_deps.bzl
# All artifacts required by the library
MY_LIBRARY_ARTIFACTS = [
  &quot;junit:junit:4.12&quot;,
  &quot;com.google.inject:guice:4.0&quot;,
]"><pre><span class="pl-c"># my_library/library_deps.bzl</span>
<span class="pl-c"># All artifacts required by the library</span>
<span class="pl-v">MY_LIBRARY_ARTIFACTS</span> <span class="pl-c1">=</span> [
  <span class="pl-s">"junit:junit:4.12"</span>,
  <span class="pl-s">"com.google.inject:guice:4.0"</span>,
]</pre></div>
<p dir="auto">Users of your library can then load the constant in their <code>WORKSPACE</code> and add the
artifacts to their <code>maven_install</code>. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# user_project/WORKSPACE
load(&quot;@my_library//:library_deps.bzl&quot;, &quot;MY_LIBRARY_ARTIFACTS&quot;)

maven_install(
  artifacts = [
        &quot;junit:junit:4.11&quot;,
        &quot;com.google.guava:guava:26.0-jre&quot;,
  ] + MY_LIBRARY_ARTIFACTS,
)"><pre><span class="pl-c"># user_project/WORKSPACE</span>
<span class="pl-en">load</span>(<span class="pl-s">"@my_library//:library_deps.bzl"</span>, <span class="pl-s">"MY_LIBRARY_ARTIFACTS"</span>)

<span class="pl-en">maven_install</span>(
  <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"junit:junit:4.11"</span>,
        <span class="pl-s">"com.google.guava:guava:26.0-jre"</span>,
  ] <span class="pl-c1">+</span> <span class="pl-v">MY_LIBRARY_ARTIFACTS</span>,
)</pre></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# user_project/BUILD
java_library(
  name = &quot;user_lib&quot;,
  deps = [
    &quot;@my_library//:my_interface&quot;,
    &quot;@maven//:junit_junit&quot;,
  ],
)"><pre><span class="pl-c"># user_project/BUILD</span>
<span class="pl-en">java_library</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"user_lib"</span>,
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
    <span class="pl-s">"@my_library//:my_interface"</span>,
    <span class="pl-s">"@maven//:junit_junit"</span>,
  ],
)</pre></div>
<p dir="auto">Any version conflicts or duplicate artifacts will resolved automatically.</p>
<h2 id="user-content-publishing-to-external-repositories" dir="auto"><a class="heading-link" href="#publishing-to-external-repositories">Publishing to External Repositories<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">In order to publish an artifact from your repo to a maven repository, you
must first create a <code>java_export</code> target. This is similar to a regular
<code>java_library</code>, but allows two additional parameters: the maven coordinates
and an optional template file to use for the <code>pom.xml</code> file.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# user_project/BUILD
load(&quot;@rules_jvm_external//:defs.bzl&quot;, &quot;java_export&quot;)

java_export(
  name = &quot;exported_lib&quot;,
  maven_coordinates = &quot;com.example:project:0.0.1&quot;,
  pom_template = &quot;pom.tmpl&quot;,  # You can omit this
  srcs = glob([&quot;*.java&quot;]),
  deps = [
    &quot;//user_project/utils&quot;,
    &quot;@maven//:com_google_guava_guava&quot;,
  ],
)"><pre><span class="pl-c"># user_project/BUILD</span>
<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:defs.bzl"</span>, <span class="pl-s">"java_export"</span>)

<span class="pl-en">java_export</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"exported_lib"</span>,
  <span class="pl-s1">maven_coordinates</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example:project:0.0.1"</span>,
  <span class="pl-s1">pom_template</span> <span class="pl-c1">=</span> <span class="pl-s">"pom.tmpl"</span>,  <span class="pl-c"># You can omit this</span>
  <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"*.java"</span>]),
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
    <span class="pl-s">"//user_project/utils"</span>,
    <span class="pl-s">"@maven//:com_google_guava_guava"</span>,
  ],
)</pre></div>
<p dir="auto">If you wish to publish an artifact with Kotlin source code to a maven repository
you can use <code>kt_jvm_export</code>. This rule has the same arguments and generated
rules as <code>java_export</code>, but uses <code>kt_jvm_library</code> instead of <code>java_library</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# user_project/BUILD
load(&quot;@rules_jvm_external//:kt_defs.bzl&quot;, &quot;kt_jvm_export&quot;)

kt_jvm_export(
  name = &quot;exported_kt_lib&quot;,
  maven_coordinates = &quot;com.example:project:0.0.1&quot;,
  srcs = glob([&quot;*.kt&quot;]),
)"><pre><span class="pl-c"># user_project/BUILD</span>
<span class="pl-en">load</span>(<span class="pl-s">"@rules_jvm_external//:kt_defs.bzl"</span>, <span class="pl-s">"kt_jvm_export"</span>)

<span class="pl-en">kt_jvm_export</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"exported_kt_lib"</span>,
  <span class="pl-s1">maven_coordinates</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example:project:0.0.1"</span>,
  <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"*.kt"</span>]),
)</pre></div>
<p dir="auto">In order to publish the artifact, use <code>bazel run</code>:</p>
<p dir="auto"><code>bazel run --define "maven_repo=file://$HOME/.m2/repository" //user_project:exported_lib.publish</code></p>
<p dir="auto">Or, to publish to (eg) Sonatype's OSS repo:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="MAVEN_USER=example_user MAVEN_PASSWORD=hunter2 bazel run --stamp \
  --define &quot;maven_repo=https://oss.sonatype.org/service/local/staging/deploy/maven2&quot; \
  --define gpg_sign=true \
  //user_project:exported_lib.publish`"><pre>MAVEN_USER=example_user MAVEN_PASSWORD=hunter2 bazel run --stamp \
  --define <span class="pl-s"><span class="pl-pds">"</span>maven_repo=https://oss.sonatype.org/service/local/staging/deploy/maven2<span class="pl-pds">"</span></span> \
  --define gpg_sign=true \
  //user_project:exported_lib.publish<span class="pl-s"><span class="pl-pds">`</span></span></pre></div>
<p dir="auto">Or, to publish to a Google Cloud Storage:</p>
<p dir="auto"><code>bazel run --define "maven_repo=gs://example-bucket/repository" //user_project:exported_lib.publish</code></p>
<p dir="auto">Or, to publish to an Amazon S3 bucket:</p>
<p dir="auto"><code>bazel run --define "maven_repo=s3://example-bucket/repository" //user_project:exported_lib.publish</code></p>
<p dir="auto">Or, to publish to a GCP Artifact Registry:</p>
<p dir="auto"><code>bazel run --define "maven_repo=artifactregistry://us-west1-maven.pkg.dev/project/repository" //user_project:exported_lib.publish</code></p>
<p dir="auto">When using the <code>gpg_sign</code> option, the current default key will be used for
signing, and the <code>gpg</code> binary needs to be installed on the machine.</p>
<h2 id="user-content-ipv6-support" dir="auto"><a class="heading-link" href="#ipv6-support">IPv6 support<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Certain IPv4/IPv6 dual-stack environments may require flags to override the default settings for downloading dependencies, for both Bazel's native downloader and Coursier as a downloader:</p>
<p dir="auto">Add:</p>
<ul dir="auto">
<li><code>startup --host_jvm_args=-Djava.net.preferIPv6Addresses=true</code> to your <code>.bazelrc</code> file for Bazel's native downloader.</li>
<li><code>-Djava.net.preferIPv6Addresses=true to the </code>COURSIER_OPTS` environment variable to provide JVM options for Coursier.</li>
</ul>
<p dir="auto">For more information, read the <a href="https://bazel.build/docs/external#support-for-ipv6" rel="nofollow">official docs for IPv6 support in Bazel</a>.</p>
<h2 id="user-content-demo" dir="auto"><a class="heading-link" href="#demo">Demo<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">You can find demos in the <a href="./examples/"><code>examples/</code></a> directory.</p>
<h2 id="user-content-projects-using-rules_jvm_external" dir="auto"><a class="heading-link" href="#projects-using-rules_jvm_external">Projects using rules_jvm_external<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Find other GitHub projects using <code>rules_jvm_external</code>
<a href="https://github.com/search?p=1&amp;q=rules_jvm_external+filename%3A%2FWORKSPACE+filename%3A%5C.bzl&amp;type=Code">with this search query</a>.</p>
<h2 id="user-content-developing-this-project" dir="auto"><a class="heading-link" href="#developing-this-project">Developing this project<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-verbose--debug-mode" dir="auto"><a class="heading-link" href="#verbose--debug-mode">Verbose / debug mode<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Set the <code>RJE_VERBOSE</code> environment variable to <code>true</code> to print <code>coursier</code>'s verbose
output. For example:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ RJE_VERBOSE=true bazel run @unpinned_maven//:pin"><pre class="notranslate"><code>$ RJE_VERBOSE=true bazel run @unpinned_maven//:pin
</code></pre></div>
<h3 id="user-content-tests" dir="auto"><a class="heading-link" href="#tests">Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">In order to run tests, your system must have an Android SDK installed. You can install the Android SDK using <a href="https://developer.android.com/studio" rel="nofollow">Android Studio</a>, or through most system package managers.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel test //..."><pre class="notranslate"><code>$ bazel test //...
</code></pre></div>
<h4 id="user-content-installing-the-android-sdk-on-macos" dir="auto"><a class="heading-link" href="#installing-the-android-sdk-on-macos">Installing the Android SDK on macOS<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<p dir="auto">The instructions for installing the Android SDK on macOS can be hard
to find, but if you're comfortable using <a href="https://brew.sh" rel="nofollow">HomeBrew</a>,
the following steps will install what you need and set up the
<code>ANDROID_HOME</code> environment variable that's required in order to run
<code>rules_jvm_external</code>'s own tests.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="brew install android-commandlinetools
export ANDROID_HOME=&quot;$(brew --prefix)/share/android-commandlinetools&quot;
sdkmanager &quot;build-tools;33.0.1&quot; &quot;cmdline-tools;latest&quot; &quot;ndk;25.1.8937393&quot; &quot;platform-tools&quot; &quot;platforms;android-33&quot;"><pre class="notranslate"><code>brew install android-commandlinetools
export ANDROID_HOME="$(brew --prefix)/share/android-commandlinetools"
sdkmanager "build-tools;33.0.1" "cmdline-tools;latest" "ndk;25.1.8937393" "platform-tools" "platforms;android-33"
</code></pre></div>
<p dir="auto">You can add the <code>export ANDROID_HOME</code> to your <code>.zshrc</code> or similar
config file.</p>
<h3 id="user-content-generating-documentation" dir="auto"><a class="heading-link" href="#generating-documentation">Generating documentation<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Use <a href="https://skydoc.bazel.build/docs/getting_started_stardoc.html" rel="nofollow">Stardoc</a> to
generate API documentation in the <a href="docs/">docs</a> directory using
<a href="scripts/generate_docs.sh">generate_docs.sh</a>.</p>
<p dir="auto">Note that this script has a dependency on the <code>doctoc</code> NPM package to automate
generating the table of contents. Install it with <code>npm -g i doctoc</code>.</p>
</article></div>