<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://buildkite.com/bazel/rules-jsonnet-postsubmit" rel="nofollow"><img src="https://camo.githubusercontent.com/168e1fd853dc3a97f26793563d944ba2aa674f80902968357952416fb0cf3d6a/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f63333434396162613938393731333339346133323337303730393731656235396239326164313964366636393535356132352e737667" alt="Build status" data-canonical-src="https://badge.buildkite.com/c3449aba989713394a3237070971eb59b92ad19d6f69555a25.svg" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Jsonnet Rules</h1><a id="user-content-jsonnet-rules" class="anchor" aria-label="Permalink: Jsonnet Rules" href="#jsonnet-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto">
  <div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Rules</h2><a id="user-content-rules" class="anchor" aria-label="Permalink: Rules" href="#rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
  <ul dir="auto">
    <li><a href="#jsonnet_library">jsonnet_library</a></li>
    <li><a href="#jsonnet_to_json">jsonnet_to_json</a></li>
    <li><a href="#jsonnet_to_json_test">jsonnet_to_json_test</a></li>
  </ul>
</div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These are build rules for working with <a href="https://jsonnet.org" rel="nofollow">Jsonnet</a> files with Bazel.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Setup</h2><a id="user-content-setup" class="anchor" aria-label="Permalink: Setup" href="#setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use the Jsonnet rules as part of your Bazel project, please follow the
instructions on <a href="https://github.com/bazelbuild/rules_jsonnet/releases">the releases page</a>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Jsonnet Port Selection</h2><a id="user-content-jsonnet-port-selection" class="anchor" aria-label="Permalink: Jsonnet Port Selection" href="#jsonnet-port-selection"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">By default, Bazel will use <a href="https://github.com/google/go-jsonnet">the Go port</a> of Jsonnet. To use <a href="https://github.com/google/jsonnet">the C++ port</a> of Jsonnet instead, invoke Bazel with the <code>--define jsonnet_port=cpp</code> command-line flag. To select the Go port explicitly, invoke Bazel with the <code>--define jsonnet_port=go</code> command-line flag.</p>
<table>
<thead>
<tr>
<th><em>bazel</em> Flag</th>
<th>Jsonnet Port</th>
</tr>
</thead>
<tbody>
<tr>
<td>(none)</td>
<td>Go</td>
</tr>
<tr>
<td><code>--define jsonnet_port=cpp</code></td>
<td>C++</td>
</tr>
<tr>
<td><code>--define jsonnet_port=go</code></td>
<td>Go</td>
</tr>
</tbody>
</table>
<p dir="auto">Note that the primary development focus of the Jsonnet project is now with the Go port. This repository's support for using the C++ port is deprecated, and may be removed in a future release.</p>
<p dir="auto"><a name="user-content-#jsonnet_library"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">jsonnet_library</h2><a id="user-content-jsonnet_library" class="anchor" aria-label="Permalink: jsonnet_library" href="#jsonnet_library"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_library(name, srcs, deps, imports)"><pre><span class="pl-en">jsonnet_library</span>(<span class="pl-s1">name</span>, <span class="pl-s1">srcs</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">imports</span>)</pre></div>
<table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <code>Name, required</code>
        <p dir="auto">A unique name for this rule.</p>
      </td>
    </tr>
    <tr>
      <td><code>srcs</code></td>
      <td>
        <code>List of Labels, required</code>
        <p dir="auto">
          List of <code>.jsonnet</code> files that comprises this Jsonnet
          library.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>deps</code></td>
      <td>
        <code>List of labels, optional</code>
        <p dir="auto">
          List of targets that are required by the <code>srcs</code> Jsonnet
          files.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>imports</code></td>
      <td>
        <code>List of strings, optional</code>
        <p dir="auto">
          List of import <code>-J</code> flags to be passed to the
          <code>jsonnet</code> compiler.
        </p>
      </td>
    </tr>
  </tbody>
</table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Example</h3><a id="user-content-example" class="anchor" aria-label="Permalink: Example" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Suppose you have the following directory structure:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="[workspace]/
    WORKSPACE
    configs/
        BUILD
        backend.jsonnet
        frontend.jsonnet"><pre class="notranslate"><code>[workspace]/
    WORKSPACE
    configs/
        BUILD
        backend.jsonnet
        frontend.jsonnet
</code></pre></div>
<p dir="auto">You can use the <code>jsonnet_library</code> rule to build a collection of <code>.jsonnet</code>
files that can be imported by other <code>.jsonnet</code> files as dependencies:</p>
<p dir="auto"><code>configs/BUILD</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;, &quot;jsonnet_library&quot;)

jsonnet_library(
    name = &quot;configs&quot;,
    srcs = [
        &quot;backend.jsonnet&quot;,
        &quot;frontend.jsonnet&quot;,
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl"</span>, <span class="pl-s">"jsonnet_library"</span>)

<span class="pl-en">jsonnet_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"configs"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"backend.jsonnet"</span>,
        <span class="pl-s">"frontend.jsonnet"</span>,
    ],
)</pre></div>
<p dir="auto"><a name="user-content-#jsonnet_to_json"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">jsonnet_to_json</h2><a id="user-content-jsonnet_to_json" class="anchor" aria-label="Permalink: jsonnet_to_json" href="#jsonnet_to_json"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_to_json(name, src, deps, outs, multiple_outputs, imports, stamp_keys, ext_strs, ext_str_envs, ext_code, ext_code_envs ext_str_files, ext_str_file_vars, ext_code_files, ext_code_file_vars, yaml_stream)"><pre><span class="pl-en">jsonnet_to_json</span>(<span class="pl-s1">name</span>, <span class="pl-s1">src</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">outs</span>, <span class="pl-s1">multiple_outputs</span>, <span class="pl-s1">imports</span>, <span class="pl-s1">stamp_keys</span>, <span class="pl-s1">ext_strs</span>, <span class="pl-s1">ext_str_envs</span>, <span class="pl-s1">ext_code</span>, <span class="pl-s1">ext_code_envs</span> <span class="pl-s1">ext_str_files</span>, <span class="pl-s1">ext_str_file_vars</span>, <span class="pl-s1">ext_code_files</span>, <span class="pl-s1">ext_code_file_vars</span>, <span class="pl-s1">yaml_stream</span>)</pre></div>
<table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <code>Name, required</code>
        <p dir="auto">A unique name for this rule.</p>
        <p dir="auto">
          This name will be used as the name of the JSON file generated by this
          rule.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>src</code></td>
      <td>
        <code>Label, required</code>
        <p dir="auto">
          The <code>.jsonnet</code> file to convert to JSON.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>deps</code></td>
      <td>
        <code>List of labels, optional</code>
        <p dir="auto">
          List of targets that are required by the <code>src</code> Jsonnet
          file.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>outs</code></td>
      <td>
        <code>List of Filenames, required</code>
        <p dir="auto">
          Names of the output .json files to be generated by this rule.
        </p>
        <p dir="auto">
          If you are generating only a single JSON file and are not using
          jsonnet multiple output files, then this attribute should only
          contain the file name of the JSON file you are generating.
        </p>
        <p dir="auto">
          If you are generating multiple JSON files using jsonnet multiple file
          output (<code>jsonnet -m</code>), then list the file names of all the
          JSON files to be generated. The file names specified here must match
          the file names specified in your <code>src</code> Jsonnet file.
        </p>
        <p dir="auto">
          For the case where multiple file output is used but only for
          generating one output file, set the <code>multiple_outputs</code>
          attribute to 1 to explicitly enable the <code>-m</code> flag for
          multiple file output.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>multiple_outputs</code></td>
      <td>
        <code>bool, optional, default 0</code>
        <p dir="auto">
          Set to 1 to explicitly enable multiple file output via the
          <code>jsonnet -m</code> flag.
        </p>
        <p dir="auto">
          This is used for the case where multiple file output is used but only
          for generating a single output file. For example:
        </p>
        <p dir="auto">
</p><pre>local foo = import "foo.jsonnet";
<p dir="auto">{
"foo.json": foo,
}
</p></pre>
<p dir="auto"></p>
</td>
</tr>
<tr>
<td><code>imports</code></td>
<td>
<code>List of strings, optional</code>
<p dir="auto">
List of import <code>-J</code> flags to be passed to the
<code>jsonnet</code> compiler.
</p>
</td>
</tr>
<tr>
<td><code>stamp_keys</code></td>
<td>
<code>List of strings, optional</code>
<p dir="auto">
Specify which variables in <code>ext_strs</code> and <code>ext_code</code> should get stamped by listing the matching dict keys.
</p>
<p dir="auto">
To get outside variables provided by a script invoked via <code>--workspace_status_command</code> into the build. For example:
</p><p dir="auto"></p>
<pre>jsonnet_to_json(
  name = "...",
  ext_strs = {
    "cluster": "{CLUSTER}"
  },
  stamp_keys = ["cluster"]
)
</pre>
<pre>$ cat .bazelrc
build --workspace_status_command=./print-workspace-status.sh

$ cat print-workspace-status.sh
cat &lt;&lt;EOF
VAR1 value1
# This can be overridden by users if they "export CLUSTER_OVERRIDE"
CLUSTER ${CLUSTER_OVERRIDE:-default-value2}
EOF
</pre>
</td>
    </tr>
    <tr>
      <td><code>ext_strs</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of strings to pass to jsonnet as external variables via <code>--ext-str key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing strings to pass to jsonnet as external variables via <code>--ext-str key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of code to pass to jsonnet as external variables via
          <code>--ext-code key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing jsonnet code to pass to jsonnet as external variables via
          <code>--ext-code key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_files</code></td>
      <td>
        <code>List of labels, optional but needed together with file_vars</code>
        <p dir="auto">
          List of string files that map to the var name defined in file_vars at the same index and together are passed to jsonnet via
          <code>--ext-str-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_file_vars</code></td>
      <td>
        <code>List of string, optional but needed together with files</code>
        <p dir="auto">
          List of var names that maps to the file defined in files at the same index and together are passed to jsonnet via
          <code>--ext-str-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_files</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          List of jsonnet code files that map to the var name defined in ext_code_file_vars at the same index and together are passed to jsonnet via
          <code>--ext-code-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_file_vars</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          List of var names that maps to the code file defined in code_files at the same index and together are passed to jsonnet via
          <code>--ext-code-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_strs</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of strings to pass to jsonnet as top-level arguments via <code>--tla-str key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_str_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing strings to pass to jsonnet as top-level arguments via <code>--tla-str key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_code</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of code to pass to jsonnet as top-level arguments via
          <code>--tla-code key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_code_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing jsonnet code to pass to jsonnet as top-level arguments via
          <code>--tla-code key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_str_files</code></td>
      <td>
        <code>Label-keyed String dict, optional</code>
        <p dir="auto">
          Dict of labels referencing text files and a var name, passed to jsonnet via <code>--tla-str-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>tla_code_files</code></td>
      <td>
        <code>Label-keyed String dict, optional</code>
        <p dir="auto">
          Dict of labels referencing code files and a var name, passed to jsonnet via <code>--tla-code-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>yaml_stream</code></td>
      <td>
        <code>bool, optional, default is False</code>
        <p dir="auto">
          Set to 1 to write output as a YAML stream of JSON documents.
        </p>
      </td>
    </tr>
  </tbody>
</table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Example</h3><a id="user-content-example-1" class="anchor" aria-label="Permalink: Example" href="#example-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Suppose you have the following directory structure:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="[workspace]/
    WORKSPACE
    workflows/
        BUILD
        workflow.libsonnet
        wordcount.jsonnet
        intersection.jsonnet"><pre class="notranslate"><code>[workspace]/
    WORKSPACE
    workflows/
        BUILD
        workflow.libsonnet
        wordcount.jsonnet
        intersection.jsonnet
</code></pre></div>
<p dir="auto">Say that <code>workflow.libsonnet</code> is a base configuration library for a workflow
scheduling system and <code>wordcount.jsonnet</code> and <code>intersection.jsonnet</code> both
import <code>workflow.libsonnet</code> to define workflows for performing a wordcount and
intersection of two files, respectively.</p>
<p dir="auto">First, create a <code>jsonnet_library</code> target with <code>workflow.libsonnet</code>:</p>
<p dir="auto"><code>workflows/BUILD</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;, &quot;jsonnet_library&quot;)

jsonnet_library(
    name = &quot;workflow&quot;,
    srcs = [&quot;workflow.libsonnet&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl"</span>, <span class="pl-s">"jsonnet_library"</span>)

<span class="pl-en">jsonnet_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"workflow"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"workflow.libsonnet"</span>],
)</pre></div>
<p dir="auto">To compile <code>wordcount.jsonnet</code> and <code>intersection.jsonnet</code> to JSON, define two
<code>jsonnet_to_json</code> targets:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_to_json(
    name = &quot;wordcount&quot;,
    src = &quot;wordcount.jsonnet&quot;,
    outs = [&quot;wordcount.json&quot;],
    deps = [&quot;:workflow&quot;],
)

jsonnet_to_json(
    name = &quot;intersection&quot;,
    src = &quot;intersection.jsonnet&quot;,
    outs = [&quot;intersection.json&quot;],
    deps = [&quot;:workflow&quot;],
)"><pre><span class="pl-en">jsonnet_to_json</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"wordcount"</span>,
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"wordcount.jsonnet"</span>,
    <span class="pl-s1">outs</span> <span class="pl-c1">=</span> [<span class="pl-s">"wordcount.json"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":workflow"</span>],
)

<span class="pl-en">jsonnet_to_json</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"intersection"</span>,
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"intersection.jsonnet"</span>,
    <span class="pl-s1">outs</span> <span class="pl-c1">=</span> [<span class="pl-s">"intersection.json"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":workflow"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Example: Multiple output files</h3><a id="user-content-example-multiple-output-files" class="anchor" aria-label="Permalink: Example: Multiple output files" href="#example-multiple-output-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use Jsonnet's <a href="https://jsonnet.org/learning/getting_started.html#multi" rel="nofollow">multiple output files</a>, suppose you
add a file <code>shell-workflows.jsonnet</code> that imports <code>wordcount.jsonnet</code> and
<code>intersection.jsonnet</code>:</p>
<p dir="auto"><code>workflows/shell-workflows.jsonnet</code>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="local wordcount = import &quot;workflows/wordcount.jsonnet&quot;;
local intersection = import &quot;workflows/intersection.jsonnet&quot;;

{
  &quot;wordcount-workflow.json&quot;: wordcount,
  &quot;intersection-workflow.json&quot;: intersection,
}"><pre class="notranslate"><code>local wordcount = import "workflows/wordcount.jsonnet";
local intersection = import "workflows/intersection.jsonnet";

{
  "wordcount-workflow.json": wordcount,
  "intersection-workflow.json": intersection,
}
</code></pre></div>
<p dir="auto">To compile <code>shell-workflows.jsonnet</code> into the two JSON files,
<code>wordcount-workflow.json</code> and <code>intersection-workflow.json</code>, first create a
<code>jsonnet_library</code> target containing the two files that
<code>shell-workflows.jsonnet</code> depends on:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_library(
    name = &quot;shell-workflows-lib&quot;,
    srcs = [
        &quot;wordcount.jsonnet&quot;,
        &quot;intersection.jsonnet&quot;,
    ],
    deps = [&quot;:workflow&quot;],
)"><pre><span class="pl-en">jsonnet_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"shell-workflows-lib"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"wordcount.jsonnet"</span>,
        <span class="pl-s">"intersection.jsonnet"</span>,
    ],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":workflow"</span>],
)</pre></div>
<p dir="auto">Then, create a <code>jsonnet_to_json</code> target and set <code>outs</code> to the list of output
files to indicate that multiple output JSON files are generated:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_to_json(
    name = &quot;shell-workflows&quot;,
    src = &quot;shell-workflows.jsonnet&quot;,
    deps = [&quot;:shell-workflows-lib&quot;],
    outs = [
        &quot;wordcount-workflow.json&quot;,
        &quot;intersection-workflow.json&quot;,
    ],
)"><pre><span class="pl-en">jsonnet_to_json</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"shell-workflows"</span>,
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"shell-workflows.jsonnet"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":shell-workflows-lib"</span>],
    <span class="pl-s1">outs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"wordcount-workflow.json"</span>,
        <span class="pl-s">"intersection-workflow.json"</span>,
    ],
)</pre></div>
<p dir="auto"><a name="user-content-#jsonnet_to_json_test"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">jsonnet_to_json_test</h2><a id="user-content-jsonnet_to_json_test" class="anchor" aria-label="Permalink: jsonnet_to_json_test" href="#jsonnet_to_json_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="jsonnet_to_json_test(name, src, deps, imports, golden, error=0, regex=False, yaml_stream=False, stamp_keys, ext_strs, ext_str_envs, ext_code, ext_code_envs ext_str_files, ext_str_file_vars, ext_code_files, ext_code_file_vars)"><pre><span class="pl-en">jsonnet_to_json_test</span>(<span class="pl-s1">name</span>, <span class="pl-s1">src</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">imports</span>, <span class="pl-s1">golden</span>, <span class="pl-s1">error</span><span class="pl-c1">=</span><span class="pl-c1">0</span>, <span class="pl-s1">regex</span><span class="pl-c1">=</span><span class="pl-c1">False</span>, <span class="pl-s1">yaml_stream</span><span class="pl-c1">=</span><span class="pl-c1">False</span>, <span class="pl-s1">stamp_keys</span>, <span class="pl-s1">ext_strs</span>, <span class="pl-s1">ext_str_envs</span>, <span class="pl-s1">ext_code</span>, <span class="pl-s1">ext_code_envs</span> <span class="pl-s1">ext_str_files</span>, <span class="pl-s1">ext_str_file_vars</span>, <span class="pl-s1">ext_code_files</span>, <span class="pl-s1">ext_code_file_vars</span>)</pre></div>
<table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <code>Name, required</code>
        <p dir="auto">A unique name for this rule.</p>
        <p dir="auto">
          This name will be used as the name of the JSON file generated by this
          rule.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>src</code></td>
      <td>
        <code>Label, required</code>
        <p dir="auto">
          The <code>.jsonnet</code> file to convert to JSON.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>deps</code></td>
      <td>
        <code>List of labels, optional</code>
        <p dir="auto">
          List of targets that are required by the <code>src</code> Jsonnet
          file.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>imports</code></td>
      <td>
        <code>codefileList of strings, optional</code>
        <p dir="auto">
          List of import <code>-J</code> flags to be passed to the
          <code>jsonnet</code> compiler.
        </p>
      </td>
    </tr>
        <tr>
      <td><code>stamp_keys</code></td>
      <td>
        <code>List of strings, optional</code>
        <p dir="auto">
          Specify which variables in `ext_strs` and `ext_code` should get stamped by listing the matching dict keys.
        </p>
        <p dir="auto">
          To get outside variables provided by a script invoked via `--workspace_status_command` into the build.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_strs</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of strings to pass to jsonnet as external variables via <code>--ext-str key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing strings to pass to jsonnet as external variables via <code>--ext-str key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          Map of code to pass to jsonnet as external variables via
          <code>--ext-code key=value</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_envs</code></td>
      <td>
        <code>String list, optional</code>
        <p dir="auto">
          List of env var names containing jsonnet code to pass to jsonnet as external variables via
          <code>--ext-code key</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_files</code></td>
      <td>
        <code>List of labels, optional but needed together with file_vars</code>
        <p dir="auto">
          List of string files that map to the var name defined in file_vars at the same index and together are passed to jsonnet via
          <code>--ext-str-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_str_file_vars</code></td>
      <td>
        <code>List of string, optional but needed together with files</code>
        <p dir="auto">
          List of var names that maps to the file defined in files at the same index and together are passed to jsonnet via
          <code>--ext-str-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_files</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          List of jsonnet code files that map to the var name defined in ext_code_file_vars at the same index and together are passed to jsonnet via
          <code>--ext-code-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>ext_code_file_vars</code></td>
      <td>
        <code>String dict, optional</code>
        <p dir="auto">
          List of var names that maps to the code file defined in code_files at the same index and together are passed to jsonnet via
          <code>--ext-code-file var=file</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>golden</code></td>
      <td>
        <code>Label, optional</code>
        <p dir="auto">
          The expected (combined stdout and stderr) output to compare to the
          output of running <code>jsonnet</code> on <code>src</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>error</code></td>
      <td>
        <code>Integer, optional, default is 0</code>
        <p dir="auto">
          The expected error code from running <code>jsonnet</code> on
          <code>src</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>regex</code></td>
      <td>
        <code>bool, optional, default is False</code>
        <p dir="auto">
          Set to 1 if <code>golden</code> contains a regex used to match
          the output of running <code>jsonnet</code> on <code>src</code>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>yaml_stream</code></td>
      <td>
        <code>bool, optional, default is False</code>
        <p dir="auto">
          Set to 1 to write output as a YAML stream of JSON documents.
        </p>
      </td>
    </tr>
  </tbody>
</table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Example</h3><a id="user-content-example-2" class="anchor" aria-label="Permalink: Example" href="#example-2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Suppose you have the following directory structure:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        test_config.jsonnet
        test_config.json"><pre class="notranslate"><code>[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        test_config.jsonnet
        test_config.json
</code></pre></div>
<p dir="auto">Suppose that <code>base_config.libsonnet</code> is a library Jsonnet file, containing the
base configuration for a service. Suppose that <code>test_config.jsonnet</code> is a test
configuration file that is used to test <code>base_config.jsonnet</code>, and
<code>test_config.json</code> is the expected JSON output from compiling
<code>test_config.jsonnet</code>.</p>
<p dir="auto">The <code>jsonnet_to_json_test</code> rule can be used to verify that compiling a Jsonnet
file produces the expected JSON output. Simply define a <code>jsonnet_to_json_test</code>
target and provide the input test Jsonnet file and the <code>golden</code> file containing
the expected JSON output:</p>
<p dir="auto"><code>config/BUILD</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(
    &quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;,
    &quot;jsonnet_library&quot;,
    &quot;jsonnet_to_json_test&quot;,
)

jsonnet_library(
    name = &quot;base_config&quot;,
    srcs = [&quot;base_config.libsonnet&quot;],
)

jsonnet_to_json_test(
    name = &quot;test_config_test&quot;,
    src = &quot;test_config&quot;,
    deps = [&quot;:base_config&quot;],
    golden = &quot;test_config.json&quot;,
)"><pre><span class="pl-en">load</span>(
    <span class="pl-s">"@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl"</span>,
    <span class="pl-s">"jsonnet_library"</span>,
    <span class="pl-s">"jsonnet_to_json_test"</span>,
)

<span class="pl-en">jsonnet_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"base_config"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"base_config.libsonnet"</span>],
)

<span class="pl-en">jsonnet_to_json_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"test_config_test"</span>,
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"test_config"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":base_config"</span>],
    <span class="pl-s1">golden</span> <span class="pl-c1">=</span> <span class="pl-s">"test_config.json"</span>,
)</pre></div>
<p dir="auto">To run the test: <code>bazel test //config:test_config_test</code></p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Example: Negative tests</h3><a id="user-content-example-negative-tests" class="anchor" aria-label="Permalink: Example: Negative tests" href="#example-negative-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Suppose you have the following directory structure:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        invalid_config.jsonnet
        invalid_config.output"><pre class="notranslate"><code>[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        invalid_config.jsonnet
        invalid_config.output
</code></pre></div>
<p dir="auto">Suppose that <code>invalid_config.jsonnet</code> is a Jsonnet file used to verify that
an invalid config triggers an assertion in <code>base_config.jsonnet</code>, and
<code>invalid_config.output</code> is the expected error output.</p>
<p dir="auto">The <code>jsonnet_to_json_test</code> rule can be used to verify that compiling a Jsonnet
file results in an expected error code and error output. Simply define a
<code>jsonnet_to_json_test</code> target and provide the input test Jsonnet file, the
expected error code in the <code>error</code> attribute, and the <code>golden</code> file containing
the expected error output:</p>
<p dir="auto"><code>config/BUILD</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(
    &quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;,
    &quot;jsonnet_library&quot;,
    &quot;jsonnet_to_json_test&quot;,
)

jsonnet_library(
    name = &quot;base_config&quot;,
    srcs = [&quot;base_config.libsonnet&quot;],
)

jsonnet_to_json_test(
    name = &quot;invalid_config_test&quot;,
    src = &quot;invalid_config&quot;,
    deps = [&quot;:base_config&quot;],
    golden = &quot;invalid_config.output&quot;,
    error = 1,
)"><pre><span class="pl-en">load</span>(
    <span class="pl-s">"@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl"</span>,
    <span class="pl-s">"jsonnet_library"</span>,
    <span class="pl-s">"jsonnet_to_json_test"</span>,
)

<span class="pl-en">jsonnet_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"base_config"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"base_config.libsonnet"</span>],
)

<span class="pl-en">jsonnet_to_json_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"invalid_config_test"</span>,
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"invalid_config"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":base_config"</span>],
    <span class="pl-s1">golden</span> <span class="pl-c1">=</span> <span class="pl-s">"invalid_config.output"</span>,
    <span class="pl-s1">error</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>,
)</pre></div>
<p dir="auto">To run the test: <code>bazel test //config:invalid_config_test</code></p>
</article></div>