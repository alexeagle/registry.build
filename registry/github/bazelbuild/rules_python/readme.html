<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-python-rules-for-bazel" class="anchor" aria-hidden="true" tabindex="-1" href="#python-rules-for-bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python Rules for Bazel</h1>
<p dir="auto"><a href="https://buildkite.com/bazel/rules-python-python" rel="nofollow"><img src="https://camo.githubusercontent.com/0871bd13e80ed87a72a41f4292ccebb9e17714fc14c87257e9278854192c8e1e/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f30626366653538623666353734316161636230396231323438353936396261376131323035393535613435623533653835342e7376673f6272616e63683d6d61696e" alt="Build status" data-canonical-src="https://badge.buildkite.com/0bcfe58b6f5741aacb09b12485969ba7a1205955a45b53e854.svg?branch=main" style="max-width: 100%;"></a></p>
<h2 dir="auto"><a id="user-content-overview" class="anchor" aria-hidden="true" tabindex="-1" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Overview</h2>
<p dir="auto">This repository is the home of the core Python rules -- <code>py_library</code>,
<code>py_binary</code>, <code>py_test</code>, <code>py_proto_library</code>, and related symbols that provide the basis for Python
support in Bazel. It also contains package installation rules for integrating with PyPI and other indices.</p>
<p dir="auto">Documentation for rules_python  lives in the
<a href="https://github.com/bazelbuild/rules_python/tree/main/docs"><code>docs/</code></a>
directory and in the
<a href="https://docs.bazel.build/versions/master/be/python.html" rel="nofollow">Bazel Build Encyclopedia</a>.</p>
<p dir="auto">Examples live in the <a href="examples">examples</a> directory.</p>
<p dir="auto">Currently, the core rules build into the Bazel binary, and the symbols in this
repository are simple aliases. However, we are migrating the rules to Starlark and removing them from the Bazel binary. Therefore, the future-proof way to depend on Python rules is via this repository. See<a href="#Migrating-from-the-bundled-rules"><code>Migrating from the Bundled Rules</code></a> below.</p>
<p dir="auto">The core rules are stable. Their implementation in Bazel is subject to Bazel's
<a href="https://docs.bazel.build/versions/master/backward-compatibility.html" rel="nofollow">backward compatibility policy</a>.
Once migrated to rules_python, they may evolve at a different
rate, but this repository will still follow <a href="https://semver.org" rel="nofollow">semantic versioning</a>.</p>
<p dir="auto">The Bazel community maintains this repository. Neither Google nor the Bazel team provides support for the code. However, this repository is part of the test suite used to vet new Bazel releases. See <a href="CONTRIBUTING.md">How to contribute</a> page for information on our development workflow.</p>
<h2 dir="auto"><a id="user-content-bzlmod-support" class="anchor" aria-hidden="true" tabindex="-1" href="#bzlmod-support"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bzlmod support</h2>
<ul dir="auto">
<li>Status: Beta</li>
<li>Full Feature Parity: No</li>
</ul>
<p dir="auto">See <a href="BZLMOD_SUPPORT.md">Bzlmod support</a> for more details.</p>
<h2 dir="auto"><a id="user-content-getting-started" class="anchor" aria-hidden="true" tabindex="-1" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Getting started</h2>
<p dir="auto">The following two sections cover using <code>rules_python</code> with bzlmod and
the older way of configuring bazel with a <code>WORKSPACE</code> file.</p>
<h3 dir="auto"><a id="user-content-using-bzlmod" class="anchor" aria-hidden="true" tabindex="-1" href="#using-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using bzlmod</h3>
<p dir="auto"><strong>IMPORTANT: bzlmod support is still in Beta; APIs are subject to change.</strong></p>
<p dir="auto">The first step to using rules_python with bzlmod is to add the dependency to
your MODULE.bazel file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Update the version &quot;0.0.0&quot; to the release found here:
# https://github.com/bazelbuild/rules_python/releases.
bazel_dep(name = &quot;rules_python&quot;, version = &quot;0.0.0&quot;)"><pre><span class="pl-c"># Update the version "0.0.0" to the release found here:</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_python/releases.</span>
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_python"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.0.0"</span>)</pre></div>
<p dir="auto">Once added, you can load the rules and use them:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_python//python:py_binary.bzl&quot;, &quot;py_binary&quot;)

py_binary(...)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:py_binary.bzl"</span>, <span class="pl-s">"py_binary"</span>)

<span class="pl-en">py_binary</span>(...)</pre></div>
<p dir="auto">Depending on what you're doing, you likely want to do some additional
configuration to control what Python version is used; read the following
sections for how to do that.</p>
<h4 dir="auto"><a id="user-content-toolchain-registration-with-bzlmod" class="anchor" aria-hidden="true" tabindex="-1" href="#toolchain-registration-with-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Toolchain registration with bzlmod</h4>
<p dir="auto">A default toolchain is automatically configured depending on
<code>rules_python</code>. Note, however, the version used tracks the most recent Python
release and will change often.</p>
<p dir="auto">If you want to use a specific Python version for your programs, then how
to do so depends on if you're configuring the root module or not. The root
module is special because it can set the <em>default</em> Python version, which
is used by the version-unaware rules (e.g. <code>//python:py_binary.bzl</code> et al). For
submodules, it's recommended to use the version-aware rules to pin your programs
to a specific Python version so they don't accidentally run with a different
version configured by the root module.</p>
<h5 dir="auto"><a id="user-content-configuring-and-using-the-default-python-version" class="anchor" aria-hidden="true" tabindex="-1" href="#configuring-and-using-the-default-python-version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configuring and using the default Python version</h5>
<p dir="auto">To specify what the default Python version is, set <code>is_default = True</code> when
calling <code>python.toolchain()</code>. This can only be done by the root module; it is
silently ignored if a submodule does it. Similarly, using the version-unaware
rules (which always use the default Python version) should only be done by the
root module. If submodules use them, then they may run with a different Python
version than they expect.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="python = use_extension(&quot;@rules_python//python/extensions:python.bzl&quot;, &quot;python&quot;)

python.toolchain(
    python_version = &quot;3.11&quot;,
    is_default = True,
)"><pre><span class="pl-s1">python</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_python//python/extensions:python.bzl"</span>, <span class="pl-s">"python"</span>)

<span class="pl-s1">python</span>.<span class="pl-en">toolchain</span>(
    <span class="pl-s1">python_version</span> <span class="pl-c1">=</span> <span class="pl-s">"3.11"</span>,
    <span class="pl-s1">is_default</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)</pre></div>
<p dir="auto">Then use the base rules from e.g. <code>//python:py_binary.bzl</code>.</p>
<h5 dir="auto"><a id="user-content-pinning-to-a-python-version" class="anchor" aria-hidden="true" tabindex="-1" href="#pinning-to-a-python-version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Pinning to a Python version</h5>
<p dir="auto">Pinning to a version allows targets to force that a specific Python version is
used, even if the root module configures a different version as a default. This
is most useful for two cases:</p>
<ol dir="auto">
<li>For submodules to ensure they run with the appropriate Python version</li>
<li>To allow incremental, per-target, upgrading to newer Python versions,
typically in a mono-repo situation.</li>
</ol>
<p dir="auto">To configure a submodule with the version-aware rules, request the particular
version you need, then use the <code>@python_versions</code> repo to use the rules that
force specific versions:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="python = use_extension(&quot;@rules_python//python/extensions:python.bzl&quot;, &quot;python&quot;)

python.toolchain(
    python_version = &quot;3.11&quot;,
)
use_repo(python, &quot;python_versions&quot;)"><pre><span class="pl-s1">python</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_python//python/extensions:python.bzl"</span>, <span class="pl-s">"python"</span>)

<span class="pl-s1">python</span>.<span class="pl-en">toolchain</span>(
    <span class="pl-s1">python_version</span> <span class="pl-c1">=</span> <span class="pl-s">"3.11"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">python</span>, <span class="pl-s">"python_versions"</span>)</pre></div>
<p dir="auto">Then use e.g. <code>load("@python_versions//3.11:defs.bzl", "py_binary")</code> to use
the rules that force that particular version. Multiple versions can be specified
and use within a single build.</p>
<p dir="auto">For more documentation, see the bzlmod examples under the <a href="examples">examples</a> folder.  Look for the examples that contain a <code>MODULE.bazel</code> file.</p>
<h5 dir="auto"><a id="user-content-other-toolchain-details" class="anchor" aria-hidden="true" tabindex="-1" href="#other-toolchain-details"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Other toolchain details</h5>
<p dir="auto">The <code>python.toolchain()</code> call makes its contents available under a repo named
<code>python_X_Y</code>, where X and Y are the major and minor versions. For example,
<code>python.toolchain(python_version="3.11")</code> creates the repo <code>@python_3_11</code>.
Remember to call <code>use_repo()</code> to make repos visible to your module:
<code>use_repo(python, "python_3_11")</code></p>
<h3 dir="auto"><a id="user-content-using-a-workspace-file" class="anchor" aria-hidden="true" tabindex="-1" href="#using-a-workspace-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using a WORKSPACE file</h3>
<p dir="auto">To import rules_python in your project, you first need to add it to your
<code>WORKSPACE</code> file, using the snippet provided in the
<a href="https://github.com/bazelbuild/rules_python/releases">release you choose</a></p>
<p dir="auto">To depend on a particular unreleased version, you can do the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)


# Update the SHA and VERSION to the lastest version available here:
# https://github.com/bazelbuild/rules_python/releases.

SHA=&quot;84aec9e21cc56fbc7f1335035a71c850d1b9b5cc6ff497306f84cced9a769841&quot;

VERSION=&quot;0.23.1&quot;

http_archive(
    name = &quot;rules_python&quot;,
    sha256 = SHA,
    strip_prefix = &quot;rules_python-{}&quot;.format(VERSION),
    url = &quot;https://github.com/bazelbuild/rules_python/releases/download/{}/rules_python-{}.tar.gz&quot;.format(VERSION,VERSION),
)

load(&quot;@rules_python//python:repositories.bzl&quot;, &quot;py_repositories&quot;)

py_repositories()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)


<span class="pl-c"># Update the SHA and VERSION to the lastest version available here:</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_python/releases.</span>

<span class="pl-v">SHA</span><span class="pl-c1">=</span><span class="pl-s">"84aec9e21cc56fbc7f1335035a71c850d1b9b5cc6ff497306f84cced9a769841"</span>

<span class="pl-v">VERSION</span><span class="pl-c1">=</span><span class="pl-s">"0.23.1"</span>

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_python"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-v">SHA</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_python-{}"</span>.<span class="pl-en">format</span>(<span class="pl-v">VERSION</span>),
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/bazelbuild/rules_python/releases/download/{}/rules_python-{}.tar.gz"</span>.<span class="pl-en">format</span>(<span class="pl-v">VERSION</span>,<span class="pl-v">VERSION</span>),
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:repositories.bzl"</span>, <span class="pl-s">"py_repositories"</span>)

<span class="pl-en">py_repositories</span>()</pre></div>
<h4 dir="auto"><a id="user-content-toolchain-registration" class="anchor" aria-hidden="true" tabindex="-1" href="#toolchain-registration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Toolchain registration</h4>
<p dir="auto">To register a hermetic Python toolchain rather than rely on a system-installed interpreter for runtime execution, you can add to the <code>WORKSPACE</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_python//python:repositories.bzl&quot;, &quot;python_register_toolchains&quot;)

python_register_toolchains(
    name = &quot;python_3_11&quot;,
    # Available versions are listed in @rules_python//python:versions.bzl.
    # We recommend using the same version your team is already standardized on.
    python_version = &quot;3.11&quot;,
)

load(&quot;@python_3_11//:defs.bzl&quot;, &quot;interpreter&quot;)

load(&quot;@rules_python//python:pip.bzl&quot;, &quot;pip_parse&quot;)

pip_parse(
    ...
    python_interpreter_target = interpreter,
    ...
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:repositories.bzl"</span>, <span class="pl-s">"python_register_toolchains"</span>)

<span class="pl-en">python_register_toolchains</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"python_3_11"</span>,
    <span class="pl-c"># Available versions are listed in @rules_python//python:versions.bzl.</span>
    <span class="pl-c"># We recommend using the same version your team is already standardized on.</span>
    <span class="pl-s1">python_version</span> <span class="pl-c1">=</span> <span class="pl-s">"3.11"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@python_3_11//:defs.bzl"</span>, <span class="pl-s">"interpreter"</span>)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:pip.bzl"</span>, <span class="pl-s">"pip_parse"</span>)

<span class="pl-en">pip_parse</span>(
    ...
    <span class="pl-s1">python_interpreter_target</span> <span class="pl-c1">=</span> <span class="pl-s1">interpreter</span>,
    ...
)</pre></div>
<p dir="auto">After registration, your Python targets will use the toolchain's interpreter during execution, but a system-installed interpreter
is still used to 'bootstrap' Python targets (see <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="1213269189" data-permission-text="Title is private" data-url="https://github.com/bazelbuild/rules_python/issues/691" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/rules_python/issues/691/hovercard" href="https://github.com/bazelbuild/rules_python/issues/691">#691</a>).
You may also find some quirks while using this toolchain. Please refer to <a href="https://python-build-standalone.readthedocs.io/en/latest/quirks.html" rel="nofollow">python-build-standalone documentation's <em>Quirks</em> section</a>.</p>
<h3 dir="auto"><a id="user-content-toolchain-usage-in-other-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#toolchain-usage-in-other-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Toolchain usage in other rules</h3>
<p dir="auto">Python toolchains can be utilized in other bazel rules, such as <code>genrule()</code>, by adding the <code>toolchains=["@rules_python//python:current_py_toolchain"]</code> attribute. You can obtain the path to the Python interpreter using the <code>$(PYTHON2)</code> and <code>$(PYTHON3)</code> <a href="https://bazel.build/reference/be/make-variables" rel="nofollow">"Make" Variables</a>. See the <a href="tests/load_from_macro/BUILD.bazel"><code>test_current_py_toolchain</code></a> target for an example.</p>
<h3 dir="auto"><a id="user-content-hello-world" class="anchor" aria-hidden="true" tabindex="-1" href="#hello-world"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>"Hello World"</h3>
<p dir="auto">Once you've imported the rule set into your <code>WORKSPACE</code> using any of these
methods, you can then load the core rules in your <code>BUILD</code> files with the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_python//python:defs.bzl&quot;, &quot;py_binary&quot;)

py_binary(
  name = &quot;main&quot;,
  srcs = [&quot;main.py&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:defs.bzl"</span>, <span class="pl-s">"py_binary"</span>)

<span class="pl-en">py_binary</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"main"</span>,
  <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"main.py"</span>],
)</pre></div>
<h2 dir="auto"><a id="user-content-using-dependencies-from-pypi" class="anchor" aria-hidden="true" tabindex="-1" href="#using-dependencies-from-pypi"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using dependencies from PyPI</h2>
<p dir="auto">Using PyPI packages (aka "pip install") involves two main steps.</p>
<ol dir="auto">
<li><a href="#installing-third_party-packages">Installing third_party packages</a></li>
<li>[Using third_party packages as dependencies](#using-third_party-packages-as-dependencies</li>
</ol>
<h3 dir="auto"><a id="user-content-installing-third_party-packages" class="anchor" aria-hidden="true" tabindex="-1" href="#installing-third_party-packages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installing third_party packages</h3>
<h4 dir="auto"><a id="user-content-using-bzlmod-1" class="anchor" aria-hidden="true" tabindex="-1" href="#using-bzlmod-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using bzlmod</h4>
<p dir="auto">To add pip dependencies to your <code>MODULE.bazel</code> file, use the <code>pip.parse</code> extension, and call it to create the central external repo and individual wheel external repos. Include in the <code>MODULE.bazel</code> the toolchain extension as shown in the first bzlmod example above.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="pip = use_extension(&quot;@rules_python//python/extensions:pip.bzl&quot;, &quot;pip&quot;)
pip.parse(
    hub_name = &quot;my_deps&quot;,
    python_version = &quot;3.11&quot;,
    requirements_lock = &quot;//:requirements_lock_3_11.txt&quot;,
)
use_repo(pip, &quot;my_deps&quot;)"><pre><span class="pl-s1">pip</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_python//python/extensions:pip.bzl"</span>, <span class="pl-s">"pip"</span>)
<span class="pl-s1">pip</span>.<span class="pl-en">parse</span>(
    <span class="pl-s1">hub_name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_deps"</span>,
    <span class="pl-s1">python_version</span> <span class="pl-c1">=</span> <span class="pl-s">"3.11"</span>,
    <span class="pl-s1">requirements_lock</span> <span class="pl-c1">=</span> <span class="pl-s">"//:requirements_lock_3_11.txt"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">pip</span>, <span class="pl-s">"my_deps"</span>)</pre></div>
<p dir="auto">For more documentation, including how the rules can update/create a requirements file, see the bzlmod examples under the <a href="examples">examples</a> folder.</p>
<h4 dir="auto"><a id="user-content-using-a-workspace-file-1" class="anchor" aria-hidden="true" tabindex="-1" href="#using-a-workspace-file-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using a WORKSPACE file</h4>
<p dir="auto">To add pip dependencies to your <code>WORKSPACE</code>, load the <code>pip_parse</code> function and call it to create the central external repo and individual wheel external repos.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_python//python:pip.bzl&quot;, &quot;pip_parse&quot;)

# Create a central repo that knows about the dependencies needed from
# requirements_lock.txt.
pip_parse(
   name = &quot;my_deps&quot;,
   requirements_lock = &quot;//path/to:requirements_lock.txt&quot;,
)
# Load the starlark macro, which will define your dependencies.
load(&quot;@my_deps//:requirements.bzl&quot;, &quot;install_deps&quot;)
# Call it to define repos for your requirements.
install_deps()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:pip.bzl"</span>, <span class="pl-s">"pip_parse"</span>)

<span class="pl-c"># Create a central repo that knows about the dependencies needed from</span>
<span class="pl-c"># requirements_lock.txt.</span>
<span class="pl-en">pip_parse</span>(
   <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_deps"</span>,
   <span class="pl-s1">requirements_lock</span> <span class="pl-c1">=</span> <span class="pl-s">"//path/to:requirements_lock.txt"</span>,
)
<span class="pl-c"># Load the starlark macro, which will define your dependencies.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@my_deps//:requirements.bzl"</span>, <span class="pl-s">"install_deps"</span>)
<span class="pl-c"># Call it to define repos for your requirements.</span>
<span class="pl-en">install_deps</span>()</pre></div>
<h4 dir="auto"><a id="user-content-pip-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#pip-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>pip rules</h4>
<p dir="auto">Note that since <code>pip_parse</code> is a repository rule and therefore executes pip at WORKSPACE-evaluation time, Bazel has no
information about the Python toolchain and cannot enforce that the interpreter
used to invoke pip matches the interpreter used to run <code>py_binary</code> targets. By
default, <code>pip_parse</code> uses the system command <code>"python3"</code>. To override this, pass in the
<code>python_interpreter</code> attribute or <code>python_interpreter_target</code> attribute to <code>pip_parse</code>.</p>
<p dir="auto">You can have multiple <code>pip_parse</code>s in the same workspace.  Or use the pip extension multiple times when using bzlmod.
This configuration will create multiple external repos that have no relation to one another
and may result in downloading the same wheels numerous times.</p>
<p dir="auto">As with any repository rule, if you would like to ensure that <code>pip_parse</code> is
re-executed to pick up a non-hermetic change to your environment (e.g.,
updating your system <code>python</code> interpreter), you can force it to re-execute by running
<code>bazel sync --only [pip_parse name]</code>.</p>
<p dir="auto">Note: The <code>pip_install</code> rule is deprecated. <code>pip_parse</code> offers identical functionality, and both <code>pip_install</code> and <code>pip_parse</code> now have the same implementation. The name <code>pip_install</code> may be removed in a future version of the rules.</p>
<p dir="auto">The maintainers have made all reasonable efforts to facilitate a smooth transition. Still, some users of <code>pip_install</code> will need to replace their existing <code>requirements.txt</code> with a fully resolved set of dependencies using a tool such as <code>pip-tools</code> or the <code>compile_pip_requirements</code> repository rule.</p>
<h3 dir="auto"><a id="user-content-using-third_party-packages-as-dependencies" class="anchor" aria-hidden="true" tabindex="-1" href="#using-third_party-packages-as-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using third_party packages as dependencies</h3>
<p dir="auto">Each extracted wheel repo contains a <code>py_library</code> target representing
the wheel's contents. There are two ways to access this library. The
first uses the <code>requirement()</code> function defined in the central
repo's <code>//:requirements.bzl</code> file. This function maps a pip package
name to a label:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@my_deps//:requirements.bzl&quot;, &quot;requirement&quot;)

py_library(
    name = &quot;mylib&quot;,
    srcs = [&quot;mylib.py&quot;],
    deps = [
        &quot;:myotherlib&quot;,
        requirement(&quot;some_pip_dep&quot;),
        requirement(&quot;another_pip_dep&quot;),
    ]
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@my_deps//:requirements.bzl"</span>, <span class="pl-s">"requirement"</span>)

<span class="pl-en">py_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"mylib"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"mylib.py"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">":myotherlib"</span>,
        <span class="pl-en">requirement</span>(<span class="pl-s">"some_pip_dep"</span>),
        <span class="pl-en">requirement</span>(<span class="pl-s">"another_pip_dep"</span>),
    ]
)</pre></div>
<p dir="auto">The reason <code>requirement()</code> exists is that the pattern for the labels,
while not expected to change frequently, is not guaranteed to be
stable. Using <code>requirement()</code> ensures you do not have to refactor
your <code>BUILD</code> files if the pattern changes.</p>
<p dir="auto">On the other hand, using <code>requirement()</code> has several drawbacks; see
<a href="https://github.com/bazelbuild/rules_python/issues/414" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/rules_python/issues/414/hovercard">this issue</a> for an enumeration. If you don't
want to use <code>requirement()</code>, you can use the library
labels directly instead. For <code>pip_parse</code>, the labels are of the following form:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@{name}_{package}//:pkg"><pre><span class="pl-en">@{<span class="pl-s1">name</span>}<span class="pl-s1">_</span>{<span class="pl-s1">package</span>}<span class="pl-c1">//</span>:<span class="pl-s1">pkg</span></span></pre></div>
<p dir="auto">Here <code>name</code> is the <code>name</code> attribute that was passed to <code>pip_parse</code> and
<code>package</code> is the pip package name with characters that are illegal in
Bazel label names (e.g. <code>-</code>, <code>.</code>) replaced with <code>_</code>. If you need to
update <code>name</code> from "old" to "new", then you can run the following
buildozer command:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="buildozer 'substitute deps @old_([^/]+)//:pkg @new_${1}//:pkg' //...:*"><pre>buildozer <span class="pl-s"><span class="pl-pds">'</span>substitute deps @old_([^/]+)//:pkg @new_${1}//:pkg<span class="pl-pds">'</span></span> //...:<span class="pl-k">*</span></pre></div>
<p dir="auto">For <code>pip_install</code>, the labels are instead of the form:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@{name}//pypi__{package}"><pre><span class="pl-en">@{<span class="pl-s1">name</span>}<span class="pl-c1">//</span><span class="pl-s1">pypi__</span>{<span class="pl-s1">package</span>}</span></pre></div>
<h4 dir="auto"><a id="user-content-extras-dependencies" class="anchor" aria-hidden="true" tabindex="-1" href="#extras-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>'Extras' dependencies</h4>
<p dir="auto">Any 'extras' specified in the requirements lock file will be automatically added as transitive dependencies of the package. In the example above, you'd just put <code>requirement("useful_dep")</code>.</p>
<h3 dir="auto"><a id="user-content-consuming-wheel-dists-directly" class="anchor" aria-hidden="true" tabindex="-1" href="#consuming-wheel-dists-directly"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Consuming Wheel Dists Directly</h3>
<p dir="auto">If you need to depend on the wheel dists themselves, for instance, to pass them
to some other packaging tool, you can get a handle to them with the <code>whl_requirement</code> macro. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="filegroup(
    name = &quot;whl_files&quot;,
    data = [
        whl_requirement(&quot;boto3&quot;),
    ]
)"><pre><span class="pl-en">filegroup</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"whl_files"</span>,
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> [
        <span class="pl-en">whl_requirement</span>(<span class="pl-s">"boto3"</span>),
    ]
)</pre></div>
<h1 dir="auto"><a id="user-content-python-gazelle-plugin" class="anchor" aria-hidden="true" tabindex="-1" href="#python-gazelle-plugin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python Gazelle plugin</h1>
<p dir="auto"><a href="https://github.com/bazelbuild/bazel-gazelle">Gazelle</a>
is a build file generator for Bazel projects. It can create new <code>BUILD.bazel</code> files for a project that follows language conventions and update existing build files to include new sources, dependencies, and options.</p>
<p dir="auto">Bazel may run Gazelle using the Gazelle rule, or it may be installed and run as a command line tool.</p>
<p dir="auto">See the documentation for Gazelle with rules_python <a href="gazelle">here</a>.</p>
<h2 dir="auto"><a id="user-content-migrating-from-the-bundled-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#migrating-from-the-bundled-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Migrating from the bundled rules</h2>
<p dir="auto">The core rules are currently available in Bazel as built-in symbols, but this
form is deprecated. Instead, you should depend on rules_python in your
<code>WORKSPACE</code> file and load the Python rules from
<code>@rules_python//python:defs.bzl</code>.</p>
<p dir="auto">A <a href="https://github.com/bazelbuild/buildtools/blob/master/buildifier/README.md">buildifier</a>
fix is available to automatically migrate <code>BUILD</code> and <code>.bzl</code> files to add the
appropriate <code>load()</code> statements and rewrite uses of <code>native.py_*</code>.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Also consider using the -r flag to modify an entire workspace.
buildifier --lint=fix --warnings=native-py &lt;files&gt;"><pre><span class="pl-c"><span class="pl-c">#</span> Also consider using the -r flag to modify an entire workspace.</span>
buildifier --lint=fix --warnings=native-py <span class="pl-k">&lt;</span>files<span class="pl-k">&gt;</span></pre></div>
<p dir="auto">Currently, the <code>WORKSPACE</code> file needs to be updated manually as per <a href="#Getting-started">Getting
started</a> above.</p>
<p dir="auto">Note that Starlark-defined bundled symbols underneath
<code>@bazel_tools//tools/python</code> are also deprecated. These are not yet rewritten
by buildifier.</p>
</article></div>