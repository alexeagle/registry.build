<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 id="user-content-container-structure-tests" dir="auto"><a class="heading-link" href="#container-structure-tests">Container Structure Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1>
<p dir="auto">The Container Structure Tests provide a powerful framework to validate the structure
of a container image. These tests can be used to check the output of commands
in an image, as well as verify metadata and contents of the filesystem.</p>
<p dir="auto">Tests can be run either through a standalone binary, or through a Docker image.</p>
<p dir="auto"><strong>Note: container-structure-test is not an officially supported Google project, and is currently in maintainence mode. Contributions are still welcome!</strong></p>
<h2 id="user-content-installation" dir="auto"><a class="heading-link" href="#installation">Installation<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<h3 id="user-content-os-x" dir="auto"><a class="heading-link" href="#os-x">OS X<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Install via <a href="https://brew.sh/" rel="nofollow">brew</a>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ brew install container-structure-test"><pre>$ brew install container-structure-test</pre></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-darwin-amd64 &amp;&amp; chmod +x container-structure-test-darwin-amd64 &amp;&amp; sudo mv container-structure-test-darwin-amd64 /usr/local/bin/container-structure-test"><pre>curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-darwin-amd64 <span class="pl-k">&amp;&amp;</span> chmod +x container-structure-test-darwin-amd64 <span class="pl-k">&amp;&amp;</span> sudo mv container-structure-test-darwin-amd64 /usr/local/bin/container-structure-test</pre></div>
<h3 id="user-content-linux" dir="auto"><a class="heading-link" href="#linux">Linux<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-linux-amd64 &amp;&amp; chmod +x container-structure-test-linux-amd64 &amp;&amp; sudo mv container-structure-test-linux-amd64 /usr/local/bin/container-structure-test"><pre>curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-linux-amd64 <span class="pl-k">&amp;&amp;</span> chmod +x container-structure-test-linux-amd64 <span class="pl-k">&amp;&amp;</span> sudo mv container-structure-test-linux-amd64 /usr/local/bin/container-structure-test</pre></div>
<p dir="auto">If you want to avoid using sudo:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-linux-amd64 &amp;&amp; chmod +x container-structure-test-linux-amd64 &amp;&amp; mkdir -p $HOME/bin &amp;&amp; export PATH=$PATH:$HOME/bin &amp;&amp; mv container-structure-test-linux-amd64 $HOME/bin/container-structure-test"><pre>curl -LO https://storage.googleapis.com/container-structure-test/latest/container-structure-test-linux-amd64 <span class="pl-k">&amp;&amp;</span> chmod +x container-structure-test-linux-amd64 <span class="pl-k">&amp;&amp;</span> mkdir -p <span class="pl-smi">$HOME</span>/bin <span class="pl-k">&amp;&amp;</span> <span class="pl-k">export</span> PATH=<span class="pl-smi">$PATH</span>:<span class="pl-smi">$HOME</span>/bin <span class="pl-k">&amp;&amp;</span> mv container-structure-test-linux-amd64 <span class="pl-smi">$HOME</span>/bin/container-structure-test</pre></div>
<p dir="auto">Additionally, a container image for running tests through Google Cloud Builder can be found
at <code>gcr.io/gcp-runtimes/container-structure-test:latest</code>.</p>
<h2 id="user-content-setup" dir="auto"><a class="heading-link" href="#setup">Setup<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To use container structure tests to validate your containers, you'll need the following:</p>
<ul dir="auto">
<li>The container structure test binary or docker image</li>
<li>A container image to test against</li>
<li>A test <code>.yaml</code> or <code>.json</code> file with user defined structure tests to run inside of the specified container image</li>
</ul>
<p dir="auto">Note that the test framework looks for the provided image in the local Docker
daemon (if it is not provided as a tar). The <code>--pull</code> flag can optionally
be provided to force a pull of a remote image before running the tests.</p>
<h2 id="user-content-example-run" dir="auto"><a class="heading-link" href="#example-run">Example Run<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">An example run of the test framework:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="container-structure-test test --image gcr.io/registry/image:latest \
--config config.yaml"><pre>container-structure-test <span class="pl-c1">test</span> --image gcr.io/registry/image:latest \
--config config.yaml</pre></div>
<p dir="auto">Tests within this framework are specified through a YAML or JSON config file,
which is provided to the test driver via a CLI flag. Multiple config files may
be specified in a single test run. The config file will be loaded in by the
test driver, which will execute the tests in order. Within this config file,
four types of tests can be written:</p>
<ul dir="auto">
<li>Command Tests (testing output/error of a specific command issued)</li>
<li>File Existence Tests (making sure a file is, or isn't, present in the
file system of the image)</li>
<li>File Content Tests (making sure files in the file system of the image
contain, or do not contain, specific contents)</li>
<li>Metadata Test, <em>singular</em> (making sure certain container metadata is correct)</li>
</ul>
<h2 id="user-content-command-tests" dir="auto"><a class="heading-link" href="#command-tests">Command Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Command tests ensure that certain commands run properly in the target image.
Regexes can be used to check for expected or excluded strings in both <code>stdout</code>
and <code>stderr</code>. Additionally, any number of flags can be passed to the argument
as normal. Each command in the setup section will run in a separate container
and then commits a modified image to be the new base image for the test run.</p>
<h4 id="user-content-supported-fields" dir="auto"><a class="heading-link" href="#supported-fields">Supported Fields:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<p dir="auto"><strong>NOTE: <code>schemaVersion</code> must be specified in all container-structure-test yamls. The current version is <code>2.0.0</code>.</strong></p>
<ul dir="auto">
<li>Name (<code>string</code>, <strong>required</strong>): The name of the test</li>
<li>Setup (<code>[][]string</code>, <em>optional</em>): A list of commands
(each with optional flags) to run before the actual command under test.</li>
<li>Teardown (<code>[][]string</code>, <em>optional</em>): A list of commands
(each with optional flags) to run after the actual command under test.</li>
<li>Command (<code>string</code>, <strong>required</strong>): The command to run in the test.</li>
<li>Args (<code>[]string</code>, <em>optional</em>): The arguments to pass to the command.</li>
<li>EnvVars (<code>[]EnvVar</code>, <em>optional</em>): A list of environment variables to set for
the individual test. See the <strong>Environment Variables</strong> section for more info.</li>
<li>Expected Output (<code>[]string</code>, <em>optional</em>): List of regexes that should
match the stdout from running the command.</li>
<li>Excluded Output (<code>[]string</code>, <em>optional</em>): List of regexes that should <strong>not</strong>
match the stdout from running the command.</li>
<li>Expected Error (<code>[]string</code>, <em>optional</em>): List of regexes that should
match the stderr from running the command.</li>
<li>Excluded Error (<code>[]string</code>, <em>optional</em>): List of regexes that should <strong>not</strong>
match the stderr from running the command.</li>
<li>Exit Code (<code>int</code>, <em>optional</em>): Exit code that the command should exit with.</li>
</ul>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="commandTests:
  - name: &quot;gunicorn flask&quot;
    setup: [[&quot;virtualenv&quot;, &quot;/env&quot;], [&quot;pip&quot;, &quot;install&quot;, &quot;gunicorn&quot;, &quot;flask&quot;]]
    command: &quot;which&quot;
    args: [&quot;gunicorn&quot;]
    expectedOutput: [&quot;/env/bin/gunicorn&quot;]
  - name:  &quot;apt-get upgrade&quot;
    command: &quot;apt-get&quot;
    args: [&quot;-qqs&quot;, &quot;upgrade&quot;]
    excludedOutput: [&quot;.*Inst.*Security.* | .*Security.*Inst.*&quot;]
    excludedError: [&quot;.*Inst.*Security.* | .*Security.*Inst.*&quot;]"><pre><span class="pl-ent">commandTests</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>gunicorn flask<span class="pl-pds">"</span></span>
    <span class="pl-ent">setup</span>: <span class="pl-s">[["virtualenv", "/env"], ["pip", "install", "gunicorn", "flask"]]</span>
    <span class="pl-ent">command</span>: <span class="pl-s"><span class="pl-pds">"</span>which<span class="pl-pds">"</span></span>
    <span class="pl-ent">args</span>: <span class="pl-s">["gunicorn"]</span>
    <span class="pl-ent">expectedOutput</span>: <span class="pl-s">["/env/bin/gunicorn"]</span>
  - <span class="pl-ent">name</span>:  <span class="pl-s"><span class="pl-pds">"</span>apt-get upgrade<span class="pl-pds">"</span></span>
    <span class="pl-ent">command</span>: <span class="pl-s"><span class="pl-pds">"</span>apt-get<span class="pl-pds">"</span></span>
    <span class="pl-ent">args</span>: <span class="pl-s">["-qqs", "upgrade"]</span>
    <span class="pl-ent">excludedOutput</span>: <span class="pl-s">[".*Inst.*Security.* | .*Security.*Inst.*"]</span>
    <span class="pl-ent">excludedError</span>: <span class="pl-s">[".*Inst.*Security.* | .*Security.*Inst.*"]</span></pre></div>
<p dir="auto">Depending on your command the argument section can get quite long. Thus, you
can make use of YAML's list style option for separation of arguments and the
literal style option to preserve newlines like so:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="commandTests:
  - name: &quot;say hello world&quot;
    command: &quot;bash&quot;
    args:
      - -c
      - |
         echo hello &amp;&amp;
         echo world"><pre>commandTests:
  - name: <span class="pl-s"><span class="pl-pds">"</span>say hello world<span class="pl-pds">"</span></span>
    command: <span class="pl-s"><span class="pl-pds">"</span>bash<span class="pl-pds">"</span></span>
    args:
      - -c
      - <span class="pl-k">|</span>
         <span class="pl-c1">echo</span> hello <span class="pl-k">&amp;&amp;</span>
         <span class="pl-c1">echo</span> world</pre></div>
<h3 id="user-content-image-entrypoint" dir="auto"><a class="heading-link" href="#image-entrypoint">Image Entrypoint<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">To avoid unexpected behavior and output when running commands in the
containers, <strong>all entrypoints are overwritten by default.</strong> If your
entrypoint is necessary for the structure of your container, use the
<code>setup</code> field to call any scripts or commands manually before running
the tests.</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="commandTests:
  ...
  setup: [[&quot;my_image_entrypoint.sh&quot;]]
  ..."><pre><span class="pl-ent">commandTests</span>:
  <span class="pl-s">...</span>
  <span class="pl-ent">setup</span>: <span class="pl-s">[["my_image_entrypoint.sh"]]</span>
  <span class="pl-s">...</span></pre></div>
<h3 id="user-content-intermediate-artifacts" dir="auto"><a class="heading-link" href="#intermediate-artifacts">Intermediate Artifacts<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Each command test run creates either a container (with the <code>docker</code> driver) or
tar artifact (with the <code>tar</code> driver). By default, these are deleted after the
test run finishes, but the <code>--save</code> flag can optionally be passed to keep
these around. This would normally be used for debugging purposes.</p>
<h2 id="user-content-file-existence-tests" dir="auto"><a class="heading-link" href="#file-existence-tests">File Existence Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">File existence tests check to make sure a specific file (or directory) exist
within the file system of the image. No contents of the files or directories
are checked. These tests can also be used to ensure a file or directory is
<strong>not</strong> present in the file system.</p>
<h4 id="user-content-supported-fields-1" dir="auto"><a class="heading-link" href="#supported-fields-1">Supported Fields:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<ul dir="auto">
<li>Name (<code>string</code>, <strong>required</strong>): The name of the test</li>
<li>Path (<code>string</code>, <strong>required</strong>): Path to the file or directory under test</li>
<li>ShouldExist (<code>boolean</code>, <strong>required</strong>): Whether or not the specified file or
directory should exist in the file system</li>
<li>Permissions (<code>string</code>, <em>optional</em>): The expected Unix permission string (e.g.
drwxrwxrwx) of the files or directory.</li>
<li>Uid (<code>int</code>, <em>optional</em>): The expected Unix user ID of the owner of the file
or directory.</li>
<li>Gid (<code>int</code>, <em>optional</em>): The expected Unix group ID of the owner of the file or directory.</li>
<li>IsExecutableBy (<code>string</code>, <em>optional</em>): Checks if file is executable by a given user.
One of <code>owner</code>, <code>group</code>, <code>other</code> or <code>any</code></li>
</ul>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="fileExistenceTests:
- name: 'Root'
  path: '/'
  shouldExist: true
  permissions: '-rw-r--r--'
  uid: 1000
  gid: 1000
  isExecutableBy: 'group'"><pre><span class="pl-ent">fileExistenceTests</span>:
- <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">'</span>Root<span class="pl-pds">'</span></span>
  <span class="pl-ent">path</span>: <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>
  <span class="pl-ent">shouldExist</span>: <span class="pl-c1">true</span>
  <span class="pl-ent">permissions</span>: <span class="pl-s"><span class="pl-pds">'</span>-rw-r--r--<span class="pl-pds">'</span></span>
  <span class="pl-ent">uid</span>: <span class="pl-c1">1000</span>
  <span class="pl-ent">gid</span>: <span class="pl-c1">1000</span>
  <span class="pl-ent">isExecutableBy</span>: <span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span></pre></div>
<h2 id="user-content-file-content-tests" dir="auto"><a class="heading-link" href="#file-content-tests">File Content Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">File content tests open a file on the file system and check its contents.
These tests assume the specified file <strong>is a file</strong>, and that it <strong>exists</strong>
(if unsure about either or these criteria, see the above
<strong>File Existence Tests</strong> section). Regexes can again be used to check for
expected or excluded content in the specified file.</p>
<h4 id="user-content-supported-fields-2" dir="auto"><a class="heading-link" href="#supported-fields-2">Supported Fields:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<ul dir="auto">
<li>Name (<code>string</code>, <strong>required</strong>): The name of the test</li>
<li>Path (<code>string</code>, <strong>required</strong>): Path to the file under test</li>
<li>ExpectedContents (<code>string[]</code>, <em>optional</em>): List of regexes that
should match the contents of the file</li>
<li>ExcludedContents (<code>string[]</code>, <em>optional</em>): List of regexes that
should <strong>not</strong> match the contents of the file</li>
</ul>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="fileContentTests:
- name: 'Debian Sources'
  path: '/etc/apt/sources.list'
  expectedContents: ['.*httpredir\.debian\.org.*']
  excludedContents: ['.*gce_debian_mirror.*']"><pre><span class="pl-ent">fileContentTests</span>:
- <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">'</span>Debian Sources<span class="pl-pds">'</span></span>
  <span class="pl-ent">path</span>: <span class="pl-s"><span class="pl-pds">'</span>/etc/apt/sources.list<span class="pl-pds">'</span></span>
  <span class="pl-ent">expectedContents</span>: <span class="pl-s">['.*httpredir\.debian\.org.*']</span>
  <span class="pl-ent">excludedContents</span>: <span class="pl-s">['.*gce_debian_mirror.*']</span></pre></div>
<h2 id="user-content-metadata-test" dir="auto"><a class="heading-link" href="#metadata-test">Metadata Test<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The Metadata test ensures the container is configured correctly. All
of these checks are optional.</p>
<h4 id="user-content-supported-fields-3" dir="auto"><a class="heading-link" href="#supported-fields-3">Supported Fields:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<ul dir="auto">
<li>EnvVars (<code>[]EnvVar</code>): A list of environment variable key/value pairs that should be set
in the container. isRegex (<em>optional</em>) interpretes the value as regex.</li>
<li>UnboundEnvVars (<code>[]EnvVar</code>): A list of environment variable keys that should <strong>NOT</strong> be set
in the container.</li>
<li>Labels (<code>[]Label</code>): A list of image labels key/value pairs that should be set on the
container. isRegex (<em>optional</em>) interpretes the value as regex.</li>
<li>Entrypoint (<code>[]string</code>): The entrypoint of the container.</li>
<li>Cmd (<code>[]string</code>): The CMD specified in the container.</li>
<li>Exposed Ports (<code>[]string</code>): The ports exposed in the container.</li>
<li>Unexposed Ports (<code>[]string</code>): The ports <strong>NOT</strong> exposed in the container.</li>
<li>Volumes (<code>[]string</code>): The volumes exposed in the container.</li>
<li>UnmountedVolumes (<code>[]string</code>): The volumes <strong>NOT</strong> exposed in the container.</li>
<li>Workdir (<code>string</code>): The default working directory of the container.</li>
<li>User (<code>user</code>): The default user of the container.</li>
</ul>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="metadataTest:
  envVars:
    - key: foo
      value: baz
  labels:
    - key: 'com.example.vendor'
      value: 'ACME Incorporated'
    - key: 'build-date'
      value: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{6}$'
      isRegex: true
  exposedPorts: [&quot;8080&quot;, &quot;2345&quot;]
  volumes: [&quot;/test&quot;]
  entrypoint: []
  cmd: [&quot;/bin/bash&quot;]
  workdir: &quot;/app&quot;
  user: &quot;luke&quot;"><pre><span class="pl-ent">metadataTest</span>:
  <span class="pl-ent">envVars</span>:
    - <span class="pl-ent">key</span>: <span class="pl-s">foo</span>
      <span class="pl-ent">value</span>: <span class="pl-s">baz</span>
  <span class="pl-ent">labels</span>:
    - <span class="pl-ent">key</span>: <span class="pl-s"><span class="pl-pds">'</span>com.example.vendor<span class="pl-pds">'</span></span>
      <span class="pl-ent">value</span>: <span class="pl-s"><span class="pl-pds">'</span>ACME Incorporated<span class="pl-pds">'</span></span>
    - <span class="pl-ent">key</span>: <span class="pl-s"><span class="pl-pds">'</span>build-date<span class="pl-pds">'</span></span>
      <span class="pl-ent">value</span>: <span class="pl-s"><span class="pl-pds">'</span>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{6}$<span class="pl-pds">'</span></span>
      <span class="pl-ent">isRegex</span>: <span class="pl-c1">true</span>
  <span class="pl-ent">exposedPorts</span>: <span class="pl-s">["8080", "2345"]</span>
  <span class="pl-ent">volumes</span>: <span class="pl-s">["/test"]</span>
  <span class="pl-ent">entrypoint</span>: <span class="pl-s">[]</span>
  <span class="pl-ent">cmd</span>: <span class="pl-s">["/bin/bash"]</span>
  <span class="pl-ent">workdir</span>: <span class="pl-s"><span class="pl-pds">"</span>/app<span class="pl-pds">"</span></span>
  <span class="pl-ent">user</span>: <span class="pl-s"><span class="pl-pds">"</span>luke<span class="pl-pds">"</span></span></pre></div>
<h2 id="user-content-license-tests" dir="auto"><a class="heading-link" href="#license-tests">License Tests<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">License tests check a list of copyright files and makes sure all licenses are
allowed at Google. By default it will look at where Debian lists all copyright
files, but can also look at an arbitrary list of files.</p>
<h4 id="user-content-supported-fields-4" dir="auto"><a class="heading-link" href="#supported-fields-4">Supported Fields:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<ul dir="auto">
<li>Debian (<code>bool</code>, <strong>required</strong>): If the image is based on Debian, check where
Debian lists all licenses.</li>
<li>Files (<code>string[]</code>, <em>optional</em>): A list of other files to check.</li>
</ul>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="licenseTests:
- debian: true
  files: [&quot;/foo/bar&quot;, &quot;/baz/bat&quot;]"><pre><span class="pl-ent">licenseTests</span>:
- <span class="pl-ent">debian</span>: <span class="pl-c1">true</span>
  <span class="pl-ent">files</span>: <span class="pl-s">["/foo/bar", "/baz/bat"]</span></pre></div>
<h3 id="user-content-environment-variables" dir="auto"><a class="heading-link" href="#environment-variables">Environment Variables<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">A list of environment variables can optionally be specified as part of the
test setup. They can either be set up globally (for all test runs), or
test-local as part of individual command test runs (see the <strong>Command Tests</strong>
section above). Each environment variable is specified as a key-value pair.
Unix-style environment variable substitution is supported.</p>
<p dir="auto">To specify, add a section like this to your config:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="globalEnvVars:
  - key: &quot;VIRTUAL_ENV&quot;
    value: &quot;/env&quot;
  - key: &quot;PATH&quot;
    value: &quot;/env/bin:$PATH&quot;"><pre><span class="pl-ent">globalEnvVars</span>:
  - <span class="pl-ent">key</span>: <span class="pl-s"><span class="pl-pds">"</span>VIRTUAL_ENV<span class="pl-pds">"</span></span>
    <span class="pl-ent">value</span>: <span class="pl-s"><span class="pl-pds">"</span>/env<span class="pl-pds">"</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s"><span class="pl-pds">"</span>PATH<span class="pl-pds">"</span></span>
    <span class="pl-ent">value</span>: <span class="pl-s"><span class="pl-pds">"</span>/env/bin:$PATH<span class="pl-pds">"</span></span></pre></div>
<h3 id="user-content-additional-options" dir="auto"><a class="heading-link" href="#additional-options">Additional Options<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The following fields are used to control various options and flags that may be
desirable to set for the running container used to perform a structure test
against an image. This allows an image author to validate certain runtime
behavior that cannot be modified in the image-under-test such as running a
container with an alternative user/UID or mounting a volume.</p>
<p dir="auto">Note that these options are currently only supported with the <code>docker</code> driver.</p>
<p dir="auto">The following list of options are currently supported:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="containerRunOptions:
  user: &quot;root&quot;                  # set the --user/-u flag
  privileged: true              # set the --privileged flag (default: false)
  allocateTty: true             # set the --tty flag (default: false)
  envFile: path/to/.env         # load environment variables from file and pass to container (equivalent to --env-file)
  envVars:                      # if not empty, read each envVar from the environment and pass to test (equivalent to --env/e)
    - SECRET_KEY_FOO
    - OTHER_SECRET_BAR
  capabilities:                 # Add list of Linux capabilities (--cap-add)
    - NET_BIND_SERVICE
  bindMounts:                   # Bind mount a volume (--volume, -v)
    - /etc/example/dir:/etc/dir"><pre><span class="pl-ent">containerRunOptions</span>:
  <span class="pl-ent">user</span>: <span class="pl-s"><span class="pl-pds">"</span>root<span class="pl-pds">"</span></span>                  <span class="pl-c"><span class="pl-c">#</span> set the --user/-u flag</span>
  <span class="pl-ent">privileged</span>: <span class="pl-s">true              </span><span class="pl-c"><span class="pl-c">#</span> set the --privileged flag (default: false)</span>
  <span class="pl-ent">allocateTty</span>: <span class="pl-s">true             </span><span class="pl-c"><span class="pl-c">#</span> set the --tty flag (default: false)</span>
  <span class="pl-ent">envFile</span>: <span class="pl-s">path/to/.env         </span><span class="pl-c"><span class="pl-c">#</span> load environment variables from file and pass to container (equivalent to --env-file)</span>
  <span class="pl-ent">envVars</span>:                      <span class="pl-c"><span class="pl-c">#</span> if not empty, read each envVar from the environment and pass to test (equivalent to --env/e)</span>
    - <span class="pl-s">SECRET_KEY_FOO</span>
    - <span class="pl-s">OTHER_SECRET_BAR</span>
  <span class="pl-ent">capabilities</span>:                 <span class="pl-c"><span class="pl-c">#</span> Add list of Linux capabilities (--cap-add)</span>
    - <span class="pl-s">NET_BIND_SERVICE</span>
  <span class="pl-ent">bindMounts</span>:                   <span class="pl-c"><span class="pl-c">#</span> Bind mount a volume (--volume, -v)</span>
    - <span class="pl-s">/etc/example/dir:/etc/dir</span></pre></div>
<h2 id="user-content-running-tests-on-google-cloud-build" dir="auto"><a class="heading-link" href="#running-tests-on-google-cloud-build">Running Tests On </a><a href="https://cloud.google.com/cloud-build/docs/" rel="nofollow">Google Cloud Build</a><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></h2>
<p dir="auto">This tool is released as a builder image, tagged as
<code>gcr.io/gcp-runtimes/container-structure-test</code>, so you can specify tests in your
<code>cloudbuild.yaml</code>:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="
steps:
# Build an image.
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/image', '.']
# Test the image.
- name: 'gcr.io/gcp-runtimes/container-structure-test'
  args: ['test', '--image', 'gcr.io/$PROJECT_ID/image', '--config', 'test_config.yaml']

# Push the image.
images: ['gcr.io/$PROJECT_ID/image']"><pre><span class="pl-ent">steps</span>:
<span class="pl-c"><span class="pl-c">#</span> Build an image.</span>
- <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">'</span>gcr.io/cloud-builders/docker<span class="pl-pds">'</span></span>
  <span class="pl-ent">args</span>: <span class="pl-s">['build', '-t', 'gcr.io/$PROJECT_ID/image', '.']</span>
<span class="pl-c"><span class="pl-c">#</span> Test the image.</span>
- <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">'</span>gcr.io/gcp-runtimes/container-structure-test<span class="pl-pds">'</span></span>
  <span class="pl-ent">args</span>: <span class="pl-s">['test', '--image', 'gcr.io/$PROJECT_ID/image', '--config', 'test_config.yaml']</span>

<span class="pl-c"><span class="pl-c">#</span> Push the image.</span>
<span class="pl-ent">images</span>: <span class="pl-s">['gcr.io/$PROJECT_ID/image']</span></pre></div>
<h2 id="user-content-running-file-tests-without-docker" dir="auto"><a class="heading-link" href="#running-file-tests-without-docker">Running File Tests Without Docker<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Container images can be represented in multiple formats, and the Docker image
is just one of them. At their core, images are just a series of layers, each
of which is a tarball, and so can be interacted with without a working Docker
daemon. While running command tests currently requires a functioning Docker
daemon on the host machine, File Existence/Content tests do not. This can be
useful when dealing with images which have been <code>docker export</code>ed
or saved in a different image format than the Docker format, or when you're simply
trying to run structure tests in an environment where Docker can't be installed.</p>
<p dir="auto">To run tests without using a Docker daemon, users can specify a different
"driver" to use in the tests, with the <code>--driver</code> flag.</p>
<p dir="auto">An example test run with a different driver looks like:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="container-structure-test test --driver tar --image gcr.io/registry/image:latest \
--config config.yaml"><pre>container-structure-test <span class="pl-c1">test</span> --driver tar --image gcr.io/registry/image:latest \
--config config.yaml</pre></div>
<p dir="auto">The currently supported drivers in the framework are:</p>
<ul dir="auto">
<li><code>docker</code>: the default driver.
Supports all tests, and uses the Docker daemon on the host to run them. You can
set the runtime to use (by example <code>runsc</code> to run with gVisor) using <code>--runtime</code>
flag.</li>
<li><code>tar</code>: a tar driver, which extracts an image filesystem to wherever tests are
running, and runs file/metadata tests against it.
Does <em>not</em> support command tests.</li>
</ul>
<h3 id="user-content-running-structure-tests-through-bazel" dir="auto"><a class="heading-link" href="#running-structure-tests-through-bazel">Running Structure Tests Through Bazel<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Structure tests can also be run through <code>bazel</code>.</p>
<p dir="auto">With Bazel 6 and bzlmod, just see <a href="https://registry.bazel.build/modules/container_structure_test" rel="nofollow">https://registry.bazel.build/modules/container_structure_test</a>.
Otherwise, load the rule and its dependencies in your <code>WORKSPACE</code>, see bazel/test/WORKSPACE.bazel in this repo.</p>
<p dir="auto">Load the rule definition in your BUILD file and declare a <code>container_structure_test</code> target, passing in your image and config file as parameters:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@container_structure_test//:defs.bzl&quot;, &quot;container_structure_test&quot;)

container_structure_test(
    name = &quot;hello_test&quot;,
    configs = [&quot;testdata/hello.yaml&quot;],
    image = &quot;:hello&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@container_structure_test//:defs.bzl"</span>, <span class="pl-s">"container_structure_test"</span>)

<span class="pl-en">container_structure_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"hello_test"</span>,
    <span class="pl-s1">configs</span> <span class="pl-c1">=</span> [<span class="pl-s">"testdata/hello.yaml"</span>],
    <span class="pl-s1">image</span> <span class="pl-c1">=</span> <span class="pl-s">":hello"</span>,
)</pre></div>
<h3 id="user-content-flags" dir="auto"><a class="heading-link" href="#flags">Flags:<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto"><code>container-structure-test test -h</code></p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="  -c, --config stringArray   test config files
  -d, --driver string        driver to use when running tests (default &quot;docker&quot;)
  -f, --force                force run of host driver (without user prompt)
  -h, --help                 help for test
  -i, --image string         path to test image
      --metadata string      path to image metadata file
      --no-color             no color in the output
  -o, --output string        output format for the test report (available format: text, json, junit) (default &quot;text&quot;)
      --pull                 force a pull of the image before running tests
  -q, --quiet                flag to suppress output
      --runtime string       runtime to use with docker driver
      --save                 preserve created containers after test run
      --test-report string   generate test report and write it to specified file (supported format: json, junit; default: json)"><pre class="notranslate"><code>  -c, --config stringArray   test config files
  -d, --driver string        driver to use when running tests (default "docker")
  -f, --force                force run of host driver (without user prompt)
  -h, --help                 help for test
  -i, --image string         path to test image
      --metadata string      path to image metadata file
      --no-color             no color in the output
  -o, --output string        output format for the test report (available format: text, json, junit) (default "text")
      --pull                 force a pull of the image before running tests
  -q, --quiet                flag to suppress output
      --runtime string       runtime to use with docker driver
      --save                 preserve created containers after test run
      --test-report string   generate test report and write it to specified file (supported format: json, junit; default: json)
</code></pre></div>
<p dir="auto">See this <a href="https://github.com/nkubala/structure-test-examples">example repo</a> for a full working example.</p>
<h2 id="user-content-output-formats" dir="auto"><a class="heading-link" href="#output-formats">Output formats<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Reports are generated using one of the following output formats: <code>text</code>, <code>json</code> or <code>junit</code>.
Formats like <code>json</code> and <code>junit</code> can also be used to write a report to a specified file using the <code>--test-report</code>.</p>
<h3 id="user-content-output-samples" dir="auto"><a class="heading-link" href="#output-samples">Output samples<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<h4 id="user-content-text" dir="auto"><a class="heading-link" href="#text">Text<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="====================================
====== Test file: config.yaml ======
====================================
=== RUN: File Existence Test: whoami
--- PASS
duration: 0s
=== RUN: Metadata Test
--- PASS
duration: 0s

=====================================
============== RESULTS ==============
=====================================
Passes:      2
Failures:    0
Duration:    0s
Total tests: 2

PASS"><pre lang="text" class="notranslate"><code>====================================
====== Test file: config.yaml ======
====================================
=== RUN: File Existence Test: whoami
--- PASS
duration: 0s
=== RUN: Metadata Test
--- PASS
duration: 0s

=====================================
============== RESULTS ==============
=====================================
Passes:      2
Failures:    0
Duration:    0s
Total tests: 2

PASS
</code></pre></div>
<h4 id="user-content-json" dir="auto"><a class="heading-link" href="#json">JSON<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<p dir="auto">The following sample has been formatted.</p>
<div class="highlight highlight-source-json notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="{
  &quot;Pass&quot;: 2,
  &quot;Fail&quot;: 0,
  &quot;Total&quot;: 2,
  &quot;Duration&quot;: 0,
  &quot;Results&quot;: [
    {
      &quot;Name&quot;: &quot;File Existence Test: whoami&quot;,
      &quot;Pass&quot;: true,
      &quot;Duration&quot;: 0
    },
    {
      &quot;Name&quot;: &quot;Metadata Test&quot;,
      &quot;Pass&quot;: true,
      &quot;Duration&quot;: 0
    }
  ]
}"><pre>{
  <span class="pl-ent">"Pass"</span>: <span class="pl-c1">2</span>,
  <span class="pl-ent">"Fail"</span>: <span class="pl-c1">0</span>,
  <span class="pl-ent">"Total"</span>: <span class="pl-c1">2</span>,
  <span class="pl-ent">"Duration"</span>: <span class="pl-c1">0</span>,
  <span class="pl-ent">"Results"</span>: [
    {
      <span class="pl-ent">"Name"</span>: <span class="pl-s"><span class="pl-pds">"</span>File Existence Test: whoami<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"Pass"</span>: <span class="pl-c1">true</span>,
      <span class="pl-ent">"Duration"</span>: <span class="pl-c1">0</span>
    },
    {
      <span class="pl-ent">"Name"</span>: <span class="pl-s"><span class="pl-pds">"</span>Metadata Test<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"Pass"</span>: <span class="pl-c1">true</span>,
      <span class="pl-ent">"Duration"</span>: <span class="pl-c1">0</span>
    }
  ]
}</pre></div>
<h3 id="user-content-junit" dir="auto"><a class="heading-link" href="#junit">JUnit<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The following sample has been formatted.</p>
<div class="highlight highlight-text-xml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;testsuites failures=&quot;0&quot; tests=&quot;2&quot; time=&quot;0&quot;&gt;
  &lt;testsuite&gt;
    &lt;testcase name=&quot;File Existence Test: whoami&quot; time=&quot;0&quot;/&gt;
    &lt;testcase name=&quot;Metadata Test&quot; time=&quot;0&quot;/&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">testsuites</span> <span class="pl-e">failures</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">tests</span>=<span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span> <span class="pl-e">time</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">testsuite</span>&gt;
    &lt;<span class="pl-ent">testcase</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>File Existence Test: whoami<span class="pl-pds">"</span></span> <span class="pl-e">time</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span>/&gt;
    &lt;<span class="pl-ent">testcase</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Metadata Test<span class="pl-pds">"</span></span> <span class="pl-e">time</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span>/&gt;
  &lt;/<span class="pl-ent">testsuite</span>&gt;
&lt;/<span class="pl-ent">testsuites</span>&gt;</pre></div>
</article></div>